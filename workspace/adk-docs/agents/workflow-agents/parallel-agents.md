# å¹³è¡Œä»£ç† (Parallel agents)

> ğŸ”” `æ›´æ–°æ—¥æœŸï¼š2026-01-23`
>
> ğŸ”— `è³‡æ–™ä¾†æº`ï¼šhttps://google.github.io/adk-docs/agents/workflow-agents/parallel-agents/

[`ADK æ”¯æ´`: `Python v0.1.0` | `Typescript v0.2.0` | `Go v0.1.0` | `Java v0.2.0`]

`ParallelAgent` æ˜¯ä¸€ç¨®[å·¥ä½œæµä»£ç†](index.md)ï¼Œå®ƒæœƒ*åŒæ™‚*åŸ·è¡Œå…¶å­ä»£ç†ã€‚é€™èƒ½é¡¯è‘—åŠ å¿«ä»»å‹™å¯ç¨ç«‹åŸ·è¡Œä¹‹å·¥ä½œæµçš„é€Ÿåº¦ã€‚

ä½¿ç”¨ `ParallelAgent` çš„æ™‚æ©Ÿï¼šåœ¨å„ªå…ˆè€ƒæ…®é€Ÿåº¦ä¸”æ¶‰åŠç¨ç«‹ã€è³‡æºå¯†é›†å‹ä»»å‹™çš„æƒ…æ³ä¸‹ï¼Œ`ParallelAgent` æœ‰åŠ©æ–¼å¯¦ç¾é«˜æ•ˆçš„å¹³è¡ŒåŸ·è¡Œã€‚**ç•¶å­ä»£ç†åœ¨æ²’æœ‰ä¾è³´é—œä¿‚çš„æƒ…æ³ä¸‹é‹ä½œæ™‚ï¼Œå®ƒå€‘çš„ä»»å‹™å¯ä»¥åŒæ™‚åŸ·è¡Œ**ï¼Œé€²è€Œå¤§å¹…ç¸®çŸ­æ•´é«”çš„è™•ç†æ™‚é–“ã€‚

èˆ‡å…¶ä»–[å·¥ä½œæµä»£ç†](index.md)ä¸€æ¨£ï¼Œ`ParallelAgent` ä¸¦éç”±å¤§å‹èªè¨€æ¨¡å‹ (LLM) é©…å‹•ï¼Œå› æ­¤å…¶åŸ·è¡Œæ–¹å¼æ˜¯ç¢ºå®šæ€§çš„ã€‚è©±é›–å¦‚æ­¤ï¼Œå·¥ä½œæµä»£ç†åƒ…é—œæ³¨å…¶åŸ·è¡Œéç¨‹ï¼ˆå³å¹³è¡ŒåŸ·è¡Œå­ä»£ç†ï¼‰ï¼Œè€Œéå…¶å…§éƒ¨é‚è¼¯ï¼›å·¥ä½œæµä»£ç†çš„å·¥å…·æˆ–å­ä»£ç†å¯èƒ½ä½¿ç”¨ä¹Ÿå¯èƒ½ä¸ä½¿ç”¨ LLMã€‚

### ç¯„ä¾‹

é€™ç¨®æ–¹æ³•å°æ–¼å¤šæºè³‡æ–™æª¢ç´¢æˆ–é‡åº¦é‹ç®—ç­‰æ“ä½œç‰¹åˆ¥æœ‰ç›Šï¼Œåœ¨é€™äº›æ“ä½œä¸­ï¼Œå¹³è¡ŒåŒ–å¯ä»¥å¸¶ä¾†é¡¯è‘—çš„æ•ˆèƒ½æå‡ã€‚é‡è¦çš„æ˜¯ï¼Œæ­¤ç­–ç•¥å‡è¨­ä¸¦ä¸éœ€è¦åœ¨åŒæ™‚åŸ·è¡Œçš„ä»£ç†ä¹‹é–“å…±ç”¨ç‹€æ…‹æˆ–é€²è¡Œç›´æ¥è³‡è¨Šäº¤æ›ã€‚

### å·¥ä½œåŸç†

ç•¶å‘¼å« `ParallelAgent` çš„ `run_async()` æ–¹æ³•æ™‚ï¼š

1. **å¹³è¡ŒåŸ·è¡Œï¼š** å®ƒæœƒ*åŒæ™‚*å•Ÿå‹• `sub_agents` åˆ—è¡¨ä¸­*æ¯å€‹*å­ä»£ç†çš„ `run_async()` æ–¹æ³•ã€‚é€™æ„å‘³è‘—æ‰€æœ‰ä»£ç†å¤§ç´„åœ¨åŒä¸€æ™‚é–“é–‹å§‹é‹è¡Œã€‚
2. **ç¨ç«‹åˆ†æ”¯ï¼š** æ¯å€‹å­ä»£ç†éƒ½åœ¨è‡ªå·±çš„åŸ·è¡Œåˆ†æ”¯ä¸­é‹ä½œã€‚åœ¨åŸ·è¡Œéç¨‹ä¸­ï¼Œé€™äº›åˆ†æ”¯ä¹‹é–“**ä¸æœƒ*è‡ªå‹•å…±ç”¨äº¤è«‡æ­·å²è¨˜éŒ„æˆ–ç‹€æ…‹**ã€‚
3. **çµæœæ”¶é›†ï¼š** `ParallelAgent` ç®¡ç†å¹³è¡ŒåŸ·è¡Œï¼Œä¸¦ä¸”é€šå¸¸æä¾›ä¸€ç¨®æ–¹å¼åœ¨å­ä»£ç†å®Œæˆå¾Œå­˜å–å…¶çµæœï¼ˆä¾‹å¦‚ï¼Œé€éçµæœæˆ–äº‹ä»¶åˆ—è¡¨ï¼‰ã€‚çµæœçš„é †åºå¯èƒ½ä¸æ˜¯ç¢ºå®šæ€§çš„ã€‚

### ç¨ç«‹åŸ·è¡Œèˆ‡ç‹€æ…‹ç®¡ç†

äº†è§£ `ParallelAgent` ä¸­çš„å­ä»£ç†æ˜¯ç¨ç«‹é‹è¡Œçš„è‡³é—œé‡è¦ã€‚å¦‚æœæ‚¨*éœ€è¦*åœ¨é€™äº›ä»£ç†ä¹‹é–“é€²è¡Œé€šè¨Šæˆ–è³‡æ–™å…±ç”¨ï¼Œå‰‡å¿…é ˆæ˜ç¢ºåœ°å¯¦ä½œå®ƒã€‚å¯è¡Œçš„æ–¹æ³•åŒ…æ‹¬ï¼š

* **å…±ç”¨ (Shared) `InvocationContext`ï¼š** æ‚¨å¯ä»¥å°‡å…±ç”¨çš„ `InvocationContext` ç‰©ä»¶å‚³éçµ¦æ¯å€‹å­ä»£ç†ã€‚æ­¤ç‰©ä»¶å¯ä»¥ä½œç‚ºå…±ç”¨çš„è³‡æ–™å„²å­˜ç©ºé–“ã€‚ä½†æ˜¯ï¼Œæ‚¨éœ€è¦ä»”ç´°ç®¡ç†å°æ­¤å…±ç”¨å…§å®¹çš„ä¸¦è¡Œå­˜å–ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨é– (locks)ï¼‰ä»¥é¿å…ç«¶çˆ­æ¢ä»¶ (race conditions)ã€‚
* **å¤–éƒ¨ç‹€æ…‹ç®¡ç† (External State Management)ï¼š** ä½¿ç”¨å¤–éƒ¨è³‡æ–™åº«ã€è¨Šæ¯éšŠåˆ—æˆ–å…¶ä»–æ©Ÿåˆ¶ä¾†ç®¡ç†å…±ç”¨ç‹€æ…‹ä¸¦ä¿ƒé€²ä»£ç†ä¹‹é–“çš„é€šè¨Šã€‚
* **å¾Œè™•ç† (Post-Processing)ï¼š** å¾æ¯å€‹åˆ†æ”¯æ”¶é›†çµæœï¼Œç„¶å¾Œå¯¦ä½œé‚è¼¯åœ¨äº‹å¾Œå”èª¿è³‡æ–™ã€‚

![å¹³è¡Œä»£ç†](https://google.github.io/adk-docs/assets/parallel-agent.png)

### å®Œæ•´ç¯„ä¾‹ï¼šå¹³è¡Œç¶²è·¯ç ”ç©¶

æƒ³åƒåŒæ™‚ç ”ç©¶å¤šå€‹ä¸»é¡Œï¼š

1. **ç ”ç©¶å“¡ä»£ç† 1ï¼š** ä¸€å€‹ç ”ç©¶ã€Œå†ç”Ÿèƒ½æºã€çš„ `LlmAgent`ã€‚
2. **ç ”ç©¶å“¡ä»£ç† 2ï¼š** ä¸€å€‹ç ”ç©¶ã€Œé›»å‹•è»ŠæŠ€è¡“ã€çš„ `LlmAgent`ã€‚
3. **ç ”ç©¶å“¡ä»£ç† 3ï¼š** ä¸€å€‹ç ”ç©¶ã€Œç¢³æ•é›†æ–¹æ³•ã€çš„ `LlmAgent`ã€‚
    ```py
    # åˆå§‹åŒ– ParallelAgentï¼Œä¸¦å°‡ä¸‰å€‹ç ”ç©¶å“¡ä»£ç†æ”¾å…¥å­ä»£ç†æ¸…å–®ä¸­
    ParallelAgent(sub_agents=[ResearcherAgent1, ResearcherAgent2, ResearcherAgent3])
    ```

é€™äº›ç ”ç©¶ä»»å‹™æ˜¯ç¨ç«‹çš„ã€‚ä½¿ç”¨ `ParallelAgent` å…è¨±å®ƒå€‘åŒæ™‚é‹è¡Œï¼Œèˆ‡é †åºé‹è¡Œç›¸æ¯”ï¼Œå¯èƒ½æœƒé¡¯è‘—æ¸›å°‘ç¸½ç ”ç©¶æ™‚é–“ã€‚æ¯å€‹ä»£ç†çš„çµæœå°‡åœ¨å®Œæˆå¾Œåˆ†åˆ¥æ”¶é›†ã€‚

> [!TIP] å®Œæ•´ç¯„ä¾‹ç¨‹å¼ç¢¼
> ä»¥ä¸‹æä¾›å„èªè¨€çš„ `capitsequential_agent_code_development_agent` å®Œæ•´å¯¦ä½œï¼Œæ–¹ä¾¿åƒè€ƒèˆ‡å¯¦ä½œï¼š
>
> **Python**
> â†’ [æŸ¥çœ‹ç¯„ä¾‹ç¨‹å¼ç¢¼](https://github.com/google/adk-docs/blob/main/examples/python/snippets/agents/workflow-agents/parallel_agent_web_research.py)
>
> **TypeScript**
> â†’ [æŸ¥çœ‹ç¯„ä¾‹ç¨‹å¼ç¢¼](https://github.com/google/adk-docs/blob/main/examples/typescript/snippets/agents/workflow-agents/parallel_agent_web_research.ts)
>
> **Go**
> â†’ [æŸ¥çœ‹ç¯„ä¾‹ç¨‹å¼ç¢¼](https://github.com/google/adk-docs/blob/main/examples/go/snippets/agents/workflow-agents/parallel/main.go)
>
> **Java**
> â†’ [æŸ¥çœ‹ç¯„ä¾‹ç¨‹å¼ç¢¼](https://github.com/google/adk-docs/blob/main/examples/java/snippets/src/main/java/agents/workflow/ParallelResearchPipeline.java)

---
### [ç¨‹å¼ç¢¼] é‡é»èªªæ˜ (ä»¥ Python ç‚ºä¾‹)

é€™ä»½ç¯„ä¾‹å±•ç¤ºäº† Google ADK ä¸­æœ€å…¸å‹çš„ **ã€Œå¹³è¡Œæ‰‡å‡ºã€åºåˆ—å½™æ•´ã€(Fan-out / Fan-in)** å·¥ä½œæµæ¨¡å¼ã€‚

#### 1. å¹³è¡ŒåŸ·è¡Œæ©Ÿåˆ¶ (Parallel Execution)
*   **é…ç½®æ–¹å¼**ï¼šé€é `ParallelAgent(sub_agents=[...])` å°‡å¤šå€‹ç¨ç«‹çš„ç ”ç©¶ä»£ç†ï¼ˆ`researcher_agent_1, 2, 3`ï¼‰ç¾¤çµ„åŒ–ã€‚
*   **æ•ˆèƒ½å„ªå‹¢**ï¼šä¸‰å€‹ä»£ç†æœƒ**åŒæ™‚å•Ÿå‹•** `run_async()`ã€‚åœ¨é€²è¡Œç¶²è·¯æœå°‹ï¼ˆGoogle Searchï¼‰é€™é¡ I/O å¯†é›†å‹ä»»å‹™æ™‚ï¼Œç¸½è€—æ™‚å°‡å–æ±ºæ–¼åŸ·è¡Œæœ€æ…¢çš„é‚£å€‹ä»£ç†ï¼Œè€Œéä¸‰å€‹ä»£ç†çš„ç¸½å’Œã€‚
*   **ç¢ºå®šæ€§ç·¨æ’**ï¼š`ParallelAgent` æœ¬èº«ä¸ä½¿ç”¨ LLM åˆ¤æ–·é‚è¼¯ï¼Œè€Œæ˜¯ç¢ºå®šæ€§åœ°åˆ†ç™¼ä»»å‹™ã€‚

#### 2. ç‹€æ…‹ç®¡ç†èˆ‡è¼¸å‡ºéµ (`output_key`)
*   **ç¨ç«‹åˆ†æ”¯æŒ‘æˆ°**ï¼šæ–‡ä»¶æåˆ°å¹³è¡Œä»£ç†çš„åˆ†æ”¯é–“**ä¸æœƒè‡ªå‹•å…±ç”¨æ­·å²è¨˜éŒ„**ã€‚
*   **è§£æ±ºæ–¹æ¡ˆ**ï¼šç¨‹å¼ç¢¼ä¸­æ¯å€‹å­ä»£ç†éƒ½å®šç¾©äº†å”¯ä¸€çš„ `output_key`ï¼ˆä¾‹å¦‚ `renewable_energy_result`ï¼‰ã€‚
*   **æŒä¹…åŒ–å­˜å„²**ï¼šç•¶å­ä»£ç†å®Œæˆä»»å‹™å¾Œï¼Œçµæœæœƒè‡ªå‹•ä»¥å°æ‡‰çš„ Key å­˜å…¥è©² Session çš„ `state` ä¸­ã€‚é€™è§£æ±ºäº†å¹³è¡ŒåŸ·è¡Œä¸­ã€Œçµæœå¦‚ä½•è¢«å¾ŒçºŒåˆ©ç”¨ã€çš„é—œéµå•é¡Œã€‚

#### 3. åºåˆ—åŒ–ç·¨æ’ (Sequential Integration)
*   **ç›¸ä¾æ€§è™•ç†**ï¼šé›–ç„¶ç ”ç©¶ä»»å‹™æ˜¯å¹³è¡Œçš„ï¼Œä½†ã€Œç¸½çµå ±å‘Šã€å¿…é ˆç­‰ç ”ç©¶å®Œæˆå¾Œæ‰èƒ½åŸ·è¡Œã€‚
*   **çµ„åˆæ¨¡å¼**ï¼šç¯„ä¾‹ä½¿ç”¨ `SequentialAgent` å°‡ `ParallelAgent` èˆ‡ `SynthesisAgent` (Merger) ä¸²è¯ï¼š
    ```python
    sequential_pipeline_agent = SequentialAgent(
        sub_agents=[parallel_research_agent, merger_agent]
    )
    ```
    é€™ç¢ºä¿äº†å·¥ä½œæµçš„é‚è¼¯é †åºï¼š**ã€Œå…¨éƒ¨å¹³è¡Œç ”ç©¶å®Œæˆã€â†’ã€Œé–‹å§‹å–®ä¸€æ•´åˆç¸½çµã€**ã€‚

#### 4. çµæœè®€å–èˆ‡å…§å®¹è½åœ° (Data Retrieval & Grounding)
*   **å‹•æ…‹æ³¨å…¥**ï¼š`SynthesisAgent` çš„æŒ‡ä»¤ä¸­ä½¿ç”¨äº†å ä½ç¬¦ `{renewable_energy_result}`ã€‚
*   **ç‹€æ…‹è®€å–**ï¼šADK æœƒè‡ªå‹•å¾ Session ç‹€æ…‹ä¸­æŠ“å–å…ˆå‰ç”±å¹³è¡Œä»£ç†å­˜å…¥çš„å€¼ä¸¦æ³¨å…¥ Promptã€‚
*   **åš´æ ¼æ¥åœ° (Grounding)**ï¼šæŒ‡ä»¤ä¸­å¼·èª¿ `MUST be grounded exclusively on the 'Input Summaries'`ï¼Œç¢ºä¿æ•´åˆä»£ç†åªè™•ç†å¹³è¡Œä»£ç†æ”¶é›†åˆ°çš„è³‡è¨Šï¼Œé¿å…æ¨¡å‹å¹»è¦ºã€‚

#### 5. é‹è¡Œç’°å¢ƒ
*   **InMemoryRunner**ï¼šç¯„ä¾‹é©åˆæœ¬åœ°æ¸¬è©¦èˆ‡åŸå‹é–‹ç™¼ï¼Œèƒ½å®Œæ•´è¿½è¹¤å¹³è¡Œä»£ç†ç”¢å‡ºçš„ä¸­é–“äº‹ä»¶ï¼ˆIntermediate Resultsï¼‰ã€‚

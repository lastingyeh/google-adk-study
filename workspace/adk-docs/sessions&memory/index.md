# 對話上下文簡介：工作階段、狀態與記憶 (Session, State, and Memory)

> 🔔 `更新日期：2026-01-26`
>
> 🔗 `資料來源`：https://google.github.io/adk-docs/sessions/

[`ADK 支援`: `Python` | `TypeScript` | `Go` | `Java`]

有意義的多輪對話需要代理 (Agents) 能夠理解上下文。就像人類一樣，它們需要回想起對話歷史：了解已經說過和做過的事情，以維持連貫性並避免重複。代理開發套件 (Agent Development Kit, ADK) 透過 `Session` (工作階段)、`State` (狀態) 和 `Memory` (記憶) 提供結構化的方式來管理這些上下文。

## 核心概念

將您與代理之間的不同對話實例視為獨立的**對話執行緒 (conversation threads)**，並可能從**長期知識**中汲取內容。

1.  **`Session`**：目前的對話執行緒

    *   代表使用者與您的代理系統之間*單次、持續的互動*。
    *   包含該次互動期間由代理所發送的訊息與採取的動作（稱為 `Events`，事件）之時間順序。
    *   `Session` 也可以保存僅在*該次對話期間*相關的臨時數據 (`State`)。

2.  **`State` (`session.state`)**：目前對話內的數據

    *   儲存在特定 `Session` 中的數據。
    *   用於管理*僅與目前活躍的*對話執行緒相關的資訊（例如：*在本次聊天中*購物車裡的物品、*在本次工作階段中*提到的使用者偏好）。

3.  **`Memory`**：可搜尋的跨工作階段資訊

    *   代表可能跨越*多個過去的工作階段*或包含外部數據源的資訊儲存。
    *   它充當知識庫，代理可以透過*搜尋*來回想超出即時對話範圍的資訊或上下文。

## 管理上下文：服務 (Services)

ADK 提供多種服務來管理這些概念：

1.  **`SessionService`**：管理不同的對話執行緒 (`Session` 物件)

    *   處理生命週期：建立、檢索、更新（附加 `Events`、修改 `State`）以及刪除個別的 `Session`。

2.  **`MemoryService`**：管理長期知識庫 (`Memory`)

    *   處理將資訊（通常來自已完成的 `Session`）擷取到長期儲存中。
    *   提供根據查詢來搜尋這些已儲存知識的方法。

**實作方式**：ADK 為 `SessionService` 和 `MemoryService` 提供不同的實作方式，讓您可以選擇最符合應用程式需求的儲存後端。值得注意的是，這兩種服務都提供了**記憶體內 (in-memory) 實作**；這些實作專為**本地測試和快速開發**而設計。請務必記住，**使用這些記憶體內選項儲存的所有數據（工作階段、狀態或長期知識）在應用程式重啟時都會遺失**。為了在本地測試之外實現持久性和擴展性，ADK 還提供雲端基礎和資料庫服務選項。

**總結：**

*   **`Session` & `State`**：專注於**目前的互動** – 單次活躍對話的歷史與數據。主要由 `SessionService` 管理。
*   **Memory**：專注於**過去與外部資訊** – 一個可能跨越多次對話的*可搜尋存檔*。由 `MemoryService` 管理。

## 後續步驟

在接下來的章節中，我們將深入探討這些組件：

*   **`Session`**：了解其結構與 `Events`。
*   **`State`**：如何有效地讀取、寫入與管理特定工作階段的數據。
*   **`SessionService`**：為您的工作階段選擇正確的儲存後端。
*   **`MemoryService`**：探索儲存與檢索更廣泛上下文的選項。

理解這些概念是構建能夠進行複雜、具狀態且具備上下文感知能力的對話代理的基礎。

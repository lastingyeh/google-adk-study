# å¿«é€Ÿå…¥é–€ï¼šé€é A2A ä½¿ç”¨é ç«¯ä»£ç† (Remote Agent)

> ğŸ”” `æ›´æ–°æ—¥æœŸï¼š2026-01-30`
>
> ğŸ”— `è³‡æ–™ä¾†æº`ï¼šhttps://google.github.io/adk-docs/a2a/quickstart-consuming-go/

[`ADK æ”¯æ´`: `Go` | `å¯¦é©—æ€§åŠŸèƒ½`]

æœ¬å¿«é€Ÿå…¥é–€æ¶µè“‹äº†ä»»ä½•é–‹ç™¼äººå“¡æœ€å¸¸è¦‹çš„èµ·é»ï¼š**ã€Œå·²æœ‰ä¸€å€‹é ç«¯ä»£ç†ï¼Œæˆ‘è©²å¦‚ä½•è®“æˆ‘çš„ ADK ä»£ç†é€é A2A ä½¿ç”¨å®ƒï¼Ÿã€**ã€‚é€™å°æ–¼å»ºç«‹è¤‡é›œçš„å¤šä»£ç†ç³»çµ±è‡³é—œé‡è¦ï¼Œå…¶ä¸­ä¸åŒçš„ä»£ç†éœ€è¦é€²è¡Œå”ä½œå’Œäº’å‹•ã€‚

## æ¦‚è¦½

æ­¤ç¯„ä¾‹æ¼”ç¤ºäº†ä»£ç†é–‹ç™¼å¥—ä»¶ (ADK) ä¸­çš„ **ä»£ç†å°ä»£ç† (Agent-to-Agent, A2A)** æ¶æ§‹ï¼Œå±•ç¤ºäº†å¤šå€‹ä»£ç†å¦‚ä½•å”ä½œè™•ç†è¤‡é›œä»»å‹™ã€‚è©²ç¯„ä¾‹å¯¦ç¾äº†ä¸€å€‹å¯ä»¥æ“²éª°å­ä¸¦æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸çš„ä»£ç†ã€‚

```mermaid
sequenceDiagram
  participant User as ä½¿ç”¨è€…
  participant Root as æ ¹ä»£ç† (æœ¬åœ°)
  participant Roll as æ“²éª°ä»£ç† (æœ¬åœ°)
  participant Prime as è³ªæ•¸ä»£ç† (é ç«¯)

  User->>Root: æ“²éª°å­ä¸¦æª¢æŸ¥æ˜¯å¦ç‚ºè³ªæ•¸
  Root->>Roll: è«‹æ±‚æ“²éª°å­
  Roll-->>Root: å›å‚³æ“²éª°çµæœ
  Root->>Prime: è«‹æ±‚æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸
  Prime-->>Root: å›å‚³æª¢æŸ¥çµæœ
  Root-->>User: æœ€çµ‚å›è¦†
```

A2A åŸºç¤ç¯„ä¾‹ç”±ä»¥ä¸‹éƒ¨åˆ†çµ„æˆï¼š

- **æ ¹ä»£ç† (Root Agent)** (`root_agent`)ï¼šä¸»è¦å”èª¿è€…ï¼Œè² è²¬å°‡ä»»å‹™åˆ†é…çµ¦å°ˆé–€çš„å­ä»£ç†ã€‚
- **æ“²éª°ä»£ç† (Roll Agent)** (`roll_agent`)ï¼šä¸€å€‹æœ¬åœ°å­ä»£ç†ï¼Œè² è²¬æ“²éª°å­æ“ä½œã€‚
- **è³ªæ•¸ä»£ç† (Prime Agent)** (`prime_agent`)ï¼šä¸€å€‹é ç«¯ A2A ä»£ç†ï¼Œè² è²¬æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸ï¼Œè©²ä»£ç†é‹è¡Œåœ¨ç¨ç«‹çš„ A2A ä¼ºæœå™¨ä¸Šã€‚

## ä½¿ç”¨ ADK ä¼ºæœå™¨å…¬é–‹æ‚¨çš„ä»£ç†

  åœ¨ `a2a_basic` ç¯„ä¾‹ä¸­ï¼Œæ‚¨é¦–å…ˆéœ€è¦é€é A2A ä¼ºæœå™¨å…¬é–‹ `check_prime_agent`ï¼Œä»¥ä¾¿æœ¬åœ°æ ¹ä»£ç†å¯ä»¥ä½¿ç”¨å®ƒã€‚

### 1. å–å¾—ç¯„ä¾‹ç¨‹å¼ç¢¼ { #getting-the-sample-code }

é¦–å…ˆï¼Œè«‹ç¢ºä¿æ‚¨å·²å®‰è£ Go ä¸¦ä¸”ç’°å¢ƒå·²è¨­ç½®å®Œæˆã€‚

æ‚¨å¯ä»¥å…‹éš†ä¸¦å°èˆªåˆ°æ­¤è™•çš„ [**`a2a_basic`** ç¯„ä¾‹](https://github.com/google/adk-docs/tree/main/examples/go/a2a_basic)ï¼š

```bash
# åˆ‡æ›è‡³ç¯„ä¾‹ç›®éŒ„
cd examples/go/a2a_basic
```

å¦‚æ‚¨æ‰€è¦‹ï¼Œè³‡æ–™å¤¾çµæ§‹å¦‚ä¸‹ï¼š

```text
a2a_basic/
â”œâ”€â”€ remote_a2a/
â”‚   â””â”€â”€ check_prime_agent/
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ main.go # æœ¬åœ°æ ¹ä»£ç†
```

#### ä¸»ä»£ç† (`a2a_basic/main.go`)

- **`rollDieTool`**ï¼šç”¨æ–¼æ“²éª°å­çš„åŠŸèƒ½å·¥å…·
- **`newRollAgent`**ï¼šå°ˆé–€è² è²¬æ“²éª°å­çš„æœ¬åœ°ä»£ç†
- **`newPrimeAgent`**ï¼šé ç«¯ A2A ä»£ç†é…ç½®
- **`newRootAgent`**ï¼šå…·æœ‰å§”æ´¾é‚è¼¯çš„ä¸»è¦å”èª¿è€…

#### é ç«¯è³ªæ•¸ä»£ç† (`a2a_basic/remote_a2a/check_prime_agent/main.go`)

- **`checkPrimeTool`**ï¼šè³ªæ•¸æª¢æŸ¥æ¼”ç®—æ³•
- **`main`**ï¼šè³ªæ•¸æª¢æŸ¥æœå‹™å’Œ A2A ä¼ºæœå™¨çš„å¯¦ç¾ã€‚

### 2. å•Ÿå‹•é ç«¯è³ªæ•¸ä»£ç†ä¼ºæœå™¨

ç‚ºäº†å±•ç¤ºæ‚¨çš„ ADK ä»£ç†å¦‚ä½•é€é A2A ä½¿ç”¨é ç«¯ä»£ç†ï¼Œæ‚¨é¦–å…ˆéœ€è¦å•Ÿå‹•ä¸€å€‹é ç«¯ä»£ç†ä¼ºæœå™¨ï¼Œè©²ä¼ºæœå™¨å°‡è¨—ç®¡è³ªæ•¸ä»£ç†ï¼ˆä½æ–¼ `check_prime_agent` ä¸‹ï¼‰ã€‚

```bash
# å•Ÿå‹•é ç«¯ a2a ä¼ºæœå™¨ï¼Œåœ¨é€£æ¥åŸ  8001 ä¸Šæä¾› check_prime_agent æœå‹™
go run remote_a2a/check_prime_agent/main.go
```

åŸ·è¡Œå¾Œï¼Œæ‚¨æ‡‰è©²æœƒçœ‹åˆ°å¦‚ä¸‹å…§å®¹ï¼š

``` shell
2025/11/06 11:00:19 Starting A2A prime checker server on port 8001
2025/11/06 11:00:19 Starting the web server: &{port:8001}
2025/11/06 11:00:19
2025/11/06 11:00:19 Web servers starts on http://localhost:8001
2025/11/06 11:00:19        a2a:  you can access A2A using jsonrpc protocol: http://localhost:8001
```

### 3. æŸ¥çœ‹é ç«¯ä»£ç†æ‰€éœ€çš„ä»£ç†å¡

A2A å”å®šè¦æ±‚æ¯å€‹ä»£ç†éƒ½å¿…é ˆæœ‰ä¸€å€‹æè¿°å…¶åŠŸèƒ½çš„ä»£ç†å¡ã€‚

åœ¨ Go ADK ä¸­ï¼Œç•¶æ‚¨ä½¿ç”¨ A2A å•Ÿå‹•å™¨å…¬é–‹ä»£ç†æ™‚ï¼Œæœƒå‹•æ…‹ç”Ÿæˆä»£ç†å¡ã€‚æ‚¨å¯ä»¥é€ è¨ª `http://localhost:8001/.well-known/agent-card.json` æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç†å¡ã€‚

### 4. åŸ·è¡Œä¸»ï¼ˆä½¿ç”¨ç«¯ï¼‰ä»£ç†

  ```bash
  # åœ¨å¦ä¸€å€‹çµ‚ç«¯æ©Ÿä¸­ï¼ŒåŸ·è¡Œä¸»ä»£ç†
  go run main.go
  ```

#### é‹ä½œåŸç†

ä¸»ä»£ç†ä½¿ç”¨ `remoteagent.New` ä¾†ä½¿ç”¨é ç«¯ä»£ç†ï¼ˆåœ¨æˆ‘å€‘çš„ç¯„ä¾‹ä¸­ç‚º `prime_agent`ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œå®ƒéœ€è¦ `Name`ã€`Description` å’Œ `AgentCardSource` URLã€‚

`a2a_basic/main.go`
```go title="a2a_basic/main.go"
// ä½¿ç”¨ remoteagent.NewA2A åˆå§‹åŒ–é ç«¯ä»£ç†
func newPrimeAgent() (agent.Agent, error) {
  remoteAgent, err := remoteagent.NewA2A(remoteagent.A2AConfig{
    Name:            "prime_agent",
    Description:     "è™•ç†æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸çš„ä»£ç†ã€‚",
    AgentCardSource: "http://localhost:8001",
  })
  if err != nil {
    return nil, fmt.Errorf("ç„¡æ³•å»ºç«‹é ç«¯è³ªæ•¸ä»£ç†ï¼š%w", err)
  }
  return remoteAgent, nil
}
```

ç„¶å¾Œï¼Œæ‚¨åªéœ€åœ¨æ ¹ä»£ç†ä¸­ä½¿ç”¨é ç«¯ä»£ç†å³å¯ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œ`primeAgent` è¢«ç”¨ä½œä¸‹æ–¹ `root_agent` çš„å­ä»£ç†ä¹‹ä¸€ï¼š

`a2a_basic/main.go`
```go title="a2a_basic/main.go"
// å°‡é ç«¯ä»£ç†åŠ å…¥åˆ°æ ¹ä»£ç†çš„å­ä»£ç†åˆ—è¡¨ä¸­
func newRootAgent(ctx context.Context, rollAgent, primeAgent agent.Agent) (agent.Agent, error) {
  model, err := gemini.NewModel(ctx, "gemini-2.0-flash", &genai.ClientConfig{})
  if err != nil {
    return nil, err
  }
  return llmagent.New(llmagent.Config{
    Name:  "root_agent",
    Model: model,
    Instruction: `
    ä½ æ˜¯ä¸€å€‹èƒ½å¤ æ“²éª°å­ä¸¦æª¢æŸ¥è³ªæ•¸çš„åŠ©ç†ã€‚
    ä½ æœƒå°‡æ“²éª°å­çš„ä»»å‹™å§”æ´¾çµ¦ roll_agentï¼Œå°‡è³ªæ•¸æª¢æŸ¥çš„ä»»å‹™å§”æ´¾çµ¦ prime_agentã€‚
    è«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼š
    1. è‹¥ä½¿ç”¨è€…è¦æ±‚æ“²éª°å­ï¼Œè«‹å§”æ´¾çµ¦ roll_agentã€‚
    2. è‹¥ä½¿ç”¨è€…è¦æ±‚æª¢æŸ¥è³ªæ•¸ï¼Œè«‹å§”æ´¾çµ¦ prime_agentã€‚
    3. è‹¥ä½¿ç”¨è€…è¦æ±‚æ“²éª°å­å¾Œæª¢æŸ¥çµæœæ˜¯å¦ç‚ºè³ªæ•¸ï¼Œè«‹å…ˆå‘¼å« roll_agentï¼Œå†å°‡çµæœå‚³çµ¦ prime_agentã€‚
    æ¯æ¬¡æ“ä½œå‰è«‹å…ˆç¢ºèªçµæœå†ç¹¼çºŒã€‚
    `,
    SubAgents: []agent.Agent{rollAgent, primeAgent},
    Tools:     []tool.Tool{},
  })
}
```

## äº’å‹•ç¯„ä¾‹

ç•¶æ‚¨çš„ä¸»ä»£ç†å’Œé ç«¯ä»£ç†éƒ½åœ¨é‹è¡Œå¾Œï¼Œæ‚¨å¯ä»¥èˆ‡æ ¹ä»£ç†é€²è¡Œäº’å‹•ï¼Œè§€å¯Ÿå®ƒå¦‚ä½•é€é A2A å‘¼å«é ç«¯ä»£ç†ï¼š

**ç°¡å–®æ“²éª°ï¼š**
æ­¤äº’å‹•ä½¿ç”¨æœ¬åœ°ä»£ç†ã€Œæ“²éª°ä»£ç†ã€ï¼š

```text
ä½¿ç”¨è€…ï¼šæ“²ä¸€å€‹ 6 é¢éª°å­
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼štransfer_to_agentï¼Œåƒæ•¸ï¼šmap[agent_name:roll_agent]
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼šroll_dieï¼Œåƒæ•¸ï¼šmap[sides:6]
æ©Ÿå™¨äººï¼šæˆ‘æ“²äº†ä¸€å€‹ 6 é¢éª°å­ï¼Œçµæœæ˜¯ 6ã€‚
```

**è³ªæ•¸æª¢æŸ¥ï¼š**

æ­¤äº’å‹•é€é A2A ä½¿ç”¨é ç«¯ä»£ç†ã€Œè³ªæ•¸ä»£ç†ã€ï¼š

```text
ä½¿ç”¨è€…ï¼š7 æ˜¯è³ªæ•¸å—ï¼Ÿ
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼štransfer_to_agentï¼Œåƒæ•¸ï¼šmap[agent_name:prime_agent]
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼šprime_checkingï¼Œåƒæ•¸ï¼šmap[nums:[7]]
æ©Ÿå™¨äººï¼šæ˜¯çš„ï¼Œ7 æ˜¯ä¸€å€‹è³ªæ•¸ã€‚
```

**çµ„åˆæ“ä½œï¼š**

æ­¤äº’å‹•åŒæ™‚ä½¿ç”¨æœ¬åœ°ã€Œæ“²éª°ä»£ç†ã€å’Œé ç«¯ã€Œè³ªæ•¸ä»£ç†ã€ï¼š

```text
ä½¿ç”¨è€…ï¼šæ“²ä¸€å€‹éª°å­ä¸¦æª¢æŸ¥å®ƒæ˜¯å¦ç‚ºè³ªæ•¸
æ©Ÿå™¨äººï¼šå¥½çš„ï¼Œæˆ‘æœƒå…ˆæ“²ä¸€å€‹éª°å­ï¼Œç„¶å¾Œæª¢æŸ¥çµæœæ˜¯å¦ç‚ºè³ªæ•¸ã€‚

æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼štransfer_to_agentï¼Œåƒæ•¸ï¼šmap[agent_name:roll_agent]
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼šroll_dieï¼Œåƒæ•¸ï¼šmap[sides:6]
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼štransfer_to_agentï¼Œåƒæ•¸ï¼šmap[agent_name:prime_agent]
æ©Ÿå™¨äººå‘¼å«å·¥å…·ï¼šprime_checkingï¼Œåƒæ•¸ï¼šmap[nums:[3]]
æ©Ÿå™¨äººï¼š3 æ˜¯ä¸€å€‹è³ªæ•¸ã€‚
```

## ä¸‹ä¸€æ­¥

ç¾åœ¨æ‚¨å·²ç¶“å»ºç«‹äº†ä¸€å€‹é€é A2A ä¼ºæœå™¨ä½¿ç”¨é ç«¯ä»£ç†çš„ä»£ç†ï¼Œä¸‹ä¸€æ­¥æ˜¯å­¸ç¿’å¦‚ä½•å…¬é–‹æ‚¨è‡ªå·±çš„ä»£ç†ã€‚

- [**A2A å¿«é€Ÿå…¥é–€ (å…¬é–‹ç«¯)**](../a2a-quickstart%20(exposing)/quickstart-exposing-go.md)ï¼šå­¸ç¿’å¦‚ä½•å…¬é–‹æ‚¨ç¾æœ‰çš„ä»£ç†ï¼Œä»¥ä¾¿å…¶ä»–ä»£ç†å¯ä»¥é€é A2A å”å®šä½¿ç”¨å®ƒã€‚

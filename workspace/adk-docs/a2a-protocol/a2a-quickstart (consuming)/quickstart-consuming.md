# å¿«é€Ÿå…¥é–€ï¼šé€é A2A ä½¿ç”¨é ç«¯ä»£ç†
ğŸ”” `æ›´æ–°æ—¥æœŸï¼š2026-01-15`

[`ADK æ”¯æ´`: `Python` | `å¯¦é©—æ€§é è¦½`]

æœ¬å¿«é€Ÿå…¥é–€æ¶µè“‹äº†ä»»ä½•é–‹ç™¼è€…æœ€å¸¸è¦‹çš„èµ·é»ï¼š**ã€Œæœ‰ä¸€å€‹é ç«¯ä»£ç†ï¼Œæˆ‘è©²å¦‚ä½•è®“æˆ‘çš„ ADK ä»£ç†é€é A2A ä½¿ç”¨å®ƒï¼Ÿã€**ã€‚é€™å°æ–¼æ§‹å»ºè¤‡é›œçš„å¤šä»£ç†ç³»çµ±è‡³é—œé‡è¦ï¼Œåœ¨é€™äº›ç³»çµ±ä¸­ï¼Œä¸åŒçš„ä»£ç†éœ€è¦é€²è¡Œå”ä½œèˆ‡äº’å‹•ã€‚

## ç¸½è¦½

æœ¬ç¯„ä¾‹å±•ç¤ºäº†ä»£ç†é–‹ç™¼å¥—ä»¶ (ADK) ä¸­çš„ **ä»£ç†å°ä»£ç† (Agent2Agent, A2A)** æ¶æ§‹ï¼Œèªªæ˜äº†å¤šå€‹ä»£ç†å¦‚ä½•å”åŒå·¥ä½œä»¥è™•ç†è¤‡é›œä»»å‹™ã€‚è©²ç¯„ä¾‹å¯¦ç¾äº†ä¸€å€‹å¯ä»¥æ“²éª°å­ä¸¦æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸çš„ä»£ç†ã€‚

```mermaid
sequenceDiagram
  participant User as ä½¿ç”¨è€…
  participant Root as æ ¹ä»£ç† (æœ¬åœ°)
  participant Roll as æ“²éª°ä»£ç† (æœ¬åœ°)
  participant Prime as è³ªæ•¸ä»£ç† (é ç«¯)

  User->>Root: æ“²éª°å­ä¸¦æª¢æŸ¥æ˜¯å¦ç‚ºè³ªæ•¸
  Root->>Roll: è«‹æ±‚æ“²éª°å­
  Roll-->>Root: å›å‚³æ“²éª°çµæœ
  Root->>Prime: è«‹æ±‚æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸
  Prime-->>Root: å›å‚³æª¢æŸ¥çµæœ
  Root-->>User: æœ€çµ‚å›è¦†
```

A2A åŸºç¤ç¯„ä¾‹åŒ…å«ï¼š

- **æ ¹ä»£ç†** (`root_agent`)ï¼šä¸»è¦å”èª¿è€…ï¼Œè² è²¬å°‡ä»»å‹™åˆ†é…çµ¦å°ˆé–€çš„å­ä»£ç†
- **æ“²éª°ä»£ç†** (`roll_agent`)ï¼šè™•ç†æ“²éª°å­æ“ä½œçš„æœ¬åœ°å­ä»£ç†
- **è³ªæ•¸ä»£ç†** (`prime_agent`)ï¼šæª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸çš„é ç«¯ A2A ä»£ç†ï¼Œè©²ä»£ç†é‹è¡Œåœ¨ç¨ç«‹çš„ A2A ä¼ºæœå™¨ä¸Š

## ä½¿ç”¨ ADK ä¼ºæœå™¨å…¬é–‹æ‚¨çš„ä»£ç†

  ADK å…§ç½®äº† CLI å‘½ä»¤ `adk api_server --a2a`ï¼Œç”¨æ–¼é€é A2A å”å®šå…¬é–‹æ‚¨çš„ä»£ç†ã€‚

  åœ¨ `a2a_basic` ç¯„ä¾‹ä¸­ï¼Œæ‚¨é¦–å…ˆéœ€è¦é€é A2A ä¼ºæœå™¨å…¬é–‹ `check_prime_agent`ï¼Œä»¥ä¾¿æœ¬åœ°æ ¹ä»£ç†å¯ä»¥ä½¿ç”¨å®ƒã€‚

### 1. ç²å–ç¯„ä¾‹ç¨‹å¼ç¢¼

é¦–å…ˆï¼Œç¢ºä¿æ‚¨å·²å®‰è£å¿…è¦çš„ä¾è³´é …ï¼š

```bash
# å®‰è£æ”¯æ´ A2A åŠŸèƒ½çš„ google-adk
pip install google-adk[a2a]
```

æ‚¨å¯ä»¥åœ¨æ­¤è™•å…‹éš†ä¸¦å°èˆªåˆ° [**`a2a_basic`** ç¯„ä¾‹](https://github.com/google/adk-python/tree/main/contributing/samples/a2a_basic)ï¼š

```bash
# å…‹éš† ADK Python å°ˆæ¡ˆå­˜å„²åº«
git clone https://github.com/google/adk-python.git
```

å¦‚æ‚¨æ‰€è¦‹ï¼Œè³‡æ–™å¤¾çµæ§‹å¦‚ä¸‹ï¼š

```text
a2a_basic/
â”œâ”€â”€ remote_a2a/
â”‚   â””â”€â”€ check_prime_agent/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ agent.json
â”‚       â””â”€â”€ agent.py
â”œâ”€â”€ README.md
â”œâ”€â”€ __init__.py
â””â”€â”€ agent.py # æœ¬åœ°æ ¹ä»£ç†
```

#### ä¸»ä»£ç† (`a2a_basic/agent.py`)

- **`roll_die(sides: int)`**ï¼šç”¨æ–¼æ“²éª°å­çš„å‡½å¼å·¥å…·
- **`roll_agent`**ï¼šå°ˆé–€å¾äº‹æ“²éª°å­çš„æœ¬åœ°ä»£ç†
- **`prime_agent`**ï¼šé ç«¯ A2A ä»£ç†é…ç½®
- **`root_agent`**ï¼šå¸¶æœ‰åˆ†é…é‚è¼¯çš„ä¸»è¦å”èª¿è€…

#### é ç«¯è³ªæ•¸ä»£ç† (`a2a_basic/remote_a2a/check_prime_agent/`)

- **`agent.py`**ï¼šè³ªæ•¸æª¢æŸ¥æœå‹™çš„å¯¦ç¾
- **`agent.json`**ï¼šA2A ä»£ç†çš„ä»£ç†å¡ (Agent card)
- **`check_prime(nums: list[int])`**ï¼šè³ªæ•¸æª¢æŸ¥æ¼”ç®—æ³•

### 2. å•Ÿå‹•é ç«¯è³ªæ•¸ä»£ç†ä¼ºæœå™¨

ç‚ºäº†å±•ç¤ºæ‚¨çš„ ADK ä»£ç†å¦‚ä½•é€é A2A ä½¿ç”¨é ç«¯ä»£ç†ï¼Œæ‚¨é¦–å…ˆéœ€è¦å•Ÿå‹•ä¸€å€‹é ç«¯ä»£ç†ä¼ºæœå™¨ï¼Œè©²ä¼ºæœå™¨å°‡è¨—ç®¡è³ªæ•¸ä»£ç†ï¼ˆä½æ–¼ `check_prime_agent` ä¸‹ï¼‰ã€‚

```bash
# å•Ÿå‹•é ç«¯ a2a ä¼ºæœå™¨ï¼Œåœ¨é€£æ¥åŸ  8001 ä¸Šæä¾› check_prime_agent
adk api_server --a2a --port 8001 contributing/samples/a2a_basic/remote_a2a
```

> [!NOTE] ä½¿ç”¨ `--log_level debug` æ·»åŠ æ—¥èªŒä»¥é€²è¡ŒåµéŒ¯
  è¦å•Ÿç”¨é™¤éŒ¯ç´šåˆ¥çš„æ—¥èªŒè¨˜éŒ„ï¼Œæ‚¨å¯ä»¥åœ¨ `adk api_server` ä¸­æ·»åŠ  `--log_level debug`ï¼Œä¾‹å¦‚ï¼š
  ```bash
  # ä½¿ç”¨ debug æ¨¡å¼å•Ÿå‹• api_server ä»¥ç²å–æ›´è©³ç´°çš„æ—¥èªŒ
  adk api_server --a2a --port 8001 contributing/samples/a2a_basic/remote_a2a --log_level debug
  ```
  é€™å°‡ç‚ºæ‚¨æä¾›æ›´è±å¯Œçš„æ—¥èªŒï¼Œä»¥ä¾¿åœ¨æ¸¬è©¦ä»£ç†æ™‚é€²è¡Œæª¢æŸ¥ã€‚

> [!NOTE] ç‚ºä»€éº¼ä½¿ç”¨é€£æ¥åŸ  8001ï¼Ÿ
  åœ¨æ­¤å¿«é€Ÿå…¥é–€ä¸­ï¼Œåœ¨æœ¬åœ°é€²è¡Œæ¸¬è©¦æ™‚ï¼Œæ‚¨çš„ä»£ç†å°‡ä½¿ç”¨ localhostï¼Œå› æ­¤å…¬é–‹ä»£ç†ï¼ˆé ç«¯è³ªæ•¸ä»£ç†ï¼‰çš„ A2A ä¼ºæœå™¨ `port` å¿…é ˆèˆ‡ä½¿ç”¨æ–¹ä»£ç†çš„é€£æ¥åŸ ä¸åŒã€‚æ‚¨å°‡èˆ‡ä½¿ç”¨æ–¹ä»£ç†äº’å‹•çš„ `adk web` é è¨­é€£æ¥åŸ æ˜¯ `8000`ï¼Œé€™å°±æ˜¯ç‚ºä»€éº¼ A2A ä¼ºæœå™¨ä½¿ç”¨å–®ç¨çš„é€£æ¥åŸ  `8001` å‰µå»ºçš„åŸå› ã€‚

åŸ·è¡Œå¾Œï¼Œæ‚¨æ‡‰è©²æœƒçœ‹åˆ°é¡ä¼¼ä»¥ä¸‹çš„å…§å®¹ï¼š

``` shell
# ä¼ºæœå™¨å•Ÿå‹•æˆåŠŸå¾Œçš„è¼¸å‡ºç¯„ä¾‹
INFO:     Started server process [56558]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8001 (Press CTRL+C to quit)
```

### 3. æ³¨æ„é ç«¯ä»£ç†æ‰€éœ€çš„ä»£ç†å¡ (`agent-card.json`)

A2A å”å®šè¦æ±‚æ¯å€‹ä»£ç†éƒ½å¿…é ˆæœ‰ä¸€å¼µæè¿°å…¶åŠŸèƒ½çš„ä»£ç†å¡ (Agent card)ã€‚

å¦‚æœå…¶ä»–äººå·²ç¶“æ§‹å»ºäº†æ‚¨æƒ³è¦åœ¨ä»£ç†ä¸­ä½¿ç”¨çš„é ç«¯ A2A ä»£ç†ï¼Œé‚£éº¼æ‚¨æ‡‰è©²ç¢ºèªä»–å€‘æœ‰ä¸€å¼µä»£ç†å¡ (`agent-card.json`)ã€‚

åœ¨ç¯„ä¾‹ä¸­ï¼Œ`check_prime_agent` å·²ç¶“æä¾›äº†ä¸€å¼µä»£ç†å¡ï¼š

`a2a_basic/remote_a2a/check_prime_agent/agent-card.json`
```json title="a2a_basic/remote_a2a/check_prime_agent/agent-card.json"
{
  "capabilities": {},
  "defaultInputModes": ["text/plain"],
  "defaultOutputModes": ["application/json"],
  "description": "å°ˆé–€æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸çš„ä»£ç†ã€‚å®ƒå¯ä»¥æœ‰æ•ˆåœ°ç¢ºå®šå–®å€‹æ•¸å­—æˆ–æ•¸å­—åˆ—è¡¨çš„è³ªæ•¸æ€§ã€‚",
  "name": "check_prime_agent",
  "skills": [
    {
      "id": "prime_checking",
      "name": "è³ªæ•¸æª¢æŸ¥",
      "description": "ä½¿ç”¨é«˜æ•ˆçš„æ•¸å­¸æ¼”ç®—æ³•æª¢æŸ¥åˆ—è¡¨ä¸­çš„æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸",
      "tags": ["æ•¸å­¸", "è¨ˆç®—", "è³ªæ•¸", "æ•¸å­—"]
    }
  ],
  "url": "http://localhost:8001/a2a/check_prime_agent",
  "version": "1.0.0"
}
```

> [!NOTE] é—œæ–¼ ADK ä¸­ä»£ç†å¡çš„æ›´å¤šè³‡è¨Š
  åœ¨ ADK ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `to_a2a(root_agent)` åŒ…è£å™¨ï¼Œå®ƒæœƒè‡ªå‹•ç‚ºæ‚¨ç”Ÿæˆä»£ç†å¡ã€‚å¦‚æœæ‚¨æœ‰èˆˆè¶£äº†è§£æ›´å¤šé—œæ–¼å¦‚ä½•å…¬é–‹ç¾æœ‰ä»£ç†ä»¥ä¾¿ä»–äººä½¿ç”¨çš„è³‡è¨Šï¼Œè«‹åƒé–± [A2A å¿«é€Ÿå…¥é–€ï¼ˆå…¬é–‹ï¼‰](../a2a-quickstart%20(exposing)/quickstart-exposing.md) æ•™ç¨‹ã€‚

### 4. é‹è¡Œä¸»ï¼ˆä½¿ç”¨æ–¹ï¼‰ä»£ç†

  ```bash
  # åœ¨å¦ä¸€å€‹çµ‚ç«¯æ©Ÿä¸­ï¼ŒåŸ·è¡Œ adk web ä¼ºæœå™¨
  adk web contributing/samples/
  ```

#### é‹ä½œæ–¹å¼

ä¸»ä»£ç†ä½¿ç”¨ `RemoteA2aAgent()` å‡½å¼ä¾†ä½¿ç”¨é ç«¯ä»£ç†ï¼ˆåœ¨æˆ‘å€‘çš„ç¯„ä¾‹ä¸­ç‚º `prime_agent`ï¼‰ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ`RemoteA2aAgent()` éœ€è¦ `name`ã€`description` ä»¥åŠ `agent_card` çš„ URLã€‚

`a2a_basic/agent.py`
```python title="a2a_basic/agent.py"
# <...ä»£ç¢¼å·²çœç•¥...>

# å¾ ADK é ç«¯ A2A æ¨¡çµ„å°å…¥å¿…è¦è·¯å¾‘èˆ‡é¡åˆ¥
from google.adk.agents.remote_a2a_agent import AGENT_CARD_WELL_KNOWN_PATH
from google.adk.agents.remote_a2a_agent import RemoteA2aAgent

# é…ç½®é ç«¯è³ªæ•¸ä»£ç†
prime_agent = RemoteA2aAgent(
    name="prime_agent",
    description="è² è²¬æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸çš„ä»£ç†ã€‚",
    agent_card=(
        f"http://localhost:8001/a2a/check_prime_agent{AGENT_CARD_WELL_KNOWN_PATH}"
    ),
)

# <...ä»£ç¢¼å·²çœç•¥...>
```

æ¥è‘—ï¼Œæ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„ä»£ç†ä¸­ç°¡å–®åœ°ä½¿ç”¨ `RemoteA2aAgent`ã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œ`prime_agent` è¢«ç”¨ä½œä¸‹æ–¹ `root_agent` çš„å­ä»£ç†ä¹‹ä¸€ï¼š

`a2a_basic/agent.py`
```python title="a2a_basic/agent.py"
from google.adk.agents.llm_agent import Agent
from google.genai import types

# å®šç¾©ä¸»è¦çš„æ ¹ä»£ç†
root_agent = Agent(
    model="gemini-2.0-flash",
    name="root_agent",
    instruction="""
      <ä½ æ˜¯ä¸€å€‹æ¨‚æ–¼åŠ©äººçš„åŠ©æ‰‹ï¼Œå¯ä»¥æ“²éª°å­ä¸¦æª¢æŸ¥æ•¸å­—æ˜¯å¦ç‚ºè³ªæ•¸ã€‚
      ä½ å°‡æ“²éª°å­ä»»å‹™åˆ†é…çµ¦ roll_agentï¼Œå°‡è³ªæ•¸æª¢æŸ¥ä»»å‹™åˆ†é…çµ¦ prime_agentã€‚
      è«‹éµå¾ªä»¥ä¸‹æ­¥é©Ÿï¼š
      1. å¦‚æœä½¿ç”¨è€…è¦æ±‚æ“²éª°å­ï¼Œè«‹åˆ†é…çµ¦ roll_agentã€‚
      2. å¦‚æœä½¿ç”¨è€…è¦æ±‚æª¢æŸ¥è³ªæ•¸ï¼Œè«‹åˆ†é…çµ¦ prime_agentã€‚
      3. å¦‚æœä½¿ç”¨è€…è¦æ±‚æ“²éª°å­ç„¶å¾Œæª¢æŸ¥çµæœæ˜¯å¦ç‚ºè³ªæ•¸ï¼Œè«‹å…ˆå‘¼å« roll_agentï¼Œç„¶å¾Œå°‡çµæœå‚³éçµ¦ prime_agentã€‚
      åœ¨ç¹¼çºŒä¹‹å‰å‹™å¿…æ¾„æ¸…çµæœã€‚>
    """,
    global_instruction=(
        "ä½ æ˜¯ DicePrimeBotï¼Œéš¨æ™‚æº–å‚™æ“²éª°å­ä¸¦æª¢æŸ¥è³ªæ•¸ã€‚"
    ),
    sub_agents=[roll_agent, prime_agent], # è¨»å†Šå­ä»£ç†
    tools=[example_tool],
    generate_content_config=types.GenerateContentConfig(
        safety_settings=[
            types.SafetySetting(  # é¿å…é—œæ–¼æ“²éª°å­çš„èª¤å ±ã€‚
                category=types.HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
                threshold=types.HarmBlockThreshold.OFF,
            ),
        ]
    ),
)
```

## äº’å‹•ç¯„ä¾‹

ç•¶ä¸»ä»£ç†å’Œé ç«¯ä»£ç†éƒ½é‹è¡Œå¾Œï¼Œæ‚¨å¯ä»¥èˆ‡æ ¹ä»£ç†äº’å‹•ï¼ŒæŸ¥çœ‹å®ƒå¦‚ä½•é€é A2A å‘¼å«é ç«¯ä»£ç†ï¼š

**ç°¡å–®çš„æ“²éª°å­ï¼š**
æ­¤äº’å‹•ä½¿ç”¨æœ¬åœ°ä»£ç† Roll Agentï¼š

```text
ä½¿ç”¨è€…ï¼šæ“²ä¸€å€‹ 6 é¢éª°å­
æ©Ÿå™¨äººï¼šæˆ‘ç‚ºä½ æ“²å‡ºäº† 4ã€‚
```

**è³ªæ•¸æª¢æŸ¥ï¼š**

æ­¤äº’å‹•é€é A2A ä½¿ç”¨é ç«¯ä»£ç† Prime Agentï¼š

```text
ä½¿ç”¨è€…ï¼š7 æ˜¯è³ªæ•¸å—ï¼Ÿ
æ©Ÿå™¨äººï¼šæ˜¯çš„ï¼Œ7 æ˜¯è³ªæ•¸ã€‚
```

**çµ„åˆæ“ä½œï¼š**

æ­¤äº’å‹•åŒæ™‚ä½¿ç”¨æœ¬åœ° Roll Agent å’Œé ç«¯ Prime Agentï¼š

```text
ä½¿ç”¨è€…ï¼šæ“²ä¸€å€‹ 10 é¢éª°å­ä¸¦æª¢æŸ¥å®ƒæ˜¯å¦ç‚ºè³ªæ•¸
æ©Ÿå™¨äººï¼šæˆ‘ç‚ºä½ æ“²å‡ºäº† 8ã€‚
æ©Ÿå™¨äººï¼š8 ä¸æ˜¯è³ªæ•¸ã€‚
```

## ä¸‹ä¸€æ­¥

å¦‚éœ€å¦‚ä½•ä½¿ç”¨åŠæ¸¬è©¦å…§å®¹å¿«å–åŠŸèƒ½çš„å®Œæ•´å¯¦ä½œï¼Œè«‹åƒé–±ä»¥ä¸‹ç¯„ä¾‹ï¼š

-   [`a2a-basic`](../../../python/agents/a2a-basic/)ï¼š ã€‚

ç¾åœ¨æ‚¨å·²ç¶“å‰µå»ºäº†ä¸€å€‹é€é A2A ä¼ºæœå™¨ä½¿ç”¨é ç«¯ä»£ç†çš„ä»£ç†ï¼Œä¸‹ä¸€æ­¥æ˜¯å­¸ç¿’å¦‚ä½•å¾å¦ä¸€å€‹ä»£ç†é€£æ¥åˆ°å®ƒã€‚

- [**A2A å¿«é€Ÿå…¥é–€ï¼ˆå…¬é–‹ï¼‰**](../a2a-quickstart%20(exposing)/quickstart-exposing.md)ï¼šå­¸ç¿’å¦‚ä½•å…¬é–‹ç¾æœ‰ä»£ç†ï¼Œä»¥ä¾¿å…¶ä»–ä»£ç†å¯ä»¥é€é A2A å”å®šä½¿ç”¨å®ƒã€‚

# TIL: ä½¿ç”¨ Google ADK 1.16 è©•ä¼°å·¥å…·ä½¿ç”¨å“è³ª (Evaluating Tool Use Quality with Google ADK 1.16)

> ğŸ“ **åŸæ–‡ç¿»è­¯è‡ª RaphaÃ«l MANSUY çš„ Blog**ï¼š[TIL: Evaluating Tool Use Quality with Google ADK 1.16](https://raphaelmansuy.github.io/adk_training/blog/til-tool-use-quality)

## ç°¡ä»‹ (Overview)

æ‚¨çš„ä»£ç†é›–ç„¶å¾—åˆ°äº†æ­£ç¢ºçš„æœ€çµ‚ç­”æ¡ˆï¼Œä½†å®ƒé”æˆçš„æ–¹å¼æ­£ç¢ºå—ï¼Ÿäº†è§£å¦‚ä½•ä½¿ç”¨ ADK 1.16 åŸºæ–¼è©•åˆ†æ¨™æº–çš„è©•ä¼°æ¡†æ¶ä¾†è©•ä¼°å·¥å…·é¸æ“‡å’Œä½¿ç”¨çš„å“è³ªã€‚

## TILï¼šè©•ä¼°å·¥å…·ä½¿ç”¨å“è³ª - æ‚¨çš„ä»£ç†æ˜¯å¦é¸æ“‡äº†æ­£ç¢ºçš„å·¥å…·ï¼Ÿ (Evaluating Tool Use Quality - Does Your Agent Pick the Right Tools?)

### å•é¡Œ (The Problem)

**æƒ…å¢ƒ**ï¼šæ‚¨çš„ä»£ç†å¾—åˆ°äº†æ­£ç¢ºçš„æœ€çµ‚ç­”æ¡ˆï¼Œä½†å®ƒé”æˆçš„æ–¹å¼æ­£ç¢ºå—ï¼Ÿ

æƒ³åƒæ‚¨æœ‰ä¸€å€‹æ•¸æ“šåˆ†æä»£ç†ï¼š

- âœ… ç”¢ç”Ÿäº†æ­£ç¢ºçš„å ±å‘Šï¼ˆæœ€çµ‚ç­”æ¡ˆå¾ˆå¥½ï¼‰
- âŒ ä½†ä½¿ç”¨äº†éŒ¯èª¤çš„æ•¸æ“šæŸ¥è©¢å·¥å…·ï¼ˆä½æ•ˆç‡ï¼‰
- âŒ ä»¥éŒ¯èª¤çš„é †åºèª¿ç”¨å·¥å…·ï¼ˆæµªè²»è³‡æºï¼‰
- âŒ éºæ¼äº†æ›´å¥½çš„å·¥å…·çµ„åˆï¼ˆéæœ€ä½³åŒ–ï¼‰

**å·®è·**ï¼šåƒ…è©•ä¼°æœ€çµ‚ç­”æ¡ˆæœƒå¿½ç•¥é€™äº›é—œéµå•é¡Œã€‚æ‚¨éœ€è¦è©•ä¼°ä»£ç†ä½¿ç”¨å·¥å…·çš„æ•ˆæœã€‚

**ä¸€å¥è©±ç¸½çµ**ï¼šå·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™ (Tool Use Quality Metric) ç”¨æ–¼è©•ä¼°ä»£ç†æ˜¯å¦é¸æ“‡äº†æ­£ç¢ºçš„å·¥å…·ä¸¦é©ç•¶åœ°ä½¿ç”¨å®ƒå€‘ä¾†è§£æ±ºå•é¡Œï¼Œé€™èˆ‡æœ€çµ‚ç­”æ¡ˆçš„å“è³ªæ˜¯åˆ†é–‹çš„ã€‚

### ç‚ºä»€éº¼æ‚¨æ‡‰è©²é—œæ³¨ï¼Ÿ (Why Should You Care?)

**è§£æ±ºçš„å•é¡Œï¼š**

- ğŸ¯ **æ•æ‰å·¥å…·é¸æ“‡éŒ¯èª¤** - å„˜ç®¡å­˜åœ¨æ­£ç¢ºçš„å·¥å…·ï¼Œä»£ç†å»é¸æ“‡äº†éŒ¯èª¤çš„å·¥å…·ã€‚
- ğŸ”„ **é˜²æ­¢å·¥å…·èª¤ç”¨** - ç¢ºä¿å·¥å…·æŒ‰é‚è¼¯é †åºèª¿ç”¨ã€‚
- âš¡ **è­˜åˆ¥æ•ˆç‡ä½ä¸‹** - ç™¼ç¾ä¸å¿…è¦çš„å·¥å…·èª¿ç”¨æˆ–éºæ¼çš„çµ„åˆã€‚
- ğŸ“Š **é—œæ³¨é»åˆ†é›¢** - å·¥å…·å“è³ªèˆ‡ç­”æ¡ˆå“è³ªä½¿ç”¨ä¸åŒçš„æŒ‡æ¨™ã€‚
- ğŸ” **æ”¹å–„ä»£ç†è¨“ç·´** - æä¾›é—œæ–¼å·¥å…·ç›¸é—œå¤±æ•—çš„ç²¾ç¢ºå›é¥‹ã€‚

**å¯¦éš›å½±éŸ¿ï¼š**

ä¸€å€‹å®¢æˆ¶æ”¯æ´ä»£ç†ï¼š

- åœ¨ `process_refund()` ä¹‹å¾Œæ‰èª¿ç”¨ `get_customer_info()`ï¼ˆé †åºéŒ¯èª¤ï¼‰ã€‚
- é€€æ¬¾è™•ç†æ­£ç¢ºï¼ˆæœ€çµ‚ç­”æ¡ˆçœ‹èµ·ä¾†å¾ˆå¥½ï¼‰ã€‚
- ä½†é•åäº†æ¥­å‹™é‚è¼¯ï¼ˆæ‡‰å…ˆé©—è­‰å®¢æˆ¶ï¼‰ã€‚

**å¦‚æœæ²’æœ‰å·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™**ï¼šæ‚¨æœƒéŒ¯éé€™å€‹éŒ¯èª¤ã€‚æœ€çµ‚ç­”æ¡ˆæ˜¯ã€Œæ­£ç¢ºã€çš„ã€‚

**æœ‰äº†å·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™**ï¼šæ‚¨å¯ä»¥ç«‹å³ç™¼ç¾å®ƒã€‚å·¥å…·é †åºè©•ä¼°å°‡æœƒå¤±æ•—ã€‚

### å¿«é€Ÿç¯„ä¾‹ï¼šé‹è¡Œå¯¦éš›è©•ä¼° (Quick Example: Running Real Evaluation)

ADK æä¾› `AgentEvaluator.evaluate()` ä¾†é‹è¡Œå¯¦éš›çš„ `RUBRIC_BASED_TOOL_USE_QUALITY_V1` è©•ä¼°ï¼š

```python
import asyncio
from google.adk.evaluation.agent_evaluator import AgentEvaluator

async def run_evaluation():
    # è‡ªå‹•è©•ä¼°æ­¥é©Ÿï¼š
    # 1. è¼‰å…¥æ‚¨çš„ä»£ç†æ¨¡çµ„
    # 2. é‡å° evalset.json ä¸­çš„æ¸¬è©¦æ¡ˆä¾‹åŸ·è¡Œ
    # 3. LLM è£åˆ¤æ ¹æ“šè©•åˆ†æ¨™æº–è©•ä¼°å·¥å…·åºåˆ—
    # 4. å ±å‘Šé€šé/å¤±æ•—åŠå¾—åˆ†

    results = await AgentEvaluator.evaluate(
        agent_module="tool_use_evaluator",
        eval_dataset_file_path_or_dir="tool_use_quality.evalset.json",
    )

    # çµæœåŒ…å«ï¼š
    # - æ•´é«”åˆ†æ•¸ (0.0-1.0)
    # - å„é …è©•åˆ†æ¨™æº–çš„åˆ†æ•¸
    # - é æœŸèˆ‡å¯¦éš›å·¥å…·èª¿ç”¨çš„å°ç…§
    # - ç›¸å°æ–¼é–¾å€¼çš„é€šé/å¤±æ•—ç‹€æ…‹
    print(results)

asyncio.run(run_evaluation())
```

**é€™é …æ“ä½œçš„ä½œç”¨ï¼š**

1. âœ… è¼‰å…¥ `tool_use_evaluator` ä»£ç†ã€‚
2. âœ… å¾ evalset è®€å–æ¸¬è©¦æ¡ˆä¾‹ï¼ˆå¥½/å£çš„å·¥å…·åºåˆ—ï¼‰ã€‚
3. âœ… ä½¿ç”¨ 4 å€‹è©•åˆ†æ¨™æº–åŸ·è¡Œè©•ä¼°é…ç½®ã€‚
4. âœ… èª¿ç”¨ Gemini æ¨¡å‹ä½œç‚ºè£åˆ¤ï¼ˆæ¯å€‹æ¨™æº– 3 å€‹æ¨£æœ¬ï¼‰ã€‚
5. âœ… è¿”å›åˆ†æ•¸å’Œè©³ç´°å°ç…§ã€‚

**é æœŸè¼¸å‡ºï¼š**

```
Summary: `EvalStatus.FAILED` for Metric: `rubric_based_tool_use_quality_v1`.
Expected threshold: `0.7`, actual value: `0.25`.

[è©³ç´°è¡¨æ ¼é¡¯ç¤ºï¼š]
- eval_status: FAILED/PASSED (å¤±æ•—/é€šé)
- score: 0.25 (æœªé”åˆ° 0.7 çš„é–¾å€¼)
- prompt: "åˆ†æä¸¦æº–å‚™æ•¸æ“šé›†..."
- expected_response: "æ•¸æ“šé›†å·²åˆ†æ..."
- actual_response: "å¥½çš„ï¼Œæˆ‘å°‡åˆ†ææ•¸æ“šé›†..."
- expected_tool_calls: analyze_data â†’ extract_features â†’ validate_quality
- actual_tool_calls: [è‹¥æœªèª¿ç”¨å‰‡ç‚ºç©ºï¼Œæˆ–é¡¯ç¤ºå¯¦éš›èª¿ç”¨åˆ—è¡¨]
```

**é—œéµæ´å¯Ÿï¼š** è©•ä¼°ç²¾ç¢ºé¡¯ç¤ºäº†ä»£ç†åé›¢é æœŸå·¥å…·åºåˆ—çš„åœ°æ–¹ï¼Œä½¿å…¶æ˜“æ–¼è­˜åˆ¥å’Œä¿®å¾©å·¥å…·ä½¿ç”¨å•é¡Œã€‚

### é‹ä½œåŸç†ï¼ˆ3 å€‹æ ¸å¿ƒæ¦‚å¿µï¼‰ (How It Works (3 Key Concepts))

#### 1. å°‡å·¥å…·å“è³ªèˆ‡ç­”æ¡ˆå“è³ªåˆ†é›¢ (Separating Tool Quality from Answer Quality)

èˆ‡æœ€çµ‚å›æ‡‰è©•ä¼°ä¸åŒï¼Œå·¥å…·ä½¿ç”¨å“è³ªå°ˆé–€é—œæ³¨èˆ‡å·¥å…·ç›¸é—œçš„æ±ºç­–ï¼š

```mermaid
graph TD
    subgraph Traditional["å‚³çµ±è©•ä¼° (åƒ…é™æœ€çµ‚ç­”æ¡ˆ)"]
        Q1["ä»£ç†å›æ‡‰"] --> Q2{"ç­”æ¡ˆæ˜¯å¦<br/>æ­£ç¢ºï¼Ÿ"}
        Q2 -->|æ˜¯| Q3["âœ… é«˜åˆ†"]
        Q2 -->|å¦| Q4["âŒ ä½åˆ†"]
    end

    subgraph ToolUse["å·¥å…·ä½¿ç”¨å“è³ªè©•ä¼°"]
        T1["å·¥å…·åºåˆ—"] --> T2{"é †åºæ˜¯å¦<br/>æ­£ç¢ºï¼Ÿ"}
        T2 -->|æ˜¯| T3["âœ… é«˜åˆ†"]
        T2 -->|å¦| T4["âŒ ä½åˆ†<br/>(å³ä½¿ç­”æ¡ˆæ­£ç¢º)"]
    end

    style Q3 fill:#a8e6a8,stroke:#6bbf6b,color:#000
    style Q4 fill:#ffb3b3,stroke:#ff6b6b,color:#000
    style T3 fill:#a8e6a8,stroke:#6bbf6b,color:#000
    style T4 fill:#ffb3b3,stroke:#ff6b6b,color:#000
```

**é—œéµæ´å¯Ÿ**ï¼šä¾†è‡ªéŒ¯èª¤å·¥å…·åºåˆ—çš„æ­£ç¢ºç­”æ¡ˆ = è¼ƒä½çš„å·¥å…·ä½¿ç”¨å“è³ªï¼Œå³ä½¿æœ€çµ‚ç­”æ¡ˆå“è³ªå¾ˆé«˜ã€‚

#### 2. åŸºæ–¼è©•åˆ†æ¨™æº–çš„è©•ä¼°æ¡†æ¶ (Rubric-Based Evaluation Framework)

è©²æŒ‡æ¨™ä½¿ç”¨ä»¥ä¸‹è©•åˆ†æ¨™æº–é€²è¡Œæª¢æŸ¥ï¼š

```
å·¥å…·ä½¿ç”¨å“è³ªè©•åˆ†æ¨™æº–ï¼š

1. å·¥å…·é¸æ“‡é©ç•¶æ€§ (40%)
   âœ“ é¸æ“‡çš„å·¥å…·æ˜¯å¦é©åˆè©²ä»»å‹™ï¼Ÿ
   âœ— åœ¨æœ‰æ›´å¥½é¸æ“‡æ™‚ï¼Œä»£ç†æ˜¯å¦ä½¿ç”¨äº†éŒ¯èª¤çš„å·¥å…·ï¼Ÿ
   âœ— ä»£ç†æ˜¯å¦ä½¿ç”¨äº†å·²æ£„ç”¨/ä½æ•ˆç‡çš„å·¥å…·ï¼Ÿ

2. å·¥å…·é †åºé‚è¼¯ (35%)
   âœ“ å·¥å…·æ˜¯å¦æŒ‰é‚è¼¯é †åºèª¿ç”¨ï¼Ÿ
   âœ— å·¥å…· 3 æ˜¯å¦ä¾è³´æ–¼å·¥å…· 2 çš„è¼¸å‡ºï¼ˆä½†é †åºåäº†ï¼‰ï¼Ÿ
   âœ— å·¥å…·ä¹‹é–“æ˜¯å¦æœ‰ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ›ï¼Ÿ

3. å·¥å…·çµ„åˆæ•ˆç‡ (15%)
   âœ“ ä»£ç†æ˜¯å¦æœ‰æ•ˆåœ°çµ„åˆäº†å·¥å…·ï¼Ÿ
   âœ— æ˜¯å¦éºæ¼äº†æ˜é¡¯çš„å·¥å…·çµ„åˆï¼Ÿ
   âœ— ç•¶ä¸€å€‹å·¥å…·å°±è¶³å¤ æ™‚ï¼Œæ˜¯å¦éåº¦ä½¿ç”¨å·¥å…·ï¼Ÿ

4. éŒ¯èª¤æ¢å¾© (10%)
   âœ“ å¦‚æœå·¥å…·å¤±æ•—ï¼Œä»£ç†æ˜¯å¦é‡è©¦/æ›´æ›æ–¹æ¡ˆï¼Ÿ
   âœ— åœ¨ç¬¬ä¸€æ¬¡å·¥å…·å¤±æ•—å¾Œå°±æ”¾æ£„äº†ï¼Ÿ
   âœ— é‡è¤‡åŒæ¨£å¤±æ•—çš„å·¥å…·èª¿ç”¨ï¼Ÿ

ç¸½é«”å“è³ªåˆ†æ•¸ = ä»¥ä¸Šå„é …çš„åŠ æ¬Šå¹³å‡å€¼
```

**è©•åˆ†æ¨™æº–å¦‚ä½•çµ„åˆæˆæœ€çµ‚åˆ†æ•¸çš„å¯è¦–åŒ–åˆ†è§£ï¼š**

```mermaid
graph TB
    R1["<div style='text-align: left;'>ğŸ¯ å·¥å…·é¸æ“‡<br/>40% æ¬Šé‡</div>"] -->|å¾—åˆ† 0.0-1.0| Calc["<div style='text-align: left;'>âš™ï¸ åˆ†æ•¸<br/>è¨ˆç®—</div>"]
    R2["<div style='text-align: left;'>ğŸ”„ å·¥å…·é †åº<br/>35% æ¬Šé‡</div>"] -->|å¾—åˆ† 0.0-1.0| Calc
    R3["<div style='text-align: left;'>âš¡ çµ„åˆæ•ˆç‡<br/>15% æ¬Šé‡</div>"] -->|å¾—åˆ† 0.0-1.0| Calc
    R4["<div style='text-align: left;'>ğŸ”§ éŒ¯èª¤æ¢å¾©<br/>10% æ¬Šé‡</div>"] -->|å¾—åˆ† 0.0-1.0| Calc

    Calc -->|åŠ æ¬Šå¹³å‡| Final["<div style='text-align: left;'>ğŸ“Š æœ€çµ‚åˆ†æ•¸<br/>0.0 - 1.0</div>"]

    Final -->|â‰¥ 0.8| Pass["<div style='text-align: left;'>âœ… å„ªç•°<br/>å·¥å…·å“è³ª</div>"]
    Final -->|0.6 - 0.8| Fair["<div style='text-align: left;'>âš ï¸ è‰¯å¥½<br/>æœ‰äº›è¨±å•é¡Œ</div>"]
    Final -->|< 0.6| Fail["<div style='text-align: left;'>âŒ å·®å‹<br/>é‡å¤§å•é¡Œ</div>"]

    style R1 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style R2 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style R3 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style R4 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style Calc fill:#ffe6cc,stroke:#ffb347,color:#000
    style Final fill:#fff4e6,stroke:#ffa500,color:#000
    style Pass fill:#a8e6a8,stroke:#6bbf6b,color:#000
    style Fair fill:#fff5b3,stroke:#ffeb99,color:#000
    style Fail fill:#ffb3b3,stroke:#ff6b6b,color:#000
```

#### 3. èˆ‡å…¶ä»–æŒ‡æ¨™çš„å€åˆ¥ (Distinction from Other Metrics)

| æŒ‡æ¨™ | è©•ä¼°å…§å®¹ | ç¯„ä¾‹ |
| :--- | :--- | :--- |
| **æœ€çµ‚å›æ‡‰å“è³ª (Final Response Quality)** | ç­”æ¡ˆæ˜¯å¦æ­£ç¢ºï¼Ÿ | ã€Œå ±å‘Šæ˜¯å¦æº–ç¢ºï¼Ÿã€ |
| **å·¥å…·ä½¿ç”¨å“è³ª (Tool Use Quality)** | ä»£ç†æ˜¯å¦è‰¯å¥½åœ°ä½¿ç”¨å·¥å…·ï¼Ÿ | ã€Œä»£ç†æ˜¯å¦æŸ¥è©¢äº†æ­£ç¢ºçš„è³‡æ–™åº«ï¼Ÿã€ |
| **å®‰å…¨æ€§è©•ä¼°å™¨ (Safety Evaluator)** | æ˜¯å¦å®‰å…¨/åˆè¦ï¼Ÿ | ã€Œä»£ç†æ˜¯å¦é•åäº†è­·æ¬„è¦å‰‡ï¼Ÿã€ |
| **è»Œè·¡è©•ä¼° (Trajectory)** | å®Œæ•´åŸ·è¡Œè·¯å¾‘ | ã€Œæ•´å€‹æ¨ç†éç¨‹æ˜¯å¦ç©©å¥ï¼Ÿã€ |

**é—œéµå€åˆ¥**ï¼šå·¥å…·ä½¿ç”¨é—œæ³¨çš„æ˜¯**éç¨‹**ï¼Œè€Œéçµæœã€‚

```
ç¯„ä¾‹æŸ¥è©¢ï¼š"ç²å–å®¢æˆ¶æœ€è¿‘ 3 ç­†è¨‚å–®ä¸¦è¨ˆç®—é€€æ¬¾"

ä»£ç† Aï¼š
1. èª¿ç”¨ï¼šget_customer() â†’ è¿”å›å®¢æˆ¶è³‡è¨Š
2. èª¿ç”¨ï¼šget_orders() â†’ è¿”å›æœ€è¿‘ 3 ç­†è¨‚å–®
3. èª¿ç”¨ï¼šcalculate_refund() â†’ æ­£ç¢ºç­”æ¡ˆï¼

ä»£ç† Bï¼š
1. èª¿ç”¨ï¼šcalculate_refund() â†’ éŒ¯èª¤ï¼ˆæ²’æœ‰å®¢æˆ¶ä¸Šä¸‹æ–‡ï¼‰
2. èª¿ç”¨ï¼šget_customer() â†’ è¿”å›å®¢æˆ¶è³‡è¨Š
3. èª¿ç”¨ï¼šget_orders() â†’ çµ‚æ–¼å¾—åˆ°æ­£ç¢ºç­”æ¡ˆï¼

æœ€çµ‚å›æ‡‰å“è³ªï¼š
  ä»£ç† Aï¼šâœ… é«˜ï¼ˆæ­£ç¢ºç­”æ¡ˆï¼‰
  ä»£ç† Bï¼šâœ… é«˜ï¼ˆæ­£ç¢ºç­”æ¡ˆï¼‰

å·¥å…·ä½¿ç”¨å“è³ªï¼š
  ä»£ç† Aï¼šâœ… é«˜ï¼ˆé‚è¼¯é †åºï¼Œæ­£ç¢ºå·¥å…·ï¼‰
  ä»£ç† Bï¼šâŒ ä½ï¼ˆé †åºéŒ¯èª¤ï¼Œæµªè²»èª¿ç”¨ï¼‰
```

### ä½¿ç”¨æ¡ˆä¾‹ 1ï¼šæ•¸æ“šåˆ†æä»£ç† (Use Case 1: Data Analytics Agent)

```python
# è©•ä¼°æ•¸æ“šåˆ†æä»£ç†çš„å·¥å…·ä½¿ç”¨æƒ…æ³
criterion = Criterion(
    name="data_pipeline_quality",
    description="ä»£ç†ä»¥æœ€ä½³é †åºä½¿ç”¨æ­£ç¢ºçš„æ•¸æ“šå·¥å…·",
    metric=PrebuiltMetrics.RUBRIC_BASED_TOOL_USE_QUALITY_V1,
    threshold=0.8,
)

# å¥½çš„å·¥å…·åºåˆ—ï¼šæå– (Extract) â†’ è½‰æ› (Transform) â†’ èšåˆ (Aggregate)
# å£çš„å·¥å…·åºåˆ—ï¼šèšåˆ â†’ è½‰æ› â†’ æå–ï¼ˆé †åºéŒ¯èª¤ï¼ï¼‰
# æˆ–è€…ï¼šæå– â†’ æå– â†’ æå–ï¼ˆéºæ¼è½‰æ›æ­¥é©Ÿï¼‰
```

**å®ƒèƒ½æ•æ‰åˆ°ä»€éº¼ï¼š**

- âœ… æ­£ç¢ºçš„å·¥å…·é †åºï¼ˆè½‰æ›å‰å…ˆæå–ï¼‰ã€‚
- âŒ è·³éå¿…è¦çš„è½‰æ›æ­¥é©Ÿã€‚
- âŒ ä½¿ç”¨éŒ¯èª¤çš„æ•¸æ“šæºå·¥å…·ã€‚
- âŒ è³‡æ–™é›†ä¹‹é–“ç¼ºå°‘é—œè¯ (Join)ã€‚

### ä½¿ç”¨æ¡ˆä¾‹ 2ï¼šå®¢æˆ¶æ”¯æ´ä»£ç† (Use Case 2: Customer Support Agent)

```python
# è©•ä¼°æ”¯æ´ä»£ç†çš„å·¥å…·ä½¿ç”¨æƒ…æ³
criterion = Criterion(
    name="support_workflow_quality",
    description="ä»£ç†éµå¾ªæ­£ç¢ºçš„æ”¯æ´å·¥ä½œæµç¨‹",
    metric=PrebuiltMetrics.RUBRIC_BASED_TOOL_USE_QUALITY_V1,
    threshold=0.75,
)

# æ­£ç¢ºçš„å·¥ä½œæµç¨‹ï¼šé©—è­‰ (Verify) â†’ è©•ä¼° (Assess) â†’ è§£æ±º (Resolve)
# å£çš„å·¥ä½œæµç¨‹ï¼šè§£æ±º â†’ é©—è­‰ï¼ˆé †åºåäº†ï¼ï¼‰
# æˆ–è€…ï¼šé©—è­‰ â†’ é©—è­‰ â†’ è©•ä¼°ï¼ˆé‡è¤‡å†—é¤˜ï¼‰
```

**å®ƒèƒ½æ•æ‰åˆ°ä»€éº¼ï¼š**

- âœ… é€€æ¬¾è™•ç†å‰çš„é©—è­‰ã€‚
- âŒ åœ¨ä¸æª¢æŸ¥å®¢æˆ¶ç‹€æ…‹çš„æƒ…æ³ä¸‹è™•ç†é€€æ¬¾ã€‚
- âŒ å…©æ¬¡æª¢æŸ¥ç›¸åŒçš„æ¢ä»¶ã€‚
- âŒ éºæ¼æˆæ¬Šæ­¥é©Ÿã€‚

### ä½¿ç”¨æ¡ˆä¾‹ 3ï¼šç ”ç©¶ä»£ç† (Use Case 3: Research Agent)

```python
# è©•ä¼°ç ”ç©¶ä»£ç†çš„å·¥å…·ä½¿ç”¨æƒ…æ³
criterion = Criterion(
    name="research_methodology",
    description="ä»£ç†æœ‰æ¢ç†åœ°ä½¿ç”¨ç ”ç©¶å·¥å…·",
    metric=PrebuiltMetrics.RUBRIC_BASED_TOOL_USE_QUALITY_V1,
    threshold=0.85,
)

# å¥½çš„åºåˆ—ï¼šæœå°‹ (Search) â†’ æª¢ç´¢ (Retrieve) â†’ äº¤å‰å¼•ç”¨ (Cross-reference) â†’ ç¶œåˆ (Synthesize)
# å£çš„åºåˆ—ï¼šæœå°‹ â†’ ç¶œåˆï¼ˆéºæ¼é©—è­‰æ­¥é©Ÿï¼‰
# æˆ–è€…ï¼šæœå°‹ â†’ äº¤å‰å¼•ç”¨ â†’ æª¢ç´¢ï¼ˆé †åºéŒ¯èª¤ï¼‰
```

**å®ƒèƒ½æ•æ‰åˆ°ä»€éº¼ï¼š**

- âœ… æ­£ç¢ºçš„ç ”ç©¶æµç¨‹ã€‚
- âŒ åœ¨é©—è­‰ä¾†æºå‰é€²è¡Œç¶œåˆã€‚
- âŒ éºæ¼å°æ¯”åˆ†ææ­¥é©Ÿã€‚
- âŒ æœªäº¤å‰æª¢æŸ¥è³‡è¨Šã€‚

### é…ç½®åƒè€ƒ (Configuration Reference)

```python
from google.adk.evaluation import (
    Criterion,
    PrebuiltMetrics,
    LlmAsJudge,
)

# ä½¿ç”¨å·¥å…·ä½¿ç”¨æŒ‡æ¨™å®šç¾©è©•ä¼°æ¨™æº–
criterion = Criterion(
    name="tool_use_quality",
    description="è©•ä¼°å·¥å…·é¸æ“‡å’Œä½¿ç”¨çš„å“è³ª",
    metric=PrebuiltMetrics.RUBRIC_BASED_TOOL_USE_QUALITY_V1,
    threshold=0.7,  # è¦æ±‚ 70% çš„å·¥å…·ä½¿ç”¨å“è³ª
)

# å»ºç«‹è©•ä¼°å™¨
evaluator = LlmAsJudge(
    model="gemini-2.0-flash",  # ç”¨æ–¼è©•ä¼°çš„ LLM
    criteria=[criterion],
)

# è©•ä¼°ä»£ç†åŸ·è¡Œæƒ…æ³
result = evaluator.evaluate(
    invocation=agent_result,
)
```

| åƒæ•¸ | é¡å‹ | ç”¨é€” |
| :--- | :--- | :--- |
| `metric` | Enum | è¨­ç½®ç‚º `PrebuiltMetrics.RUBRIC_BASED_TOOL_USE_QUALITY_V1` |
| `threshold` | float | é€šé/å¤±æ•—çš„æœ€ä½åˆ†æ•¸ (0-1) |
| `name` | str | æ˜“æ–¼é–±è®€çš„æ¨™æº–åç¨± |
| `description` | str | æ‚¨æ­£åœ¨è©•ä¼°çš„å…§å®¹ |

### å°ˆæ¥­æŠ€å·§ (Pro Tips)

ğŸ’¡ **æŠ€å·§ 1 - çµ„åˆæŒ‡æ¨™**ï¼šçµåˆå·¥å…·ä½¿ç”¨å“è³ªèˆ‡æœ€çµ‚å›æ‡‰å“è³ªé€²è¡Œå…¨é¢è©•ä¼°ã€‚

```python
criteria = [
    Criterion(
        name="final_answer_quality",
        metric=PrebuiltMetrics.RUBRIC_BASED_FINAL_RESPONSE_QUALITY_V1,
        threshold=0.8,
    ),
    Criterion(
        name="tool_use_quality",
        metric=PrebuiltMetrics.RUBRIC_BASED_TOOL_USE_QUALITY_V1,
        threshold=0.7,
    ),
]

# ç¾åœ¨æ‚¨å¯ä»¥æ•æ‰åˆ°é€™å…©ç¨®æƒ…æ³ï¼š
# - å¹¸é‹å¾—åˆ°æ­£ç¢ºç­”æ¡ˆä½†æ–¹æ³•éŒ¯èª¤çš„ä»£ç†
# - å·¥å…·ä½¿ç”¨å®Œç¾ä½†ç­”æ¡ˆéŒ¯èª¤çš„ä»£ç†
```

ğŸ’¡ **æŠ€å·§ 2 - è¨­ç½®ç¾å¯¦çš„é–¾å€¼**ï¼šå·¥å…·ä½¿ç”¨å¾ˆè¤‡é›œï¼›åˆæœŸè¨­ç½®é–¾å€¼æ™‚å¯ä»¥å¯¬å®¹ä¸€äº›ã€‚

```python
# å¤ªåš´è‹› - å¾ˆå°‘èƒ½é€šé
threshold=0.95  # âŒ ä¸åˆ‡å¯¦éš›

# ç¾å¯¦çš„åŸºæº–
threshold=0.7   # âœ… å…è¨±ä¸€äº›ä½æ•ˆç‡

# å°ˆæ³¨æ–¼æ”¹é€²å¾Œ
threshold=0.8   # âœ… åœ¨å„ªåŒ–å¾Œä½¿ç”¨
```

ğŸ’¡ **æŠ€å·§ 3 - è¨˜éŒ„å·¥å…·åºåˆ—ä»¥ä¾¿é™¤éŒ¯**ï¼šç•¶å·¥å…·ä½¿ç”¨å“è³ªè¼ƒä½æ™‚ï¼Œæª¢æŸ¥å¯¦éš›çš„åºåˆ—ã€‚

```python
# åœ¨æ‚¨çš„ä»£ç†å›èª¿/æ—¥èªŒä¸­
print("ä½¿ç”¨çš„å·¥å…·åºåˆ—:", [
    tool_call.name for tool_call in invocation.tool_calls
])

# èˆ‡æœ€ä½³åºåˆ—å°ç…§ï¼š
print("æœ€ä½³åºåˆ—:", expected_tools)

# å¯è¦–åŒ–å·®ç•°ä»¥è­˜åˆ¥æ¨¡å¼
```

### ä½•æ™‚ä¸è¦ä½¿ç”¨å®ƒ (When NOT to Use It)

âš ï¸ **åœ¨ä»¥ä¸‹æƒ…æ³æ‡‰é¿å…ä½¿ç”¨ï¼š**

- åªæœ‰ä¸€å€‹å·¥å…·çš„ç°¡å–®ä»£ç†ï¼ˆæ²’æœ‰åºåˆ—å¯ä¾›è©•ä¼°ï¼‰ã€‚
- ç„¡å·¥å…·çš„å·¥ä½œæµç¨‹ï¼ˆä¾‹å¦‚ï¼Œç´”æ¨ç†ä»£ç†ï¼‰ã€‚
- å·¥å…·ä½¿ç”¨æ˜¯éç¢ºå®šæ€§çš„ï¼ˆç¢ºå¯¦æ²’æœ‰ã€Œæ­£ç¢ºã€çš„é †åºï¼‰ã€‚
- åƒ…æ¸¬è©¦æœ€çµ‚ç­”æ¡ˆçš„æ­£ç¢ºæ€§ï¼ˆè«‹æ”¹ç”¨å›æ‡‰å“è³ªæŒ‡æ¨™ï¼‰ã€‚

âš ï¸ **æ‡‰çµåˆä»¥ä¸‹æŒ‡æ¨™ï¼š**

- **æœ€çµ‚å›æ‡‰å“è³ª (Final Response Quality)**ï¼šç¨ç«‹æª¢æŸ¥ç­”æ¡ˆæ­£ç¢ºæ€§ã€‚
- **å®‰å…¨æ€§è©•ä¼°å™¨ (Safety Evaluator)**ï¼šç¢ºä¿å·¥å…·ä½¿ç”¨ç¬¦åˆè¦ç¯„ã€‚
- **è»Œè·¡è©•ä¼°å™¨ (Trajectory Evaluator)**ï¼šå®Œæ•´åŸ·è¡Œè·¯å¾‘åˆ†æã€‚

### å®Œæ•´çš„å·¥ä½œå¯¦ä½œ (Complete Working Implementation)

å®Œæ•´çš„å¯¦ä½œåŒ…å«ï¼š

- å±•ç¤ºä¸åŒä½¿ç”¨æ¨¡å¼çš„å¤šå·¥å…·ä»£ç†ã€‚
- å¸¶æœ‰æ¨™æº–çš„è©•ä¼°æ¡†æ¶è¨­ç½®ã€‚
- é©—è­‰è©•ä¼°çš„ç¶œåˆæ¸¬è©¦å¥—ä»¶ã€‚
- å¯ä¾›è©•ä¼°çš„çœŸå¯¦èª¿ç”¨ç¯„ä¾‹ã€‚
- é–‹ç™¼èˆ‡æ¸¬è©¦å·¥å…·ã€‚

```bash
cd til_implementation/til_rubric_based_tool_use_quality_20250121/
make setup       # å®‰è£ä¾è³´é …
make test        # åŸ·è¡Œè©•ä¼°æ¸¬è©¦
make evaluate    # â­ åŸ·è¡ŒçœŸå¯¦è©•ä¼° (æ–°åŠŸèƒ½ï¼)
make dev         # å•Ÿå‹•äº’å‹•å¼è©•ä¼° UI
make demo        # å¿«é€Ÿé©—è­‰
```

**`make evaluate` å‘½ä»¤ï¼ˆçœŸå¯¦è©•ä¼°ï¼‰ï¼š**

```bash
$ make evaluate

ğŸ“ æ¸¬è©¦æ¡ˆä¾‹æ‘˜è¦
æ¸¬è©¦æ¡ˆä¾‹ 1: good_sequence_complete_pipeline
  æè¿°ï¼šå®Œæ•´çš„ 4 æ­¥ç®¡é“ï¼ˆåˆ†æ â†’ æå– â†’ é©—è­‰ â†’ æ‡‰ç”¨ï¼‰
  é æœŸåˆ†æ•¸ï¼š0.95-1.0ï¼ˆå„ªç•°ï¼‰

æ¸¬è©¦æ¡ˆä¾‹ 2: bad_sequence_skipped_validation
  æè¿°ï¼šç¼ºå°‘æ­¥é©Ÿï¼ˆæå– â†’ æ‡‰ç”¨ï¼Œæ²’æœ‰åˆ†ææˆ–é©—è­‰ï¼‰
  é æœŸåˆ†æ•¸ï¼š0.25-0.4ï¼ˆå·®å‹ï¼‰

æ¸¬è©¦æ¡ˆä¾‹ 3: good_sequence_proper_analysis
  æè¿°ï¼šè‰¯å¥½çš„åˆ†æç®¡é“ï¼ˆåˆ†æ â†’ æå– â†’ é©—è­‰ï¼‰
  é æœŸåˆ†æ•¸ï¼š0.8-0.9ï¼ˆè‰¯å¥½ï¼‰

ğŸ” æ­£åœ¨åŸ·è¡Œè©•ä¼°
ğŸ“‹ è©•ä¼°é…ç½®
é–¾å€¼ï¼š0.7
è£åˆ¤æ¨¡å‹ï¼šgemini-2.5-flash
è©•åˆ†æ¨™æº–ï¼š4 é …
  â€¢ proper_tool_order: ä»£ç†åœ¨ extract_features ä¹‹å‰èª¿ç”¨ analyze_data...
  â€¢ complete_pipeline: æ‰€æœ‰ 4 å€‹å·¥å…·æŒ‰é †åºèª¿ç”¨...
  â€¢ validation_before_model: åœ¨å»ºæ¨¡å‰é©—è­‰å“è³ª...
  â€¢ no_tool_failures: æ‰€æœ‰å·¥å…·èª¿ç”¨å‡ä»¥æ­£ç¢ºåƒæ•¸æˆåŠŸåŸ·è¡Œ...

[LLM è£åˆ¤æ ¹æ“šè©•åˆ†æ¨™æº–è©•ä¼°æ¯å€‹æ¸¬è©¦æ¡ˆä¾‹...]

âš ï¸ è©•ä¼°å·²åŸ·è¡Œï¼Œä½†æ¸¬è©¦æ¡ˆä¾‹æœªé”åˆ°è©•åˆ†é–¾å€¼ï¼š
   é æœŸé–¾å€¼ï¼š0.7ï¼Œå¯¦éš›å€¼ï¼š0.25

é€™æ„å‘³è‘—è©•ä¼°æ¡†æ¶é‹ä½œæ­£å¸¸ï¼
æ¸¬è©¦ä»£ç†ä¸ç¬¦åˆé æœŸçš„å·¥å…·åºåˆ—ã€‚

åœ¨çœŸå¯¦å ´æ™¯ä¸­ï¼Œæ‚¨æ‡‰è©²ï¼š
1. å¯©è¦–ä¸Šæ–¹é æœŸèˆ‡å¯¦éš›å·¥å…·èª¿ç”¨çš„å°ç…§ã€‚
2. èª¿æ•´ä»£ç†æŒ‡ä»¤ä»¥ç¬¦åˆé æœŸè¡Œç‚ºã€‚
3. é‡æ–°åŸ·è¡Œè©•ä¼°ä»¥æŸ¥çœ‹åˆ†æ•¸æ˜¯å¦æé«˜ã€‚
```

**åº•å±¤é‹ä½œæ©Ÿåˆ¶ï¼š**

```python
# evaluate_tool_use.py å»ºç«‹ï¼š
evalset = {
    "eval_cases": [
        {
            "eval_id": "good_sequence_complete_pipeline",
            "intermediate_data": {
                "tool_uses": [
                    {"name": "analyze_data", ...},
                    {"name": "extract_features", ...},
                    {"name": "validate_quality", ...},
                    {"name": "apply_model", ...}
                ]
            }
        },
        # ... ä»¥åŠæå£å’Œéƒ¨åˆ†çš„åºåˆ—
    ]
}

# ç„¶å¾Œèª¿ç”¨ï¼š
results = await AgentEvaluator.evaluate(
    agent_module="tool_use_evaluator",
    eval_dataset_file_path_or_dir="tool_use_quality.evalset.json",
)

# å…§éƒ¨æ­¥é©Ÿï¼š
# 1. è¼‰å…¥æ‚¨çš„ä»£ç†
# 2. æ¯”è¼ƒå¯¦éš›å·¥å…·èª¿ç”¨èˆ‡é æœŸèª¿ç”¨
# 3. ä½¿ç”¨ Gemini ä½œç‚ºè£åˆ¤æ ¹æ“šè©•åˆ†æ¨™æº–é€²è¡Œè©•ä¼°
# 4. è¿”å›åˆ†æ•¸ (0.0-1.0)
# 5. é¡¯ç¤ºç›¸å°æ–¼é–¾å€¼çš„é€šé/å¤±æ•—æƒ…æ³
```

**å®Œæ•´è©•ä¼°å·¥ä½œæµå¯è¦–åŒ–ï¼š**

```mermaid
graph TD
    Start["<div style='text-align: left;'>ğŸš€ é–‹å§‹<br/>make evaluate</div>"] -->|å»ºç«‹æ¸¬è©¦æ¡ˆä¾‹| Step1["<div style='text-align: left;'>ğŸ“ æ­¥é©Ÿ 1<br/>ç”¢ç”Ÿ<br/>evalset.json</div>"]

    Step1 -->|3 å€‹æ¸¬è©¦æ¡ˆä¾‹| Step2["<div style='text-align: left;'>âš™ï¸ æ­¥é©Ÿ 2<br/>è¼‰å…¥æ¸¬è©¦<br/>é…ç½®</div>"]

    Step2 -->|è©•åˆ†æ¨™æº–è¦å‰‡| Step3["<div style='text-align: left;'>ğŸ” æ­¥é©Ÿ 3<br/>åˆå§‹åŒ–<br/>AgentEvaluator</div>"]

    Step3 -->|Gemini è£åˆ¤| Step4["<div style='text-align: left;'>âš¡ æ­¥é©Ÿ 4<br/>åŸ·è¡Œæ¸¬è©¦ä¸¦<br/>æ¯”è¼ƒåºåˆ—</div>"]

    Step4 -->|å·¥å…·èª¿ç”¨| Step5["<div style='text-align: left;'>ğŸ“Š æ­¥é©Ÿ 5<br/>ä½¿ç”¨è©•åˆ†æ¨™æº–<br/>è©•åˆ†</div>"]

    Step5 -->|0.0-1.0 åˆ†æ•¸| Judge{"åˆ†æ•¸æ˜¯å¦ â‰¥<br/>é–¾å€¼ï¼Ÿ"}

    Judge -->|âœ… æ˜¯| Result_Pass["<div style='text-align: left;'>âœ… é€šé<br/>è‰¯å¥½çš„å·¥å…·ä½¿ç”¨</div>"]
    Judge -->|âŒ å¦| Result_Fail["<div style='text-align: left;'>âŒ å¤±æ•—<br/>éœ€è¦æ”¹é€²</div>"]

    Result_Pass -->|å ±å‘Š| End["<div style='text-align: left;'>ğŸ“ˆ çµæŸ<br/>æŸ¥çœ‹çµæœ</div>"]
    Result_Fail -->|å ±å‘Š| End

    style Start fill:#e8f5e9,stroke:#4caf50,color:#000
    style Step1 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style Step2 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style Step3 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style Step4 fill:#fff3e0,stroke:#ffb74d,color:#000
    style Step5 fill:#fff3e0,stroke:#ffb74d,color:#000
    style Judge fill:#f3e5f5,stroke:#ce93d8,color:#000
    style Result_Pass fill:#a8e6a8,stroke:#6bbf6b,color:#000
    style Result_Fail fill:#ffb3b3,stroke:#ff6b6b,color:#000
    style End fill:#e8f5e9,stroke:#4caf50,color:#000
```

**æ¸¬è©¦å¯¦ä½œï¼š**

```bash
# å¾å¯¦ä½œç›®éŒ„åŸ·è¡Œ
pytest tests/ -v

# é æœŸè¼¸å‡ºï¼š
# test_agent.py::TestAgentConfiguration::test_agent_name PASSED
# test_agent.py::TestAgentConfiguration::test_agent_has_tools PASSED
# test_agent.py::TestToolFunctionality::test_analyze_data_success PASSED
# test_tool_use_evaluator.py::test_evaluation_framework PASSED
#
# 23 passed in 0.42s
```

### çœŸå¯¦ä¸–ç•Œç¯„ä¾‹ï¼šå¤šæ­¥é©ŸæŸ¥è©¢ (Real-World Example: Multi-Step Query)

ä»¥ä¸‹æ˜¯å·¥å…·ä½¿ç”¨å“è³ªå¦‚ä½•æ­ç¤ºéš±è—å•é¡Œï¼š

```python
# æƒ…å¢ƒï¼šå®¢æˆ¶è«‹æ±‚é€€æ¬¾åˆ†æ

# ä»£ç†åŸ·è¡Œï¼š
def agent_workflow():
    # æ­¥é©Ÿ 1ï¼šé©—è­‰å®¢æˆ¶æ˜¯å¦å­˜åœ¨
    result1 = get_customer(customer_id="12345")

    # æ­¥é©Ÿ 2ï¼šæª¢æŸ¥è¨‚å–®æ­·å²
    result2 = get_orders(customer_id="12345")

    # æ­¥é©Ÿ 3ï¼šè¨ˆç®—ç¬¦åˆæ¢ä»¶çš„é€€æ¬¾
    result3 = calculate_refund(orders=result2.data)

    # æ­¥é©Ÿ 4ï¼šè™•ç†é€€æ¬¾
    result4 = process_refund(customer_id="12345", amount=result3.amount)

    return result4

# è©•ä¼°çµæœï¼š

æœ€çµ‚å›æ‡‰å“è³ªï¼šâœ… é€šé (0.9)
  - é€€æ¬¾é‡‘é¡æ­£ç¢º
  - å®¢æˆ¶ ID æ­£ç¢º
  - æ–‡ä»¶é½Šå‚™

å·¥å…·ä½¿ç”¨å“è³ªï¼šâŒ å¤±æ•— (0.45)
  - âŒ èª¿ç”¨äº† get_customer() ä½†å¾æœªä½¿ç”¨å…¶çµæœ
  - âœ… æ­£ç¢ºé †åºï¼šé©—è­‰ â†’ æª¢æŸ¥è¨‚å–® â†’ è¨ˆç®— â†’ è™•ç†
  - âŒ åŸæœ¬å¯ä»¥å°‡é©—è­‰ + è¨‚å–®æª¢æŸ¥åˆä½µç‚ºå–®æ¬¡èª¿ç”¨
  - âŒ get_customer() è¿”å›äº†ä¸éœ€è¦çš„æ•æ„Ÿæ•¸æ“šï¼ˆå®‰å…¨å•é¡Œï¼‰

éœ€è¦æ”¹é€²ï¼šå„ªåŒ–å·¥å…·ä½¿ç”¨ï¼Œè€Œéç­”æ¡ˆæ­£ç¢ºæ€§
```

**å¯è¦–åŒ–å°æ¯”ï¼šå¥½èˆ‡å£çš„å·¥å…·é †åºï¼š**

```mermaid
graph TD
    subgraph Good["âœ… è‰¯å¥½çš„å·¥å…·åºåˆ— (å¾—åˆ†: 0.9)"]
        G1["<div style='text-align: left;'>1ï¸âƒ£ get_customer<br/>å®¢æˆ¶ ID</div>"]
        G2["<div style='text-align: left;'>2ï¸âƒ£ get_orders<br/>å®¢æˆ¶ ID</div>"]
        G3["<div style='text-align: left;'>3ï¸âƒ£ calculate_refund<br/>è¨‚å–®æ•¸æ“š</div>"]
        G4["<div style='text-align: left;'>4ï¸âƒ£ process_refund<br/>é‡‘é¡</div>"]

        G1 -->|çµæœ| G2
        G2 -->|è¨‚å–®| G3
        G3 -->|é‡‘é¡| G4
        G4 -->|é€€æ¬¾å·²è™•ç†| G_Result["<div style='text-align: left;'>âœ… æˆåŠŸ<br/>æµç¨‹æ­£ç¢º</div>"]
    end

    subgraph Bad["âŒ éŒ¯èª¤çš„å·¥å…·åºåˆ— (å¾—åˆ†: 0.35)"]
        B1["<div style='text-align: left;'>1ï¸âƒ£ calculate_refund<br/>âŒ å°šç„¡æ•¸æ“šï¼</div>"]
        B2["<div style='text-align: left;'>2ï¸âƒ£ get_customer<br/>å®¢æˆ¶ ID</div>"]
        B3["<div style='text-align: left;'>3ï¸âƒ£ get_orders<br/>å®¢æˆ¶ ID</div>"]
        B4["<div style='text-align: left;'>4ï¸âƒ£ process_refund<br/>éŒ¯èª¤é‡‘é¡</div>"]

        B1 -->|éŒ¯èª¤| B2
        B2 -->|é‡è©¦| B3
        B3 -->|è¨‚å–®| B4
        B4 -->|é€€æ¬¾å¤±æ•—| B_Result["<div style='text-align: left;'>âŒ é †åºéŒ¯èª¤<br/>é¡å¤–èª¿ç”¨</div>"]
    end

    style Good fill:#f0f9f0,stroke:#a8e6a8,color:#000
    style Bad fill:#fef5f5,stroke:#ffb3b3,color:#000
    style G_Result fill:#a8e6a8,stroke:#6bbf6b,color:#000
    style B_Result fill:#ffb3b3,stroke:#ff6b6b,color:#000
    style G1 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style G2 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style G3 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style G4 fill:#d4f1f4,stroke:#76b8d4,color:#000
    style B1 fill:#ffe6e6,stroke:#ff9999,color:#000
    style B2 fill:#ffe6e6,stroke:#ff9999,color:#000
    style B3 fill:#ffe6e6,stroke:#ff9999,color:#000
    style B4 fill:#ffe6e6,stroke:#ff9999,color:#000
```

### ç†è§£è©•åˆ†æ¨™æº–è¨ˆåˆ† (Understanding Rubric Scoring)

å·¥å…·ä½¿ç”¨å“è³ªæœƒç”¢ç”Ÿä¸€å€‹ **0.0-1.0 çš„å–®ä¸€åˆ†æ•¸**ï¼š

```
1.0 = å®Œç¾çš„å·¥å…·ä½¿ç”¨
  - ä»»å‹™æ‰€éœ€çš„å·¥å…·æ­£ç¢º
  - æœ€ä½³åºåˆ—
  - ç„¡æµªè²»æˆ–éŒ¯èª¤
  - å®Œç¾çš„æ¢å¾©èƒ½åŠ›

0.8 = éå¸¸å¥½
  - å·¥å…·æ­£ç¢ºï¼Œæœ‰è¼•å¾®ä½æ•ˆç‡
  - ä¸€æ¬¡ä¸å¿…è¦çš„èª¿ç”¨
  - è‰¯å¥½çš„éŒ¯èª¤è™•ç†

0.5 = å°šå¯
  - ç­”æ¡ˆæ­£ç¢ºä½†å·¥å…·é¸æ“‡ä¸ä½³
  - æŸäº›å·¥å…·ä½¿ç”¨éŒ¯èª¤
  - é †åºé¡›å€’

0.0 = å¤±æ•—
  - å®Œå…¨éŒ¯èª¤çš„å·¥å…·
  - å·¥å…·èª¿ç”¨é †åºéŒ¯èª¤
  - ä¸å¿…è¦çš„å·¥å…·çµ„åˆ
```

### å­¸ç¿’å¾Œçš„å¾ŒçºŒæ­¥é©Ÿ (Next Steps After Learning)

1. ğŸ“– **é–±è®€ç›¸é—œè©•ä¼°æ•™å­¸**ï¼šé—œæ–¼ ADK è©•ä¼°æ¡†æ¶çš„æ•™å­¸ï¼Œä»¥ç²å¾—å…¨é¢äº†è§£ã€‚
2. ğŸš€ **åœ¨æ‚¨çš„ä»£ç†ä¸­å¯¦ä½œ**ï¼šåœ¨æ‚¨çš„è©•ä¼°ç®¡é“ä¸­ä½¿ç”¨å·¥å…·ä½¿ç”¨å“è³ªæ¨™æº–ã€‚
3. ğŸ”§ **çµåˆå…¶ä»–æŒ‡æ¨™**ï¼šå»ºç«‹çµåˆå¤šå€‹æ¨™æº–çš„ç¶œåˆè©•ä¼°ã€‚
4. ğŸ“Š **éš¨æ™‚é–“è¿½è¹¤æŒ‡æ¨™**ï¼šåœ¨æ”¹é€²ä»£ç†æ™‚ç›£æ§å·¥å…·ä½¿ç”¨å“è³ªã€‚

## é—œéµçµèª (Key Takeaway)

**å·¥å…·ä½¿ç”¨å“è³ªè©•ä¼°èƒ½ç™¼ç¾æœ€çµ‚ç­”æ¡ˆæŒ‡æ¨™æ‰€éºæ¼çš„éš±è—å•é¡Œã€‚**

æ‚¨çš„ä»£ç†å¯èƒ½é€ééŒ¯èª¤çš„éç¨‹å¾—åˆ°äº†æ­£ç¢ºçš„ç­”æ¡ˆã€‚å·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™è¿«ä½¿æ‚¨é—œæ³¨ä»£ç†å¦‚ä½•è§£æ±ºå•é¡Œï¼Œè€Œä¸åƒ…åƒ…æ˜¯å®ƒå€‘æ˜¯å¦è§£æ±ºäº†å•é¡Œã€‚

é€™å°æ–¼æ•ˆç‡ã€åˆè¦æ€§å’Œæ­£ç¢ºå·¥ä½œæµèˆ‡æ­£ç¢ºæ€§åŒæ¨£é‡è¦çš„ç”Ÿç”¢ç’°å¢ƒä»£ç†ä¾†èªªéå¸¸å®Œç¾ã€‚

åœ¨é€²å…¥ç”Ÿç”¢ç’°å¢ƒå‰æ•æ‰å·¥å…·èª¤ç”¨ã€‚ âœ¨

---

## ç¨‹å¼ç¢¼å¯¦ç¾ (Code Implementation)

- [til-rubric-based-tool-use-quality](../../../python/agents/til-rubric-based-tool-use-quality/)

---

## å»¶ä¼¸é–±è®€ (See Also)

### ç›¸é—œ TIL

- **[TIL: æš«åœèˆ‡æ¢å¾©èª¿ç”¨ (Pause and Resume Invocations)](./2025-10-20-til-pause-resume.md)** -
  ä½¿ç”¨æš«åœ/æ¢å¾©ä¾†å¯¦ä½œã€Œäººæ©Ÿå”ä½œã€å·¥ä½œæµï¼Œåœ¨ç¹¼çºŒåŸ·è¡Œå‰é©—è­‰å·¥å…·å“è³ªã€‚éå¸¸é©åˆåœ¨æª¢æŸ¥é»è©•ä¼°ä»£ç†æ±ºç­–ã€‚

- **[TIL: ä¸Šä¸‹æ–‡å£“ç¸® (Context Compaction)](./2025-10-19-til-context-compaction.md)** -
  ç¢ºä¿ä¸Šä¸‹æ–‡å£“ç¸®ä¸æœƒé™ä½å·¥å…·é¸æ“‡å“è³ªã€‚åœ¨ä¸Šä¸‹æ–‡è®Šå¾—æ›´å£“ç¸®æ™‚ç›£æ§å·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™ã€‚

- **[è¿”å› TIL ç´¢å¼•](./README.md)** - ç€è¦½æ‰€æœ‰å¿«é€Ÿå­¸ç¿’æŒ‡å—

### ç›¸é—œ ADK æ•™å­¸ (Related ADK Tutorials)

- **[æ•™å­¸ 01ï¼šHello World ä»£ç† (Hello World Agent)](../adk_training/01-hello_world_agent.md)** -
  äº†è§£å°‡è¢«è©•ä¼°å·¥å…·å“è³ªçš„ä»£ç†åŸºç¤ã€‚

- **[æ•™å­¸ 02ï¼šå‡½æ•¸å·¥å…· (Function Tools)](../adk_training/02-function_tools.md)** -
  å­¸ç¿’å¦‚ä½•è¨­è¨ˆä»£ç†å°‡ä½¿ç”¨çš„å·¥å…·ï¼›é€™å°æ–¼å·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™è‡³é—œé‡è¦ã€‚

- **[æ•™å­¸ 06ï¼šå¤šä»£ç†ç³»çµ± (Multi-Agent Systems)](../adk_training/06-multi_agent_systems.md)** -
  å­¸ç¿’å¦‚ä½•æœ‰æ•ˆçµ„åˆä»£ç†ï¼›èˆ‡å¤§å‹ç³»çµ±ä¸­çš„å·¥å…·ä½¿ç”¨å“è³ªç›¸é—œã€‚

- **[æ•™å­¸ 10ï¼šè©•ä¼°èˆ‡æ¸¬è©¦ (Evaluation & Testing)](../adk_training/10-evaluation_testing.md)** -
  æ‰€æœ‰è©•ä¼°æŒ‡æ¨™å’Œæ¡†æ¶çš„ç¶œåˆæŒ‡å—ã€‚

### ADK æ–‡ä»¶ (ADK Official Documentation)

- **[è©•ä¼°æ¡†æ¶ (Evaluation Framework)](https://google.github.io/adk-docs/evaluate/)** -
  å®˜æ–¹ ADK è©•ä¼°æ–‡ä»¶ã€‚

- **[å·¥å…·ä½¿ç”¨å“è³ªæŒ‡æ¨™ (Tool Use Quality Metric)](https://github.com/google/adk-python/blob/main/src/google/adk/evaluation/evaluator.py)** -
  åŸå§‹ç¢¼èˆ‡å¯¦ä½œç´°ç¯€ã€‚

- **[ä»£ç†è©•ä¼°å™¨ API (Agent Evaluator API)](https://github.com/google/adk-python/blob/main/src/google/adk/evaluation/agent_evaluator.py)** -
  åŸ·è¡Œè©•ä¼°çš„å®Œæ•´ API åƒè€ƒã€‚

### ç›¸é—œè³‡æºèˆ‡æ¨¡å¼ (Related Resources & Patterns)

- **[éƒ¨ç½² AI ä»£ç†ï¼šç”Ÿç”¢ç­–ç•¥ (Deploy AI Agents: Production Strategies)](./2025-10-17-deploy-ai-agents.md)** -
  äº†è§£ç”Ÿç”¢ç³»çµ±ä¸­çš„å“è³ªä¿è­‰èˆ‡è©•ä¼°ã€‚

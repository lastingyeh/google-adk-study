# æ•™å­¸ 05ï¼šå¹³è¡Œè™•ç† - åŒæ™‚åŸ·è¡Œå¤šå€‹ä»£ç†

## ç¸½è¦½

æœ¬æ•™å­¸å°‡æŒ‡å°æ‚¨å¦‚ä½•åŒæ™‚åŸ·è¡Œå¤šå€‹ä»£ç†ï¼ˆAgentï¼‰ï¼Œä»¥é¡¯è‘—æå‡å·¥ä½œæµç¨‹çš„æ•ˆç‡ã€‚æ‚¨å°‡å­¸ç¿’ **`ParallelAgent`** æ¨¡å¼å’Œå¼·å¤§çš„ **æ‰‡å‡º/æ”¶é›† (fan-out/gather)** æŠ€è¡“ï¼Œé€™å°æ–¼ä»»ä½•éœ€è¦é«˜æ•ˆèƒ½çš„çœŸå¯¦ä¸–ç•Œä»£ç†ç³»çµ±è‡³é—œé‡è¦ã€‚

**ğŸ¯ å·¥ä½œå¯¦ç¾**ï¼šä¸€å€‹å®Œæ•´ä¸”ç¶“éæ¸¬è©¦çš„æ—…éŠè¦åŠƒç³»çµ±å¯åœ¨ [`tutorial_implementation/tutorial05/`](https://github.com/raphaelmansuy/adk_training/tree/main/tutorial_implementation/tutorial05/) ä¸­æ‰¾åˆ°ï¼ŒåŒ…å«å®Œæ•´çš„æ¸¬è©¦ã€æ–‡ä»¶å’Œä½¿ç”¨è€…å‹å–„çš„è¨­å®šæµç¨‹ã€‚

## å…ˆæ±ºæ¢ä»¶

*   å®Œæˆæ•™å­¸ 01-04ï¼Œäº†è§£ä»£ç†ã€å·¥å…·å’Œå¾ªåºå·¥ä½œæµç¨‹ã€‚
*   å·²å®‰è£ ADKï¼š`pip install google-adk`ã€‚
*   å·²è¨­å®š API é‡‘é‘°ï¼ˆåƒè€ƒæ•™å­¸ 01ï¼‰ã€‚

## æ ¸å¿ƒæ¦‚å¿µ

### ParallelAgent

**`ParallelAgent`** æœƒ**åŒæ™‚**åŸ·è¡Œå¤šå€‹å­ä»£ç†ï¼Œè€Œéå¾ªåºåŸ·è¡Œã€‚é€™åœ¨ä»¥ä¸‹æƒ…æ³ä¸‹éå¸¸é©ç”¨ï¼š

*   ä»»å‹™å½¼æ­¤**ç¨ç«‹**ã€‚
*   è¿½æ±‚**é€Ÿåº¦**ï¼Œå¸Œæœ›æ¯”é€ä¸€åŸ·è¡Œæ›´å¿«ã€‚
*   å¾**å¤šå€‹ä¾†æº**æ”¶é›†è³‡è¨Šã€‚

**ä¸»è¦ç‰¹æ€§ï¼š**

*   æ‰€æœ‰å­ä»£ç†åŒæ™‚å•Ÿå‹•ã€‚
*   ä»£ç†ç¨ç«‹åŸ·è¡Œï¼ŒåŸ·è¡ŒæœŸé–“ç„¡å…±äº«è³‡æ–™ã€‚
*   `ParallelAgent` æœƒç­‰å¾…æ‰€æœ‰ä»£ç†å®Œæˆã€‚
*   ç›´åˆ°æœ€æ…¢çš„ä»£ç†å®Œæˆå¾Œæ‰è¿”å›çµæœã€‚

### ä½•æ™‚ä½¿ç”¨å¹³è¡Œ vs. å¾ªåº

| ä½¿ç”¨ `ParallelAgent` (å¹³è¡Œ)                                | ä½¿ç”¨ `SequentialAgent` (å¾ªåº)                                |
| ---------------------------------------------------------- | ------------------------------------------------------------ |
| âœ… ä»»å‹™ç¨ç«‹ï¼ˆå¯ä»»æ„é †åºåŸ·è¡Œï¼‰                              | âœ… ä»»å‹™**å¿…é ˆ**æŒ‰ç‰¹å®šé †åºåŸ·è¡Œ                                |
| âœ… é€Ÿåº¦è‡³é—œé‡è¦                                            | âœ… æ¯ä¸€æ­¥éƒ½éœ€è¦å‰ä¸€æ­¥çš„è¼¸å‡º                                  |
| âœ… å¾å¤šå€‹ä¾†æºæ”¶é›†è³‡æ–™                                      | âœ… å»ºç«‹ä¸€å€‹ç®¡ç·šï¼ˆè¼¸å‡ºåœ¨ä»£ç†ä¹‹é–“æµå‹•ï¼‰                        |
| âœ… ä»»å‹™ä¸éœ€è¦å½¼æ­¤çš„è¼¸å‡º                                    |                                                              |

### æ‰‡å‡º/æ”¶é›† (Fan-Out/Gather) æ¨¡å¼

é€™æ˜¯çœŸå¯¦ä¸–ç•Œä»£ç†çš„é—œéµæ¨¡å¼ï¼š

1.  **æ‰‡å‡º (Fan-Out)** (å¹³è¡Œ) â†’ åŒæ™‚åŸ·è¡Œå¤šå€‹ä»£ç†ä»¥æ”¶é›†è³‡æ–™ã€‚
2.  **æ”¶é›† (Gather)** (å¾ªåº) â†’ ä½¿ç”¨ä¸€å€‹æœ€çµ‚ä»£ç†åˆä½µæ‰€æœ‰çµæœã€‚

```mermaid
graph TD
    subgraph ParallelAgent["ParallelAgentï¼ˆå¿«é€Ÿï¼ï¼‰"]
        A[ä½¿ç”¨è€…] --> B(ä»£ç† 1 - èˆªç­)
        A --> C(ä»£ç† 2 - é£¯åº—)
        A --> D(ä»£ç† 3 - æ´»å‹•)
    end

    subgraph SequentialAgent["SequentialAgentï¼ˆåˆä½µï¼‰"]
        B --> E(åˆä½µä»£ç†)
        C --> E
        D --> E
    end

    E --> F[æœ€çµ‚çµæœ]
```

é€™ç¨®æ¨¡å¼å…¼å…·**é€Ÿåº¦**ï¼ˆå¹³è¡Œè³‡æ–™æ”¶é›†ï¼‰å’Œ**ç¶œåˆ**ï¼ˆåˆä½µçµæœï¼‰çš„å„ªé»ã€‚

## ä½¿ç”¨æ¡ˆä¾‹

æˆ‘å€‘å°‡å»ºç«‹ä¸€å€‹**æ™ºæ…§æ—…éŠè¦åŠƒå™¨**ï¼Œé€éä»¥ä¸‹æ­¥é©Ÿå¹«åŠ©ä½¿ç”¨è€…è¦åŠƒè¡Œç¨‹ï¼š

1.  **æœå°‹èˆªç­** (å¹³è¡Œ)
2.  **æœå°‹é£¯åº—** (å¹³è¡Œ)
3.  **å°‹æ‰¾æ´»å‹•** (å¹³è¡Œ)
4.  **å°‡æ‰€æœ‰è³‡è¨Šåˆä½µ**æˆä¸€å€‹å®Œæ•´çš„è¡Œç¨‹ (å¾ªåº)

## æ­¥é©Ÿ 1ï¼šå–å¾—å·¥ä½œå¯¦ç¾

ä¸€å€‹å®Œæ•´ä¸”ç¶“éæ¸¬è©¦çš„å¯¦ä½œå¯åœ¨å„²å­˜åº«ä¸­æ‰¾åˆ°ï¼š

```bash
# å°èˆªè‡³å·¥ä½œå¯¦ç¾ç›®éŒ„
cd tutorial_implementation/tutorial05/

# å®‰è£ä¾è³´
make setup

# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬ä¸¦åŠ å…¥æ‚¨çš„ API é‡‘é‘°
cp travel_planner/.env.example travel_planner/.env
# ç·¨è¼¯ travel_planner/.env ä¸¦åŠ å…¥æ‚¨çš„ GOOGLE_API_KEY
```

## æ­¥é©Ÿ 2ï¼šå»ºç«‹å°ˆæ¡ˆçµæ§‹ (å¯é¸)

å¦‚æœæ‚¨æƒ³å¾é ­é–‹å§‹ï¼Œè«‹å»ºç«‹ä»¥ä¸‹çµæ§‹ï¼š

```bash
mkdir travel_planner
cd travel_planner
touch __init__.py agent.py .env
```

## å°ˆæ¡ˆçµæ§‹

å·¥ä½œå¯¦ç¾éµå¾ªä»¥ä¸‹çµæ§‹ï¼š

```
tutorial05/
â”œâ”€â”€ travel_planner/           # ä»£ç†å¯¦ç¾
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent.py             # ä»£ç†å®šç¾©èˆ‡ç®¡ç·š
â”‚   â””â”€â”€ .env.example
â”œâ”€â”€ tests/                   # æ¸¬è©¦å¥—ä»¶
â”‚   â”œâ”€â”€ test_agent.py
â”‚   â”œâ”€â”€ ...
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

## æ­¥é©Ÿ 3ï¼šå®šç¾©æ—…éŠè¦åŠƒä»£ç†

**travel_planner/agent.py**

```python
from __future__ import annotations
from google.adk.agents import Agent, ParallelAgent, SequentialAgent

# ============================================================================
# å¹³è¡Œæœå°‹ä»£ç†
# ============================================================================

# èˆªç­æœå°‹å™¨
flight_finder = Agent(
    name="flight_finder",
    model="gemini-2.0-flash",
    description="æœå°‹å¯ç”¨èˆªç­",
    instruction="æ‚¨æ˜¯èˆªç­æœå°‹å°ˆå®¶...",
    output_key="flight_options"
)

# é£¯åº—æœå°‹å™¨
hotel_finder = Agent(
    name="hotel_finder",
    model="gemini-2.0-flash",
    description="æœå°‹å¯ç”¨é£¯åº—",
    instruction="æ‚¨æ˜¯é£¯åº—æœå°‹å°ˆå®¶...",
    output_key="hotel_options"
)

# æ´»å‹•æœå°‹å™¨
activity_finder = Agent(
    name="activity_finder",
    model="gemini-2.0-flash",
    description="å°‹æ‰¾æ´»å‹•èˆ‡æ™¯é»",
    instruction="æ‚¨æ˜¯ç•¶åœ°æ´»å‹•å°ˆå®¶...",
    output_key="activity_options"
)

# ============================================================================
# æ‰‡å‡ºï¼šå¹³è¡Œè³‡æ–™æ”¶é›†
# ============================================================================

parallel_search = ParallelAgent(
    name="ParallelSearch",
    sub_agents=[flight_finder, hotel_finder, activity_finder],
    description="åŒæ™‚æœå°‹èˆªç­ã€é£¯åº—å’Œæ´»å‹•"
)

# ============================================================================
# æ”¶é›†ï¼šå¾ªåºçµæœåˆä½µ
# ============================================================================

itinerary_builder = Agent(
    name="itinerary_builder",
    model="gemini-2.0-flash",
    description="å°‡æ‰€æœ‰æœå°‹çµæœåˆä½µæˆå®Œæ•´çš„æ—…éŠè¡Œç¨‹",
    instruction=(
        "æ‚¨æ˜¯æ—…éŠè¦åŠƒå¸«ã€‚è«‹çµåˆä»¥ä¸‹æœå°‹çµæœï¼Œå»ºç«‹ä¸€ä»½çµ„ç¹”è‰¯å¥½çš„å®Œæ•´è¡Œç¨‹ã€‚\n"
        "**å¯ç”¨èˆªç­:**\n{flight_options}\n"
        "**å¯ç”¨é£¯åº—:**\n{hotel_options}\n"
        "**æ¨è–¦æ´»å‹•:**\n{activity_options}\n"
        "è«‹å»ºç«‹ä¸€ä»½æ ¼å¼åŒ–çš„è¡Œç¨‹..."
    ),
    output_key="final_itinerary"
)

# ============================================================================
# å®Œæ•´çš„æ‰‡å‡º/æ”¶é›†ç®¡ç·š
# ============================================================================

travel_planning_system = SequentialAgent(
    name="TravelPlanningSystem",
    sub_agents=[
        parallel_search,     # æ­¥é©Ÿ 1ï¼šå¹³è¡Œæ”¶é›†è³‡æ–™ (å¿«é€Ÿ!)
        itinerary_builder    # æ­¥é©Ÿ 2ï¼šåˆä½µçµæœ (ç¶œåˆ)
    ],
    description="å®Œæ•´çš„æ—…éŠè¦åŠƒç³»çµ±"
)

root_agent = travel_planning_system
```

### ç¨‹å¼ç¢¼è§£æ

**æ‰‡å‡º/æ”¶é›†æµç¨‹ï¼š**

1.  **ä½¿ç”¨è€…è¼¸å…¥**ï¼š"Plan a trip to Tokyo for 5 days"
2.  **`ParallelAgent` å•Ÿå‹•**ï¼š3 å€‹ä»£ç†åŒæ™‚åŸ·è¡Œã€‚
    *   `flight_finder` â†’ æœå°‹èˆªç­ â†’ å­˜å…¥ `state['flight_options']`
    *   `hotel_finder` â†’ æœå°‹é£¯åº— â†’ å­˜å…¥ `state['hotel_options']`
    *   `activity_finder` â†’ å°‹æ‰¾æ´»å‹• â†’ å­˜å…¥ `state['activity_options']`
3.  **`ParallelAgent` å®Œæˆ**ï¼šç­‰å¾…æ‰€æœ‰ä»£ç†å®Œæˆã€‚
4.  **`itinerary_builder` åŸ·è¡Œ**ï¼šå¾ `state` è®€å– 3 å€‹éµçš„è³‡æ–™ã€‚
5.  **æœ€çµ‚è¼¸å‡º**ï¼šå®Œæ•´çš„æ—…éŠè¡Œç¨‹ã€‚

## æ­¥é©Ÿ 4ï¼šåŸ·è¡Œæ—…éŠè¦åŠƒå™¨

### ä½¿ç”¨å·¥ä½œå¯¦ç¾

```bash
# å¾ tutorial_implementation/tutorial05/
make dev
```

é–‹å•Ÿ `http://localhost:8000` ä¸¦é¸æ“‡ "travel_planner"ã€‚

### å˜—è©¦ä»¥ä¸‹æç¤º

*   `Plan a 3-day trip to Paris`
*   `I need a 5-day Tokyo trip for 2 people. Budget-friendly options preferred.`
*   `Weekend getaway to New York. Looking for cultural activities and good restaurants.`

## äº†è§£å¹³è¡ŒåŸ·è¡Œ

åœ¨ **Events** æ¨™ç±¤é ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼š

1.  `ParallelAgent` å•Ÿå‹•ã€‚
2.  `flight_finder`, `hotel_finder`, `activity_finder` **åŒæ™‚**å•Ÿå‹•ã€‚
3.  å„ä»£ç†å®Œæˆå¾Œï¼Œå°‡çµæœå­˜å…¥ `state`ã€‚
4.  `ParallelAgent` åœ¨æ‰€æœ‰å­ä»£ç†å®Œæˆå¾ŒçµæŸã€‚
5.  `itinerary_builder` å•Ÿå‹•ï¼Œä¸¦æ³¨å…¥æ‰€æœ‰éœ€è¦çš„è³‡æ–™ã€‚
6.  `itinerary_builder` å®Œæˆï¼Œè¼¸å‡ºæœ€çµ‚çµæœã€‚

## é—œéµè¦é»

*   âœ… **`ParallelAgent`** åŒæ™‚åŸ·è¡Œå­ä»£ç†ï¼Œå¤§å¹…æå‡é€Ÿåº¦ã€‚
*   âœ… é©ç”¨æ–¼**ç¨ç«‹ä»»å‹™**ã€‚
*   âœ… **æ‰‡å‡º/æ”¶é›†**æ˜¯æ ¸å¿ƒæ¨¡å¼ï¼šå¹³è¡ŒåŠ é€Ÿï¼Œå¾ªåºç¶œåˆã€‚
*   âœ… çµåˆ `SequentialAgent` ä»¥ç™¼æ®å…©è€…å„ªå‹¢ã€‚
*   âœ… å¯åœ¨ **Events** æ¨™ç±¤é ä¸­é©—è­‰å¹³è¡ŒåŸ·è¡Œã€‚

## æœ€ä½³å¯¦è¸

**æ‡‰åšï¼š**

*   ç”¨æ–¼ I/O å¯†é›†å‹ä»»å‹™ï¼ˆAPI å‘¼å«ã€ç¶²é æœå°‹ï¼‰ã€‚
*   ä¿æŒå­ä»£ç†ç¨ç«‹ã€‚
*   çµåˆ `SequentialAgent` é€²è¡Œåˆä½µã€‚
*   ä½¿ç”¨æè¿°æ€§çš„ `output_keys`ã€‚

**ä¸æ‡‰åšï¼š**

*   ç”¨æ–¼ä»£ç†ä¹‹é–“æœ‰ä¾è³´æ€§çš„ä»»å‹™ï¼ˆæ‡‰ä½¿ç”¨ `Sequential`ï¼‰ã€‚
*   å‡è¨­å¹³è¡Œå€å¡Šå…§çš„åŸ·è¡Œé †åºã€‚
*   å¿˜è¨˜åˆä½µæ­¥é©Ÿã€‚

## çœŸå¯¦ä¸–ç•Œæ‡‰ç”¨

*   **è³‡æ–™æ”¶é›†**ï¼šåŒæ™‚æœå°‹å¤šå€‹ API/è³‡æ–™åº«ã€‚
*   **å…§å®¹å‰µä½œ**ï¼šåŒæ™‚ç”Ÿæˆå¤šå€‹ç‰ˆæœ¬ã€‚
*   **åˆ†æ**ï¼šå°ç›¸åŒè³‡æ–™ä¸¦è¡Œé‹è¡Œä¸åŒåˆ†æã€‚
*   **å¤šæºç ”ç©¶**ï¼šå­¸è¡“ã€æ–°èã€ç¤¾ç¾¤åª’é«”ã€‚
*   **æ¯”åƒ¹è³¼ç‰©**ï¼šå¾ä¸åŒä¾†æºç²å–åƒ¹æ ¼ã€è©•è«–ã€‚

## ä¸‹ä¸€æ­¥

ğŸš€ **æ•™å­¸ 06ï¼šå¤šä»£ç†ç³»çµ±** - çµåˆå¾ªåºå’Œå¹³è¡Œæ¨¡å¼ï¼Œæ‰“é€ æ›´è¤‡é›œçš„å·¥ä½œæµç¨‹ã€‚

.PHONY: help setup clean test demo dev

help:
	@echo "Context Compaction TIL - å¯ç”¨æŒ‡ä»¤"
	@echo "==========================================="
	@echo ""
	@echo "make setup       å®‰è£ä¾è³´ä¸¦æº–å‚™ç’°å¢ƒ"
	@echo "make test        åŸ·è¡Œå–®å…ƒæ¸¬è©¦ (é©—è­‰é…ç½®)"
	@echo "make dev         å•Ÿå‹• ADK ç¶²é ä»‹é¢ä»¥æŸ¥çœ‹å£“ç¸®é‹ä½œæƒ…å½¢"
	@echo "make demo        ä¸é€éç¶²é ä»‹é¢çš„å¿«é€Ÿé©—è­‰"
	@echo "make clean       ç§»é™¤å¿«å–æª”æ¡ˆèˆ‡ç”¢ç‰©"
	@echo ""

setup:
	pip install -r requirements.txt
	pip install -e .
	cp context_compaction_agent/.env.example context_compaction_agent/.env
	@echo ""
	@echo "âœ… è¨­å®šå®Œæˆï¼"
	@echo ""
	@echo "ä¸‹ä¸€æ­¥ï¼š"
	@echo "1. æ–°å¢æ‚¨çš„ GOOGLE_API_KEY åˆ° context_compaction_agent/.env"
	@echo "2. åŸ·è¡Œ 'make test' ä»¥é©—è­‰å¯¦ä½œ"
	@echo "3. åŸ·è¡Œ 'make dev' ä»¥å•Ÿå‹•ç¶²é ä»‹é¢ä¸¦æ¸¬è©¦å£“ç¸®åŠŸèƒ½"
	@echo ""

dev:
	@echo ""
	@echo "ğŸš€ æ­£åœ¨å•Ÿå‹• ADK ç¶²é ä»‹é¢..."
	@echo ""
	@echo "ğŸ“ å¦‚ä½•æ¸¬è©¦ä¸Šä¸‹æ–‡å£“ç¸® (Context Compaction)ï¼š"
	@echo "   1. é–‹å•Ÿ http://localhost:8000"
	@echo "   2. é¸æ“‡ 'context_compaction_agent'"
	@echo "   3. å‚³é€ 5 å‰‡ä»¥ä¸Šçš„è¨Šæ¯ä»¥è§¸ç™¼å£“ç¸®"
	@echo "   4. åœ¨å›æ‡‰ä¸­æª¢æŸ¥æ¯å€‹å›æ‡‰çš„ token è¨ˆæ•¸"
	@echo ""
	@echo "ğŸ’¡ Token å¢é•·æ¨¡å¼ï¼š"
	@echo "   â€¢ ç„¡å£“ç¸®ï¼šæ¯æ¬¡äº’å‹•ç´„ 180 tokens"
	@echo "   â€¢ æœ‰å£“ç¸®ï¼šæ¯æ¬¡äº’å‹•ç´„ 50-60 tokens"
	@echo "   â€¢ è§€å¯Ÿ 5 æ¬¡äº’å‹•å¾Œçš„ç©©å®šæƒ…æ³ âœ…"
	@echo ""
	@echo "ğŸ¯ é æœŸ Token é€²ç¨‹ï¼š"
	@echo "   è¨Šæ¯ 1: ~180 | è¨Šæ¯ 2: ~243 | è¨Šæ¯ 3: ~295"
	@echo "   è¨Šæ¯ 4: ~347 | è¨Šæ¯ 5: ~405 â† è§¸ç™¼å£“ç¸®ï¼"
	@echo ""
	adk web

test:
	@echo ""
	@echo "ğŸ§ª æ­£åœ¨åŸ·è¡Œä¸Šä¸‹æ–‡å£“ç¸®æ¸¬è©¦..."
	@echo ""
	@pytest tests/ -v --tb=short
	@echo ""
	@echo "âœ… æ¸¬è©¦é©—è­‰é …ç›®ï¼š"
	@echo "   â€¢ ä»£ç†é…ç½® (7 é …æ¸¬è©¦)"
	@echo "   â€¢ å·¥å…·åŠŸèƒ½ (5 é …æ¸¬è©¦)"
	@echo "   â€¢ åŒ¯å…¥è·¯å¾‘ (3 é …æ¸¬è©¦)"
	@echo "   â€¢ æ‡‰ç”¨ç¨‹å¼èˆ‡å£“ç¸®è¨­å®š (4 é …æ¸¬è©¦)"
	@echo ""

demo:
	@echo ""
	@echo "ğŸ” å¿«é€Ÿé©—è­‰..."
	python -c "from context_compaction_agent import root_agent; from app import app; print('âœ… ä»£ç†å·²è¼‰å…¥:', root_agent.name); print('âœ… æ‡‰ç”¨ç¨‹å¼å·²é…ç½®:', app.name); print('âœ… å£“ç¸®å·²å•Ÿç”¨:', app.events_compaction_config is not None)"
	@echo ""
	@echo "ğŸ¯ å¯¦ä½œå·²å°±ç·’ï¼"
	@echo ""

clean:
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	rm -rf .coverage htmlcov build dist *.egg-info
	@echo "âœ… å·²æ¸…é™¤å¿«å–æª”æ¡ˆ"

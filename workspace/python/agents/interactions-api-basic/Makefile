# .PHONY å®£å‘Šé€™äº›ç›®æ¨™ç‚º "å½ç›®æ¨™"ï¼Œç¢ºä¿å³ä½¿å­˜åœ¨åŒåæª”æ¡ˆï¼Œmake ä¹ŸæœƒåŸ·è¡ŒæŒ‡ä»¤
.PHONY: help setup clean test demo dev

# help ç›®æ¨™ï¼šé¡¯ç¤ºæ‰€æœ‰å¯ç”¨çš„æŒ‡ä»¤èªªæ˜
help:
	@echo "Interactions API åŸºç¤ - å¯ç”¨æŒ‡ä»¤"
	@echo "============================================"
	@echo ""
	@echo "make setup       å®‰è£ä¾è³´ä¸¦æº–å‚™ç’°å¢ƒ"
	@echo "make test        åŸ·è¡Œå–®å…ƒæ¸¬è©¦"
	@echo "make demo        åŸ·è¡Œäº’å‹•å¼ç¤ºç¯„"
	@echo "make clean       ç§»é™¤å¿«å–æª”æ¡ˆå’Œå»ºç½®ç”¢ç‰©"
	@echo ""

# setup ç›®æ¨™ï¼šå®‰è£å°ˆæ¡ˆæ‰€éœ€çš„ä¾è³´å¥—ä»¶ä¸¦è¨­å®šç’°å¢ƒ
setup:
	# å¾ requirements.txt å®‰è£ Python ä¾è³´
	pip install -r requirements.txt
	# ä»¥å¯ç·¨è¼¯æ¨¡å¼å®‰è£ç›®å‰å°ˆæ¡ˆï¼Œä½¿å…¶å¯è¢«åŒ¯å…¥
	pip install -e .
	# è¤‡è£½ .env.example æª”æ¡ˆç‚º .envï¼Œå¦‚æœ .env å·²å­˜åœ¨å‰‡å¿½ç•¥
	cp interactions_basic_agent/.env.example interactions_basic_agent/.env 2>/dev/null || true
	@echo ""
	@echo "âœ… è¨­å®šå®Œæˆï¼"
	@echo ""
	@echo "å¾ŒçºŒæ­¥é©Ÿï¼š"
	@echo "1. å°‡æ‚¨çš„ GOOGLE_API_KEY åŠ å…¥åˆ° interactions_basic_agent/.env æª”æ¡ˆä¸­"
	@echo "   æˆ–è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š export GOOGLE_API_KEY='your-key-here'"
	@echo "2. åŸ·è¡Œ 'make test' ä¾†é©—è­‰å¯¦ä½œ"
	@echo "3. åŸ·è¡Œ 'make demo' ä¾†æŸ¥çœ‹ Interactions API çš„å¯¦éš›é‹ä½œ"
	@echo ""

# test ç›®æ¨™ï¼šåŸ·è¡Œå–®å…ƒæ¸¬è©¦
test:
	@echo ""
	@echo "ğŸ§ª æ­£åœ¨åŸ·è¡Œ Interactions API æ¸¬è©¦..."
	@echo ""
	# ä½¿ç”¨ pytest åŸ·è¡Œ tests/ ç›®éŒ„ä¸‹çš„æ‰€æœ‰æ¸¬è©¦ï¼Œä¸¦é¡¯ç¤ºè©³ç´°è³‡è¨Š
	@pytest tests/ -v --tb=short
	@echo ""
	@echo "âœ… æ¸¬è©¦é©—è­‰äº†ï¼š"
	@echo "   â€¢ API å®¢æˆ¶ç«¯è¨­å®š"
	@echo "   â€¢ å·¥å…·å®šç¾©"
	@echo "   â€¢ åŒ¯å…¥è·¯å¾‘"
	@echo ""

# demo ç›®æ¨™ï¼šåŸ·è¡Œäº’å‹•å¼ç¤ºç¯„ç¨‹å¼
demo:
	@echo ""
	@echo "ğŸš€ æ­£åœ¨åŸ·è¡Œ Interactions API ç¤ºç¯„..."
	@echo ""
	@echo "æ­¤ç¤ºç¯„å°‡å±•ç¤ºï¼š"
	@echo "  1. åŸºæœ¬çš„æ–‡å­—äº’å‹•"
	@echo "  2. ä½¿ç”¨ previous_interaction_id çš„æœ‰ç‹€æ…‹å°è©±"
	@echo "  3. ä¸²æµå¼å›æ‡‰ (Streaming responses)"
	@echo "  4. å‡½å¼å‘¼å« (Function calling)"
	@echo ""
	# åŸ·è¡Œ demo ä¸»ç¨‹å¼
	python -m interactions_basic_agent.demo
	@echo ""

# clean ç›®æ¨™ï¼šæ¸…é™¤å°ˆæ¡ˆä¸­ç”¢ç”Ÿçš„å¿«å–å’Œå»ºç½®æª”æ¡ˆ
clean:
	# å°‹æ‰¾ä¸¦åˆªé™¤æ‰€æœ‰ __pycache__ ç›®éŒ„
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	# å°‹æ‰¾ä¸¦åˆªé™¤ .pytest_cache ç›®éŒ„
	find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	# å°‹æ‰¾ä¸¦åˆªé™¤æ‰€æœ‰ .pyc æª”æ¡ˆ
	find . -type f -name "*.pyc" -delete
	# åˆªé™¤å…¶ä»–å»ºç½®ç”¢ç‰©å’Œæš«å­˜æª”æ¡ˆ
	rm -rf .coverage htmlcov build dist *.egg-info
	@echo "âœ… å·²æ¸…é™¤å¿«å–æª”æ¡ˆ"

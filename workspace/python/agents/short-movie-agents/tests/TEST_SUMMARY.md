# Short Movie Agents æ¸¬è©¦æ¡ˆä¾‹å»ºç«‹æ‘˜è¦

## ğŸ“‹ æ¸¬è©¦æ¶æ§‹åˆ†æ

### Pack Deep Search æ¸¬è©¦çµæ§‹åˆ†æ

å¾ `pack-deep-search` å°ˆæ¡ˆçš„æ¸¬è©¦çµæ§‹ä¸­ï¼Œæˆ‘å€‘è­˜åˆ¥å‡ºä»¥ä¸‹æœ€ä½³å¯¦è¸ï¼š

#### æ¸¬è©¦çµ„ç¹”çµæ§‹
```
tests/
â”œâ”€â”€ unit/              # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ test_imports.py       # åŒ¯å…¥é©—è­‰
â”‚   â”œâ”€â”€ test_structure.py     # æª”æ¡ˆçµæ§‹é©—è­‰
â”‚   â”œâ”€â”€ test_agent.py         # Agent é…ç½®æ¸¬è©¦
â”‚   â”œâ”€â”€ test_config.py        # é…ç½®æ¸¬è©¦
â”‚   â”œâ”€â”€ test_models.py        # Pydantic æ¨¡å‹æ¸¬è©¦
â”‚   â””â”€â”€ test_callbacks.py     # å›èª¿å‡½å¼æ¸¬è©¦
â”œâ”€â”€ integration/       # æ•´åˆæ¸¬è©¦
â”‚   â”œâ”€â”€ test_agent.py         # Agent åŸ·è¡Œæ¸¬è©¦
â”‚   â””â”€â”€ test_server_e2e.py    # ç«¯å°ç«¯æ¸¬è©¦
â””â”€â”€ load_test/         # è² è¼‰æ¸¬è©¦
    â””â”€â”€ load_test.py
```

#### æ ¸å¿ƒæ¸¬è©¦æ¨¡å¼
1. **åŒ¯å…¥æ¸¬è©¦** - ç¢ºä¿æ‰€æœ‰æ¨¡çµ„å¯æ­£ç¢ºåŒ¯å…¥
2. **çµæ§‹æ¸¬è©¦** - é©—è­‰å°ˆæ¡ˆæª”æ¡ˆå®Œæ•´æ€§
3. **é…ç½®æ¸¬è©¦** - æ¸¬è©¦ Agent é…ç½®æ­£ç¢ºæ€§
4. **åŠŸèƒ½æ¸¬è©¦** - æ¸¬è©¦å·¥å…·å’Œå›èª¿å‡½å¼
5. **æ•´åˆæ¸¬è©¦** - æ¸¬è©¦å®Œæ•´åŸ·è¡Œæµç¨‹

---

## ğŸ¯ Short Movie Agents æ¸¬è©¦æ¡ˆä¾‹

æ ¹æ“šåˆ†æçµæœï¼Œç‚º `short-movie-agents` å»ºç«‹äº†å®Œæ•´çš„æ¸¬è©¦å¥—ä»¶ï¼š

### å·²å»ºç«‹çš„æ¸¬è©¦æª”æ¡ˆ

#### ğŸ“ å–®å…ƒæ¸¬è©¦ (tests/unit/)

1. **test_imports.py** (140 è¡Œ)
   - âœ… æ¸¬è©¦ä¸»æ¨¡çµ„åŒ¯å…¥
   - âœ… æ¸¬è©¦æ‰€æœ‰å­ Agent åŒ¯å…¥
   - âœ… æ¸¬è©¦å·¥å…·æ¨¡çµ„åŒ¯å…¥
   - âœ… æ¸¬è©¦ Pydantic æ¨¡å‹åŒ¯å…¥
   - âœ… æ¸¬è©¦æ‰€æœ‰ç›¸ä¾å¥—ä»¶åŒ¯å…¥
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 1 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 16 å€‹

2. **test_structure.py** (143 è¡Œ)
   - âœ… æ¸¬è©¦å°ˆæ¡ˆç›®éŒ„çµæ§‹
   - âœ… æ¸¬è©¦æ‰€æœ‰å¿…è¦æª”æ¡ˆå­˜åœ¨
   - âœ… æ¸¬è©¦æç¤ºè©æª”æ¡ˆå­˜åœ¨
   - âœ… æ¸¬è©¦é…ç½®æª”æ¡ˆå…§å®¹
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 2 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 15 å€‹

3. **test_agent.py** (247 è¡Œ)
   - âœ… æ¸¬è©¦ Director Agent é…ç½®
   - âœ… æ¸¬è©¦ Story Agent é…ç½®
   - âœ… æ¸¬è©¦ Screenplay Agent é…ç½®
   - âœ… æ¸¬è©¦ Storyboard Agent é…ç½®
   - âœ… æ¸¬è©¦ Video Agent é…ç½®
   - âœ… æ¸¬è©¦ Agent æ•´åˆ
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 6 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 31 å€‹

4. **test_models.py** (148 è¡Œ)
   - âœ… æ¸¬è©¦ Request Pydantic æ¨¡å‹
   - âœ… æ¸¬è©¦ Feedback Pydantic æ¨¡å‹
   - âœ… æ¸¬è©¦è³‡æ–™é©—è­‰é‚è¼¯
   - âœ… æ¸¬è©¦é è¨­å€¼è¨­å®š
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 2 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 15 å€‹

5. **test_utils.py** (153 è¡Œ)
   - âœ… æ¸¬è©¦ load_prompt_from_file å‡½å¼
   - âœ… æ¸¬è©¦ create_bucket_if_not_exists å‡½å¼
   - âœ… æ¸¬è©¦ CloudTraceLoggingSpanExporter é¡åˆ¥
   - âœ… ä½¿ç”¨ mock éš”é›¢å¤–éƒ¨æœå‹™
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 3 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 12 å€‹

6. **test_tools.py** (217 è¡Œ)
   - âœ… æ¸¬è©¦ storyboard_generate å·¥å…·
   - âœ… æ¸¬è©¦ video_generate å·¥å…·
   - âœ… æ¸¬è©¦éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
   - âœ… æ¸¬è©¦ GCS è·¯å¾‘ç”Ÿæˆ
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 2 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 12 å€‹

#### ğŸ“ æ•´åˆæ¸¬è©¦ (tests/integration/)

1. **test_agent.py** (118 è¡Œ)
   - âœ… æ¸¬è©¦ Agent ä¸²æµåŠŸèƒ½
   - âœ… æ¸¬è©¦ Agent ç°¡å–®åŸ·è¡Œ
   - âœ… æ¸¬è©¦æœƒè©±ç‹€æ…‹ç®¡ç†
   - **æ¸¬è©¦å‡½å¼ï¼š** 3 å€‹

2. **test_server_e2e.py** (209 è¡Œ)
   - âœ… æ¸¬è©¦ FastAPI ä¼ºæœå™¨å•Ÿå‹•
   - âœ… æ¸¬è©¦å¥åº·æª¢æŸ¥ç«¯é»
   - âœ… æ¸¬è©¦å›é¥‹æ”¶é›†ç«¯é»
   - âœ… æ¸¬è©¦ä¼ºæœå™¨é…ç½®
   - **æ¸¬è©¦é¡åˆ¥ï¼š** 3 å€‹
   - **æ¸¬è©¦å‡½å¼ï¼š** 6 å€‹

#### ğŸ“ æ¸¬è©¦é…ç½®

1. **conftest.py** (147 è¡Œ)
   - âœ… Pytest é…ç½®èˆ‡æ¨™è¨˜
   - âœ… å…±ç”¨ fixtures (15 å€‹)
   - âœ… Mock å·¥å…·
   - âœ… æ¸¬è©¦è³‡æ–™ç”Ÿæˆå™¨

2. **tests/README.md** (393 è¡Œ)
   - âœ… å®Œæ•´çš„æ¸¬è©¦æ–‡ä»¶
   - âœ… åŸ·è¡ŒæŒ‡ä»¤èªªæ˜
   - âœ… æ¸¬è©¦æ¶µè“‹ç¯„åœèªªæ˜
   - âœ… é™¤éŒ¯æŠ€å·§

---

## ğŸ“Š æ¸¬è©¦çµ±è¨ˆ

### æ¸¬è©¦æª”æ¡ˆæ•¸é‡
- å–®å…ƒæ¸¬è©¦æª”æ¡ˆï¼š6 å€‹
- æ•´åˆæ¸¬è©¦æª”æ¡ˆï¼š2 å€‹
- é…ç½®æª”æ¡ˆï¼š1 å€‹
- æ–‡ä»¶æª”æ¡ˆï¼š1 å€‹
- **ç¸½è¨ˆï¼š10 å€‹æª”æ¡ˆ**

### æ¸¬è©¦æ¡ˆä¾‹æ•¸é‡
- å–®å…ƒæ¸¬è©¦å‡½å¼ï¼š101 å€‹
- æ•´åˆæ¸¬è©¦å‡½å¼ï¼š9 å€‹
- **ç¸½è¨ˆï¼š110 å€‹æ¸¬è©¦å‡½å¼**

### ç¨‹å¼ç¢¼è¡Œæ•¸
- å–®å…ƒæ¸¬è©¦ï¼š~1,048 è¡Œ
- æ•´åˆæ¸¬è©¦ï¼š~327 è¡Œ
- é…ç½®èˆ‡æ–‡ä»¶ï¼š~540 è¡Œ
- **ç¸½è¨ˆï¼š~1,915 è¡Œ**

---

## ğŸ¯ æ¸¬è©¦æ¶µè“‹çš„åŠŸèƒ½æ¨¡çµ„

### âœ… æ ¸å¿ƒ Agent
- [x] Director Agent (root_agent)
- [x] Story Agent
- [x] Screenplay Agent
- [x] Storyboard Agent
- [x] Video Agent

### âœ… å·¥å…·å‡½å¼
- [x] storyboard_generate
- [x] video_generate
- [x] load_prompt_from_file
- [x] create_bucket_if_not_exists

### âœ… è³‡æ–™æ¨¡å‹
- [x] Request æ¨¡å‹
- [x] Feedback æ¨¡å‹

### âœ… ä¼ºæœå™¨åŠŸèƒ½
- [x] FastAPI ä¼ºæœå™¨å•Ÿå‹•
- [x] å›é¥‹æ”¶é›†ç«¯é»
- [x] å¥åº·æª¢æŸ¥
- [x] OpenAPI è¦æ ¼

### âœ… æ•´åˆåŠŸèƒ½
- [x] Agent ä¸²æµåŸ·è¡Œ
- [x] æœƒè©±ç®¡ç†
- [x] ç«¯å°ç«¯æµç¨‹

---

## ğŸ› ï¸ ä½¿ç”¨çš„æ¸¬è©¦æŠ€è¡“

### Mock æŠ€è¡“
- `unittest.mock.Mock` - åŸºæœ¬ mock
- `unittest.mock.MagicMock` - é€²éš mock
- `unittest.mock.patch` - ä¿®è£œå‡½å¼/é¡åˆ¥
- `@patch.dict` - ç’°å¢ƒè®Šæ•¸ mock

### Pytest åŠŸèƒ½
- Fixtures - å…±ç”¨æ¸¬è©¦è³‡æ–™
- Markers - æ¸¬è©¦åˆ†é¡
- Parametrize - åƒæ•¸åŒ–æ¸¬è©¦
- Autouse fixtures - è‡ªå‹•åŸ·è¡Œ fixtures

### å¤–éƒ¨æœå‹™ Mock
- Vertex AI å½±åƒç”Ÿæˆ API
- Veo å½±ç‰‡ç”Ÿæˆ API
- Google Cloud Storage
- Google Cloud Logging
- OpenTelemetry Tracing

---

## ğŸ“‹ æ¸¬è©¦åŸ·è¡ŒæŒ‡ä»¤

### åŸºæœ¬åŸ·è¡Œ
```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest

# åŸ·è¡Œå–®å…ƒæ¸¬è©¦
pytest tests/unit/

# åŸ·è¡Œæ•´åˆæ¸¬è©¦
pytest tests/integration/

# è©³ç´°è¼¸å‡º
pytest -v
```

### æ¶µè“‹ç‡æ¸¬è©¦
```bash
# ç”¢ç”Ÿæ¶µè“‹ç‡å ±å‘Š
pytest --cov=app --cov-report=html --cov-report=term

# æŸ¥çœ‹ HTML å ±å‘Š
open htmlcov/index.html
```

### ç‰¹å®šæ¸¬è©¦
```bash
# åŸ·è¡Œç‰¹å®šæª”æ¡ˆ
pytest tests/unit/test_agent.py

# åŸ·è¡Œç‰¹å®šé¡åˆ¥
pytest tests/unit/test_agent.py::TestStoryAgent

# åŸ·è¡Œç‰¹å®šå‡½å¼
pytest tests/unit/test_agent.py::TestStoryAgent::test_story_agent_exists
```

---

## âœ… æ¸¬è©¦å“è³ªæŒ‡æ¨™

### æ¸¬è©¦æ¶µè“‹ç‡ç›®æ¨™
- æ ¸å¿ƒåŠŸèƒ½ï¼šâ‰¥ 90%
- å·¥å…·å‡½å¼ï¼šâ‰¥ 80%
- æ•´é«”å°ˆæ¡ˆï¼šâ‰¥ 70%

### æ¸¬è©¦åŸå‰‡
1. âœ… **ç¨ç«‹æ€§** - æ¯å€‹æ¸¬è©¦ç¨ç«‹é‹ä½œ
2. âœ… **å¯é‡è¤‡æ€§** - æ¸¬è©¦çµæœå¯é‡è¤‡
3. âœ… **éš”é›¢æ€§** - ä½¿ç”¨ mock éš”é›¢å¤–éƒ¨æœå‹™
4. âœ… **æ¸…æ™°æ€§** - æ¸¬è©¦å‘½åæè¿°æ€§å¼·
5. âœ… **å®Œæ•´æ€§** - æ¶µè“‹æ­£å¸¸èˆ‡ç•°å¸¸æƒ…æ³

### å‘½åæ…£ä¾‹
- æ¸¬è©¦æª”æ¡ˆï¼š`test_<module>.py`
- æ¸¬è©¦é¡åˆ¥ï¼š`Test<Feature>`
- æ¸¬è©¦å‡½å¼ï¼š`test_<what_is_being_tested>`

---

## ğŸš€ å¾ŒçºŒæ”¹é€²å»ºè­°

### å¯é¸çš„é€²éšæ¸¬è©¦

1. **è² è¼‰æ¸¬è©¦**
   ```python
   # tests/load_test/load_test.py
   # æ¸¬è©¦ç³»çµ±åœ¨é«˜è² è¼‰ä¸‹çš„è¡¨ç¾
   ```

2. **æ•ˆèƒ½æ¸¬è©¦**
   ```python
   # tests/performance/test_performance.py
   # æ¸¬è©¦é—œéµè·¯å¾‘çš„åŸ·è¡Œæ™‚é–“
   ```

3. **å¤šæ¨¡æ…‹æ¸¬è©¦**
   ```python
   # tests/multimodal/test_image_generation.py
   # tests/multimodal/test_video_generation.py
   # æ¸¬è©¦å½±åƒå’Œå½±ç‰‡ç”Ÿæˆçš„çœŸå¯¦å ´æ™¯
   ```

4. **å®‰å…¨æ€§æ¸¬è©¦**
   ```python
   # tests/security/test_input_validation.py
   # æ¸¬è©¦è¼¸å…¥é©—è­‰å’Œå®‰å…¨æ€§
   ```

### CI/CD æ•´åˆ

å»ºè­°åœ¨ `.github/workflows/test.yml` ä¸­åŠ å…¥ï¼š

```yaml
name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.13'
      - run: pip install -r requirements.txt
      - run: pytest --cov --cov-report=xml
      - uses: codecov/codecov-action@v3
```

---

## ğŸ“ çµè«–

å·²æˆåŠŸç‚º `short-movie-agents` å»ºç«‹å®Œæ•´çš„æ¸¬è©¦å¥—ä»¶ï¼ŒåŒ…æ‹¬ï¼š

âœ… **å®Œæ•´çš„å–®å…ƒæ¸¬è©¦** - æ¶µè“‹æ‰€æœ‰æ ¸å¿ƒæ¨¡çµ„
âœ… **æ•´åˆæ¸¬è©¦** - é©—è­‰ç«¯å°ç«¯æµç¨‹
âœ… **æ¸¬è©¦é…ç½®** - æä¾›å…±ç”¨ fixtures å’Œé…ç½®
âœ… **è©³ç´°æ–‡ä»¶** - åŒ…å«ä½¿ç”¨æŒ‡å—å’Œæœ€ä½³å¯¦è¸

æ¸¬è©¦å¥—ä»¶éµå¾ªæ¥­ç•Œæœ€ä½³å¯¦è¸ï¼Œä½¿ç”¨é©ç•¶çš„ mock æŠ€è¡“éš”é›¢å¤–éƒ¨æœå‹™ï¼Œæä¾›æ¸…æ™°çš„æ¸¬è©¦çµæ§‹å’Œå‘½åï¼Œä¸¦åŒ…å«å®Œæ•´çš„æ–‡ä»¶èªªæ˜ã€‚

---

**å»ºç«‹æ—¥æœŸï¼š** 2026 å¹´ 1 æœˆ 28 æ—¥
**ç¸½æ¸¬è©¦æ•¸é‡ï¼š** 110 å€‹æ¸¬è©¦å‡½å¼
**ç¸½ç¨‹å¼ç¢¼è¡Œæ•¸ï¼š** ~1,915 è¡Œ

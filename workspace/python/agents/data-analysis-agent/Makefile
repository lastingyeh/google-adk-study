# é‡é»æ‘˜è¦
# - æ ¸å¿ƒæ¦‚å¿µï¼šè‡ªå‹•åŒ–ç®¡ç†å°ˆæ¡ˆä»»å‹™çš„ Makefileã€‚
# - é—œéµæŠ€è¡“ï¼šMake, Python venv/pip ç®¡ç†ã€‚
# - é‡è¦çµè«–ï¼šç°¡åŒ–äº†å®‰è£ã€é–‹ç™¼ã€æ¸¬è©¦å’Œæ¸…ç†çš„æµç¨‹ã€‚
# - è¡Œå‹•é …ç›®ï¼šä½¿ç”¨ make setup å®‰è£ï¼Œmake dev å•Ÿå‹•ã€‚

.PHONY: help setup dev demo test clean lint format

help:
	@echo "è³‡æ–™åˆ†æä»£ç† (Streamlit ç‰ˆ) - å¯ç”¨æŒ‡ä»¤"
	@echo ""
	@echo "è¨­å®šèˆ‡å®‰è£:"
	@echo "  make setup              å®‰è£ä¾è³´é …èˆ‡å¥—ä»¶"
	@echo ""
	@echo "é–‹ç™¼:"
	@echo "  make dev                åŸ·è¡Œ Streamlit æ‡‰ç”¨ç¨‹å¼ (localhost:8501)"
	@echo "  make demo               é¡¯ç¤ºç¯„ä¾‹æç¤ºè©èˆ‡ç”¨æ³•ç¯„ä¾‹"
	@echo ""
	@echo "æ¸¬è©¦èˆ‡å“è³ª:"
	@echo "  make test               åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ä¸¦åŒ…å«è¦†è“‹ç‡å ±å‘Š"
	@echo "  make lint               æª¢æŸ¥ç¨‹å¼ç¢¼å“è³ª"
	@echo "  make format             ä½¿ç”¨ black å’Œ isort æ ¼å¼åŒ–ç¨‹å¼ç¢¼"
	@echo ""
	@echo "æ¸…ç†:"
	@echo "  make clean              ç§»é™¤å¿«å–èˆ‡ç”Ÿæˆçš„æª”æ¡ˆ"

setup:
	pip install --upgrade pip
	pip install -r requirements.txt
	pip install -e .
	@echo "âœ… è¨­å®šå®Œæˆï¼æ¥ä¸‹ä¾†çš„æ­¥é©Ÿï¼š"
	@echo "   1. è¤‡è£½ .env.example åˆ° .env"
	@echo "   2. å°‡æ‚¨çš„ GOOGLE_API_KEY æ–°å¢è‡³ .env"
	@echo "   3. åŸ·è¡Œ: make dev"

dev:
	@if [ ! -f .env ]; then \
		echo "âŒ æ‰¾ä¸åˆ° .env æª”æ¡ˆï¼"; \
		echo "è«‹å¾ .env.example å»ºç«‹ .env ä¸¦æ–°å¢æ‚¨çš„ GOOGLE_API_KEY"; \
		exit 1; \
	fi
	streamlit run app.py

demo:
	@echo "ğŸ“Š è³‡æ–™åˆ†æä»£ç†å±•ç¤º"
	@echo ""
	@echo "æœ¬æ•™å­¸å±•ç¤ºï¼š"
	@echo "  â€¢ ç”¨æ–¼äº’å‹•å¼è³‡æ–™åˆ†æçš„ Streamlit UI"
	@echo "  â€¢ ç›´æ¥ ADK ä»£ç†æ•´åˆï¼ˆç„¡ HTTP é–‹éŠ·ï¼‰"
	@echo "  â€¢ CSV æª”æ¡ˆä¸Šå‚³èˆ‡è³‡æ–™æ¢ç´¢"
	@echo "  â€¢ èˆ‡ Gemini 2.0 Flash é€²è¡Œå³æ™‚èŠå¤©"
	@echo ""
	@echo "ğŸ“ ç¯„ä¾‹è³‡æ–™ï¼š"
	@echo "  å»ºç«‹ä¸€å€‹ç°¡å–®çš„ CSV å¦‚ä¸‹ï¼š"
	@echo "    name,age,salary,department"
	@echo "    Alice,30,75000,Engineering"
	@echo "    Bob,28,68000,Engineering"
	@echo "    Carol,35,82000,Sales"
	@echo ""
	@echo "ğŸ’¬ å˜—è©¦é€™äº›å•é¡Œï¼š"
	@echo "  1. 'é€™ä»½è³‡æ–™çš„ä¸»è¦è¦‹è§£æ˜¯ä»€éº¼ï¼Ÿ'"
	@echo "  2. 'å„éƒ¨é–€çš„å¹³å‡è–ªè³‡æ˜¯å¤šå°‘ï¼Ÿ'"
	@echo "  3. 'é¡¯ç¤ºè³‡æ–™çš„æ‘˜è¦çµ±è¨ˆ'"
	@echo "  4. 'æœ‰ä»»ä½•æ¨¡å¼æˆ–è¶¨å‹¢å—ï¼Ÿ'"
	@echo ""
	@echo "ğŸš€ é–‹å§‹ä½¿ç”¨ï¼š"
	@echo "  1. åŸ·è¡Œ: make dev"
	@echo "  2. ä¸Šå‚³ CSV æª”æ¡ˆ"
	@echo "  3. è©¢å•æœ‰é—œæ‚¨è³‡æ–™çš„å•é¡Œ"

test:
	pytest tests/ -v --tb=short --cov=data_analysis_agent --cov-report=term-missing | cat

lint:
	flake8 data_analysis_agent/ app.py tests/ --max-line-length=100 --count --statistics | cat

format:
	black data_analysis_agent/ app.py tests/
	isort data_analysis_agent/ app.py tests/ --profile black

clean:
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .coverage -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name ".coverage*" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .mypy_cache -exec rm -rf {} + 2>/dev/null || true
	rm -rf build/ dist/ .cache/ .pytest_cache/ htmlcov/ .tox/ *.egg-info/
	@echo "âœ… å·²æ¸…ç†å¿«å–èˆ‡ç”Ÿæˆçš„æª”æ¡ˆ"

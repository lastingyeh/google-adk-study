# ğŸ“Š è³‡æ–™åˆ†æä»£ç†ï¼šStreamlit + ADK

ä½¿ç”¨ç´” Python èˆ‡æ‚¨çš„ CSV è³‡æ–™é€²è¡Œ AI å°è©±ï¼Œç„¡éœ€å¾Œç«¯ã€‚ä¸Šå‚³æª”æ¡ˆï¼Œæå‡ºå•é¡Œï¼Œå³æ™‚ç²å¾—è¦‹è§£èˆ‡ç²¾ç¾åœ–è¡¨ã€‚

**æ‚¨å°‡ç²å¾—**ï¼š
- ğŸ’¬ è‡ªç„¶èªè¨€è³‡æ–™æ¢ç´¢
- ğŸ“ˆ è‡ªå‹•åœ–è¡¨ç”Ÿæˆ
- âš¡ å³æ™‚ä¸²æµå›æ‡‰
- ğŸš€ æ•¸åˆ†é˜å…§å®Œæˆéƒ¨ç½²
- ğŸ”’ å®‰å…¨ï¼ˆAPI é‡‘é‘°åƒ…å­˜åœ¨æ–¼ `.env` ä¸­ï¼‰

## ğŸš€ 2 åˆ†é˜å¿«é€Ÿå…¥é–€

### å‰ç½®éœ€æ±‚
- Python 3.9+
- Google API é‡‘é‘°ï¼ˆå…è²»ï¼‰ï¼Œå¯å¾ [Google AI Studio](https://makersuite.google.com/app/apikey) å–å¾—

### è¨­å®š
```bash
cd tutorial_implementation/tutorial32
make setup              # å®‰è£ä¾è³´é …
cp .env.example .env    # å»ºç«‹è¨­å®šæª”
# å°‡æ‚¨çš„ API é‡‘é‘°æ–°å¢è‡³ .env
make dev                # åœ¨ localhost:8501 å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
```

**å°±é€™æ¨£ï¼** é–‹å•Ÿç€è¦½å™¨ä¸¦é–‹å§‹åˆ†æã€‚ ğŸ“Š

## ğŸ’¡ é‹ä½œåŸç†

### 1. ä¸Šå‚³æ‚¨çš„è³‡æ–™
```
â”Œâ”€ å´é‚Šæ¬„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ä¸Šå‚³ CSV               â”‚
â”‚                           â”‚
â”‚ [é¸æ“‡æª”æ¡ˆ...]              â”‚
â”‚                           â”‚
â”‚ âœ… å·²è¼‰å…¥: sales.csv      â”‚
â”‚    ğŸ“Š 500 åˆ— Ã— 8 æ¬„       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. èˆ‡æ‚¨çš„è³‡æ–™å°è©±
```
æ‚¨:   "é¡¯ç¤ºå„åœ°å€çš„éŠ·å”®é¡"
      â†“
ğŸ¤– AI åˆ†æä¸Šä¸‹æ–‡èˆ‡è³‡æ–™
      â†“
Bot:  "æ ¹æ“šæ‚¨çš„è³‡æ–™...

       ğŸ“Š åœ–è¡¨: å„åœ°å€éŠ·å”®é¡

       æœ€é«˜åœ°å€: è¥¿éƒ¨ ($50k),
       åŒ—éƒ¨ ($45k), å—éƒ¨ ($38k)"
```

### æµç¨‹åœ–ï¼š
```mermaid
sequenceDiagram
    participant User as ä½¿ç”¨è€…
    participant StreamlitUI as Streamlit ä»‹é¢
    participant Runner as ADK åŸ·è¡Œå™¨
    participant Agent as AI ä»£ç†
    participant GeminiAPI as Gemini API

    User->>StreamlitUI: ä¸Šå‚³ CSV æª”æ¡ˆ
    StreamlitUI->>StreamlitUI: è¼‰å…¥ä¸¦é è¦½è³‡æ–™
    User->>StreamlitUI: æå‡ºå•é¡Œ

    alt ç¨‹å¼ç¢¼åŸ·è¡Œæ¨¡å¼ (Code Execution Mode)
        StreamlitUI->>Runner: ç™¼é€è¨Šæ¯ (ä¸Šä¸‹æ–‡ + æç¤ºè©)
        Runner->>Agent: è™•ç†è«‹æ±‚
        Agent->>Agent: ç”Ÿæˆç¨‹å¼ç¢¼ (å¦‚æœ‰éœ€è¦)
        Agent->>Runner: åŸ·è¡Œç¨‹å¼ç¢¼
        Runner->>StreamlitUI: ä¸²æµäº‹ä»¶ (æ–‡å­—/è¦–è¦ºåŒ–)
        StreamlitUI->>User: é¡¯ç¤ºçµæœèˆ‡åœ–è¡¨
    else ç›´æ¥å°è©±æ¨¡å¼ (Direct Chat Mode)
        StreamlitUI->>GeminiAPI: ç”Ÿæˆå…§å®¹
        GeminiAPI->>StreamlitUI: ä¸²æµå›æ‡‰
        StreamlitUI->>User: é¡¯ç¤ºæ–‡å­—å›æ‡‰
    end
```

### 3. å…©ç¨®å¯ç”¨æ¨¡å¼

**ç¨‹å¼ç¢¼åŸ·è¡Œæ¨¡å¼** (æ¨è–¦ç”¨æ–¼åœ–è¡¨)
- ä½¿ç”¨ matplotlib/plotly è‡ªå‹•è¦–è¦ºåŒ–
- AI ç”Ÿæˆä¸¦åŸ·è¡Œ Python ç¨‹å¼ç¢¼
- å°ˆæ¥­åœ–è¡¨ç›´æ¥é¡¯ç¤ºæ–¼å°è©±ä¸­

**å°è©±æ¨¡å¼** (ç”¨æ–¼åˆ†æ)
- ç›´æ¥ AI å›æ‡‰
- é©åˆæå•èˆ‡ç²å–è¦‹è§£
- å›é¥‹æ›´å¿«é€Ÿ

## ğŸ¯ ç«‹å³å˜—è©¦

**ç¯„ä¾‹ CSV** æ¸¬è©¦ç”¨ï¼š
```csv
date,product,sales,region
2024-01-01,Widget A,1200,North
2024-01-01,Widget B,980,West
2024-01-02,Widget A,1450,South
```

**ç¯„ä¾‹å•é¡Œ**ï¼š
- "éŠ·å”®é¡æœ€é«˜çš„ç”¢å“æ˜¯ä»€éº¼ï¼Ÿ"
- "å»ºç«‹éš¨æ™‚é–“è®ŠåŒ–çš„éŠ·å”®é¡åœ–è¡¨"
- "æ¯”è¼ƒå„åœ°å€ - å“ªä¸€å€‹æˆé•·æœ€å¿«ï¼Ÿ"
- "æ‚¨æœ‰æ³¨æ„åˆ°ä»»ä½•è¶¨å‹¢æˆ–æ¨¡å¼å—ï¼Ÿ"

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
data-analysis-agent/
â”œâ”€â”€ app.py                    ä¸» Streamlit æ‡‰ç”¨ç¨‹å¼
â”œâ”€â”€ data_analysis_agent/      AI ä»£ç†ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ agent.py
â”œâ”€â”€ tests/                    æ¸¬è©¦
â”œâ”€â”€ Makefile                  å¿«é€ŸæŒ‡ä»¤
â”œâ”€â”€ requirements.txt          ä¾è³´é …
â”œâ”€â”€ pyproject.toml           Python è¨­å®š
â”œâ”€â”€ .env.example             API é‡‘é‘°ç¯„æœ¬
â””â”€â”€ README.md                READMEæª”æ¡ˆ
```

**é—œéµæª”æ¡ˆ**ï¼š
- `app.py` - ä½¿ç”¨è€…ä»‹é¢èˆ‡å°è©±é‚è¼¯
- `data_analysis_agent/agent.py` - AI ä»£ç†è¨­å®š
- `Makefile` - åŸ·è¡Œ `make help` æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤

## âš™ï¸ æŒ‡ä»¤

```bash
make setup       # å®‰è£ä¾è³´é …
make dev         # å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ (localhost:8501)
make demo        # é¡¯ç¤ºä½¿ç”¨ç¯„ä¾‹
make test        # åŸ·è¡Œæ¸¬è©¦
make clean       # æ¸…é™¤å¿«å–
make help        # é¡¯ç¤ºæ‰€æœ‰æŒ‡ä»¤
```

## ğŸ§ª æ¸¬è©¦

æ¸¬è©¦é©—è­‰ä»£ç†è¨­å®šèˆ‡å·¥å…·æ˜¯å¦æ­£å¸¸é‹ä½œï¼š

```bash
make test                  # åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pytest tests/ -v           # è©³ç´°è¼¸å‡º
pytest tests/ --cov        # è¦†è“‹ç‡å ±å‘Š
```

æ¸¬è©¦æ¶µè“‹ï¼š
- ä»£ç†è¨­å®š âœ“
- å·¥å…·åŠŸèƒ½ âœ“
- åŒ¯å…¥ç³»çµ± âœ“
- å°ˆæ¡ˆçµæ§‹ âœ“

## ğŸ”§ è¨­å®š

### Streamlit è¨­å®š

åœ¨ `app.py` ä¸­è‡ªè¨‚ï¼š

```python
st.set_page_config(
    page_title="è³‡æ–™åˆ†æåŠ©ç†",
    page_icon="ğŸ“Š",
    layout="wide",
)
```

### ä»£ç†è¨­å®š

åœ¨ `data_analysis_agent/agent.py` ä¸­ä¿®æ”¹ï¼š

```python
root_agent = Agent(
    name="data_analysis_agent",
    model="gemini-2.0-flash",
    description="...",
    instruction="...",
    tools=[...],
)
```

## ğŸ“š é—œéµå…ƒä»¶

### 1. Streamlit æ‡‰ç”¨ç¨‹å¼ (`app.py`)

- åŒ…å«å°è©±èˆ‡æª”æ¡ˆä¸Šå‚³çš„ä½¿ç”¨è€…ä»‹é¢
- Session ç‹€æ…‹ç®¡ç†
- å³æ™‚å›æ‡‰ä¸²æµ
- è³‡æ–™é è¦½èˆ‡çµ±è¨ˆé¡¯ç¤º

### 2. ADK ä»£ç† (`data_analysis_agent/agent.py`)

- **root_agent**: åŒ¯å‡ºç”¨æ–¼ ADK æ¢ç´¢çš„ä¸»ä»£ç†
- **å·¥å…·**:
  - `analyze_column`: çµ±è¨ˆåˆ†æ
  - `calculate_correlation`: å°‹æ‰¾é—œè¯æ€§
  - `filter_data`: å­é›†æ¢ç´¢
  - `get_dataset_summary`: æ¦‚è¦½è³‡è¨Š

### 3. å·¥å…·

æ¯å€‹å·¥å…·å›å‚³ä¸€è‡´çš„æ ¼å¼ï¼š

```python
{
    "status": "success" | "error",
    "report": "äººé¡å¯è®€è¨Šæ¯",
    "data": {...},  # å·¥å…·ç‰¹å®šè³‡æ–™
}
```

## ğŸ›ï¸ å»ºæ§‹æ–¹å¼

```
æ‚¨çš„ç€è¦½å™¨
     â†“
  Streamlit æ‡‰ç”¨ç¨‹å¼ (localhost:8501)
     â”‚
     â”œâ”€ æª”æ¡ˆä¸Šå‚³ â†’ ä½¿ç”¨ pandas è¼‰å…¥ CSV
     â”œâ”€ å°è©± UI â†’ é¡¯ç¤ºè¨Šæ¯
     â””â”€ ä»£ç†å‘¼å« â†’ ç›´æ¥ç¨‹åºå…§åŸ·è¡Œ
                     (ç„¡ HTTP é–‹éŠ·ï¼)
     â†“
  Google Gemini API
     â””â”€ åˆ†æè³‡æ–™ï¼Œç”Ÿæˆç¨‹å¼ç¢¼
```

**å…©æ¢åŸ·è¡Œè·¯å¾‘**ï¼š

1. **ç¨‹å¼ç¢¼åŸ·è¡Œæ¨¡å¼** (æ™ºæ…§å‹)
   - æ‚¨è¦æ±‚åœ–è¡¨
   - AI ç”Ÿæˆ Python ç¨‹å¼ç¢¼
   - ç¨‹å¼ç¢¼åŸ·è¡Œï¼Œmatplotlib/plotly å»ºç«‹åœ–ç‰‡
   - åœ–è¡¨é¡¯ç¤ºæ–¼å°è©±ä¸­

2. **å°è©±æ¨¡å¼** (å¿«é€Ÿ)
   - æ‚¨æå‡ºå•é¡Œ
   - AI ç›´æ¥å›æ‡‰
   - ç„¡ç¨‹å¼ç¢¼åŸ·è¡Œï¼Œåƒ…æä¾›è¦‹è§£

**æ¶æ§‹å„ªå‹¢**ï¼š
- ç´” Python (ç„¡éœ€ JavaScript)
- ç›´æ¥ç¨‹åºå…§åŸ·è¡Œ (å¿«é€Ÿï¼)
- å–®ä¸€æœå‹™éƒ¨ç½²
- é©åˆè³‡æ–™å·¥å…·

## ğŸš€ åˆ†äº«æ‚¨çš„æ‡‰ç”¨ç¨‹å¼

### Streamlit Cloud (æœ€ç°¡å–®)

1. æ¨é€ç¨‹å¼ç¢¼è‡³ GitHub
2. å‰å¾€ [share.streamlit.io](https://share.streamlit.io)
3. é»æ“Š "New app" â†’ é¸æ“‡ repo â†’ `app.py`
4. æ–°å¢å¯†é‘°ï¼š`GOOGLE_API_KEY = your_key`
5. å®Œæˆï¼æ‚¨çš„æ‡‰ç”¨ç¨‹å¼å·²ä¸Šç·š ğŸ‰

### Google Cloud Run

```bash
# éƒ¨ç½² (éœ€ 1-2 åˆ†é˜)
gcloud run deploy data-analysis-agent \
  --source=. \
  --allow-unauthenticated

# æŸ¥çœ‹æ—¥èªŒ
gcloud run logs read data-analysis-agent
```

## ğŸ› é‡åˆ°å•é¡Œï¼Ÿ

### è«‹è¨­å®š GOOGLE_API_KEY

```bash
cp .env.example .env
# ç·¨è¼¯ .env ä¸¦æ–°å¢æ‚¨çš„é‡‘é‘°
```

### æ‡‰ç”¨ç¨‹å¼ç„¡æ³•å•Ÿå‹•

```bash
make clean
make setup
streamlit run app.py --logger.level=debug
```

### æ¸¬è©¦å¤±æ•—

```bash
pytest tests/ -vv
```

## ğŸ”— äº†è§£æ›´å¤š

**ç†è§£ç¨‹å¼ç¢¼**ï¼š
1. é–±è®€ `app.py` - Streamlit UI å¦‚ä½•é‹ä½œ
2. æŸ¥çœ‹ `data_analysis_agent/agent.py` - AI è¨­å®š
3. åŸ·è¡Œæ¸¬è©¦ - é©—è­‰ä¸€åˆ‡æ­£å¸¸é‹ä½œ

**è‡ªè¨‚å®ƒ**ï¼š
- é‡å°ä¸åŒåˆ†æé¢¨æ ¼æ›´æ”¹ä»£ç†æŒ‡ä»¤
- æ–°å¢æ›´å¤šå·¥å…·ï¼ˆçµ±è¨ˆæ¸¬è©¦ã€æ©Ÿå™¨å­¸ç¿’é æ¸¬ï¼‰
- ä¿®æ”¹åœ–è¡¨èˆ‡è¦–è¦ºåŒ–
- æ–°å¢ä½¿ç”¨è€…é©—è­‰

## ğŸ“š è³‡æº

- [Streamlit æ–‡ä»¶](https://docs.streamlit.io)
- [Google ADK](https://google.github.io/adk-docs/)
- [Gemini API](https://ai.google.dev/)
- [Pandas æŒ‡å—](https://pandas.pydata.org/docs/)

---

## é‡é»æ‘˜è¦

- **æ ¸å¿ƒæ¦‚å¿µ**ï¼šæä¾›ä¸€å€‹åŸºæ–¼ Streamlit å’Œ Google ADK çš„è³‡æ–™åˆ†æä»£ç†ï¼Œå…è¨±ä½¿ç”¨è€…é€éè‡ªç„¶èªè¨€èˆ‡ CSV è³‡æ–™äº’å‹•ï¼Œé€²è¡Œåˆ†æèˆ‡è¦–è¦ºåŒ–ã€‚
- **é—œéµæŠ€è¡“**ï¼š
    - **Streamlit**ï¼šç”¨æ–¼å»ºæ§‹äº’å‹•å¼å‰ç«¯ UIã€‚
    - **Google ADK (Agent Development Kit)**ï¼šç”¨æ–¼å»ºæ§‹èˆ‡ç®¡ç† AI ä»£ç†ã€‚
    - **Google Gemini API**ï¼šæä¾›å¼·å¤§çš„èªè¨€æ¨¡å‹æ”¯æ´ã€‚
    - **Pandas**ï¼šé€²è¡Œè³‡æ–™è™•ç†èˆ‡åˆ†æã€‚
    - **Matplotlib/Plotly**ï¼šç”¨æ–¼å‹•æ…‹ç”Ÿæˆè¦–è¦ºåŒ–åœ–è¡¨ã€‚
    - **ç¨‹å¼ç¢¼åŸ·è¡Œ (Code Execution)**ï¼šAI ç”Ÿæˆä¸¦åŸ·è¡Œ Python ç¨‹å¼ç¢¼ä»¥ç”¢ç”Ÿç²¾ç¢ºçš„åœ–è¡¨ã€‚
- **é‡è¦çµè«–**ï¼šæœ¬å°ˆæ¡ˆå±•ç¤ºäº†å¦‚ä½•æ•´åˆå‰ç«¯ UI èˆ‡å¾Œç«¯ AI ä»£ç†ï¼Œå¯¦ç¾ç„¡ç¸«çš„è³‡æ–™åˆ†æé«”é©—ã€‚é€éã€Œç¨‹å¼ç¢¼åŸ·è¡Œæ¨¡å¼ã€èˆ‡ã€Œå°è©±æ¨¡å¼ã€çš„é›™è»Œè¨­è¨ˆï¼Œå…¼é¡§äº†æ·±åº¦åˆ†æèˆ‡å¿«é€Ÿäº’å‹•çš„éœ€æ±‚ã€‚
- **è¡Œå‹•é …ç›®**ï¼š
    1. å®‰è£ä¾è³´é … (`make setup`)ã€‚
    2. è¨­å®š API é‡‘é‘° (`.env`)ã€‚
    3. å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼ (`make dev`)ã€‚
    4. ä¸Šå‚³ CSV æª”æ¡ˆä¸¦é–‹å§‹æ¸¬è©¦åˆ†æåŠŸèƒ½ã€‚

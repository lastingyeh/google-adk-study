.PHONY: help setup clean test demo dev evaluate

help:
	@echo "Tool Use Quality (å·¥å…·ä½¿ç”¨å“è³ª) Evaluation TIL - å¯ç”¨æŒ‡ä»¤"
	@echo "====================================================="
	@echo ""
	@echo "make setup       å®‰è£ä¾è³´ä¸¦æº–å‚™ç’°å¢ƒ"
	@echo "make test        åŸ·è¡Œå–®å…ƒæ¸¬è©¦ (é©—è­‰é…ç½®)"
	@echo "make evaluate    å±•ç¤ºä½¿ç”¨ RUBRIC_BASED_TOOL_USE_QUALITY_V1 çš„ LlmAsJudge"
	@echo "make dev         å•Ÿå‹• ADK ç¶²é ä»‹é¢ä»¥æ¸¬è©¦å·¥å…·ä½¿ç”¨"
	@echo "make demo        å¿«é€Ÿé©—è­‰ (ç„¡éœ€ç¶²é ä»‹é¢)"
	@echo "make clean       ç§»é™¤å¿«å–æª”æ¡ˆå’Œç”¢ç‰©"
	@echo ""

setup:
	pip install -r requirements.txt
	pip install -e .
	cp tool_use_evaluator/.env.example tool_use_evaluator/.env
	@echo ""
	@echo "âœ… è¨­å®šå®Œæˆï¼"
	@echo ""
	@echo "ä¸‹ä¸€æ­¥ï¼š"
	@echo "1. å°‡æ‚¨çš„ GOOGLE_API_KEY æ–°å¢è‡³ tool_use_evaluator/.env"
	@echo "2. åŸ·è¡Œ 'make test' ä»¥é©—è­‰å¯¦ä½œ"
	@echo "3. åŸ·è¡Œ 'make dev' ä»¥å•Ÿå‹•ç¶²é ä»‹é¢"
	@echo ""

dev:
	@echo ""
	@echo "ğŸš€ æ­£åœ¨å•Ÿå‹• ADK ç¶²é ä»‹é¢..."
	@echo ""
	@echo "ğŸ“ å¦‚ä½•æ¸¬è©¦å·¥å…·ä½¿ç”¨å“è³ª (Tool Use Quality)ï¼š"
	@echo "   1. é–‹å•Ÿ http://localhost:8000"
	@echo "   2. é¸æ“‡ 'tool_use_evaluator'"
	@echo "   3. å˜—è©¦ä»¥ä¸‹æç¤ºè© (Prompts)ï¼š"
	@echo ""
	@echo "   âœ… è‰¯å¥½çš„å·¥å…·ä½¿ç”¨ (GOOD TOOL USAGE)ï¼š"
	@echo "   'åˆ†æ customer_dataï¼Œæå–ç‰¹å¾µï¼Œé©—è­‰å“è³ªï¼Œç„¶å¾Œæ‡‰ç”¨ random_forest æ¨¡å‹'"
	@echo ""
	@echo "   âŒ ä¸è‰¯çš„å·¥å…·ä½¿ç”¨ (é †åºéŒ¯èª¤) (BAD TOOL USAGE)ï¼š"
	@echo "   'å…ˆæ‡‰ç”¨æ¨¡å‹ï¼Œç„¶å¾Œåˆ†ææ•¸æ“šï¼Œå†æå–ç‰¹å¾µ'"
	@echo ""
	@echo "   âœ… è‰¯å¥½çš„å·¥å…·é †åº (GOOD TOOL SEQUENCE)ï¼š"
	@echo "   'åˆ†æ sales_dataï¼Œæå–é‡è¦ç‰¹å¾µï¼Œé©—è­‰å®ƒå€‘ï¼Œæ‡‰ç”¨ gradient_boosting'"
	@echo ""
	@echo "ğŸ’¡ è§€å¯Ÿé‡é»ï¼š"
	@echo "   â€¢ Events æ¨™ç±¤é ä¸­çš„å·¥å…·å‘¼å«é †åº"
	@echo "   â€¢ å·¥å…·æ˜¯å¦æŒ‰é‚è¼¯é †åºå‘¼å«"
	@echo "   â€¢ ç›¸ä¾å·¥å…·ä¹‹å‰æ˜¯å¦å·²æ»¿è¶³å…ˆæ±ºæ¢ä»¶"
	@echo "   â€¢ å·¥å…·è¢«èª¤ç”¨æ™‚çš„éŒ¯èª¤è™•ç†"
	@echo ""
	@echo "ğŸ¯ è©•ä¼°é‡é»ï¼š"
	@echo "   æ­¤ä»£ç† (Agent) å±•ç¤ºäº†å·¥å…·ä½¿ç”¨å“è³ªçš„æ¦‚å¿µï¼š"
	@echo "   - å·¥å…·æ’åº (åˆ†æ â†’ æå– â†’ é©—è­‰ â†’ æ‡‰ç”¨)"
	@echo "   - å·¥å…·ä¾è³´æ€§ (æ¯å€‹æ­¥é©Ÿéƒ½å»ºç«‹åœ¨å‰ä¸€å€‹æ­¥é©Ÿä¹‹ä¸Š)"
	@echo "   - éŒ¯èª¤è™•ç† (é©ç•¶çš„é©—è­‰)"
	@echo "   - æ•ˆç‡ (ç„¡è·³éæˆ–å¤šé¤˜çš„æ­¥é©Ÿ)"
	@echo ""
	adk web

test:
	@echo ""
	@echo "ğŸ§ª æ­£åœ¨åŸ·è¡Œå·¥å…·ä½¿ç”¨å“è³ªè©•ä¼°æ¸¬è©¦..."
	@echo ""
	@pytest tests/ -v --tb=short
	@echo ""
	@echo "âœ… æ¸¬è©¦é©—è­‰é …ç›®ï¼š"
	@echo "   â€¢ ä»£ç†é…ç½® (6 å€‹æ¸¬è©¦)"
	@echo "   â€¢ å·¥å…·åŠŸèƒ½ (8 å€‹æ¸¬è©¦)"
	@echo "   â€¢ åŒ¯å…¥è·¯å¾‘ (3 å€‹æ¸¬è©¦)"
	@echo "   â€¢ æ‡‰ç”¨ç¨‹å¼çµæ§‹ (3 å€‹æ¸¬è©¦)"
	@echo ""
	@echo "ğŸ“‹ æ¸¬è©¦è¦†è“‹ç‡ï¼š"
	@echo "   âœ“ ä»£ç†åç¨±ã€æ¨¡å‹ã€æè¿°ã€æŒ‡ä»¤"
	@echo "   âœ“ ä»£ç†æ“æœ‰å…¨éƒ¨ 4 å€‹å·¥å…·ï¼šåˆ†æ (analyze)ã€æå– (extract)ã€é©—è­‰ (validate)ã€æ‡‰ç”¨ (apply)"
	@echo "   âœ“ ä»£ç†å·²é…ç½® output_key"
	@echo "   âœ“ å·¥å…·æˆåŠŸå’ŒéŒ¯èª¤æ¡ˆä¾‹"
	@echo "   âœ“ æ¨¡çµ„åŒ¯å…¥å’ŒåŒ¯å‡º"
	@echo "   âœ“ æ‡‰ç”¨ç¨‹å¼é…ç½®å’Œåˆå§‹åŒ–"
	@echo ""
	@echo "ğŸ” æ¯å€‹æ¸¬è©¦é©—è­‰çš„å…§å®¹ï¼š"
	@echo "   ä»£ç†é…ç½®æ¸¬è©¦ï¼š"
	@echo "     - ä»£ç†åç¨±ï¼štool_use_evaluator"
	@echo "     - æ¨¡å‹ï¼šgemini-2.0-flash"
	@echo "     - æŒ‡ä»¤å¼·èª¿æ­£ç¢ºçš„å·¥å…·æ’åº"
	@echo "     - æ‰€æœ‰ 4 å€‹å·¥å…·çš†å¯ç”¨"
	@echo ""
	@echo "   å·¥å…·åŠŸèƒ½æ¸¬è©¦ï¼š"
	@echo "     - analyze_data è™•ç†æˆåŠŸå’ŒéŒ¯èª¤æƒ…æ³"
	@echo "     - extract_features é©—è­‰è¼¸å…¥"
	@echo "     - validate_quality æª¢æŸ¥å…ˆæ±ºæ¢ä»¶"
	@echo "     - apply_model éœ€è¦ç‰¹å¾µå’Œæ¨¡å‹å…©è€…"
	@echo ""
	@echo "   åŒ¯å…¥èˆ‡çµæ§‹æ¸¬è©¦ï¼š"
	@echo "     - ä»£ç†å¯ä»¥å¾å¥—ä»¶åŒ¯å…¥"
	@echo "     - æ‡‰ç”¨ç¨‹å¼é…ç½®æ­£ç¢º"
	@echo "     - æ¨¡çµ„åŒ¯å‡ºå·²æ­£ç¢ºè¨­å®š"
	@echo ""
	@echo "ğŸ’¡ è‹¥è¦åŸ·è¡Œç‰¹å®šæ¸¬è©¦ï¼š"
	@echo "   pytest tests/test_agent.py::TestAgentConfiguration -v"
	@echo "   pytest tests/test_agent.py::TestToolFunctionality -v"
	@echo ""
	@echo "ğŸ“Š æŸ¥çœ‹æ¸¬è©¦è¦†è“‹ç‡ï¼š"
	@echo "   pytest tests/ --cov=tool_use_evaluator --cov-report=html"
	@echo ""

demo:
	@echo ""
	@echo "ğŸ” å¿«é€Ÿé©—è­‰..."
	python -c "from tool_use_evaluator import root_agent; from app import app; print('âœ… ä»£ç† (Agent) å·²è¼‰å…¥:', root_agent.name); print('âœ… æ‡‰ç”¨ç¨‹å¼ (App) å·²é…ç½®:', app.name); print('âœ… å·¥å…·æ•¸é‡:', len(root_agent.tools)); print('âœ… å¯¦ä½œå·²å°±ç·’ï¼')"
	@echo ""
	@echo "ğŸ¯ å¯¦ä½œå·²æº–å‚™å¥½é€²è¡Œè©•ä¼°ï¼"
	@echo ""

evaluate:
	@echo ""
	@echo "ğŸ“Š å±•ç¤ºä½¿ç”¨ RUBRIC_BASED_TOOL_USE_QUALITY_V1 çš„ LlmAsJudge"
	@echo ""
	python evaluate_tool_use.py
	@echo ""

clean:
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	rm -rf .coverage htmlcov build dist *.egg-info
	@echo "âœ… å·²æ¸…é™¤å¿«å–æª”æ¡ˆ"

# RAG Agent with Document Retrieval using ADK Starter Pack

ç”¨æ–¼æ–‡ä»¶æª¢ç´¢å’Œå•ç­”çš„ ADK RAG ä»£ç†ã€‚åŒ…å«ä¸€å€‹è³‡æ–™ç®¡é“ï¼Œç”¨æ–¼å°‡æ–‡ä»¶æ“·å–ä¸¦ç´¢å¼•åˆ° Vertex AI Search æˆ– Vector Searchã€‚
ä»£ç†ç¨‹å¼ä½¿ç”¨ [`googleCloudPlatform/agent-starter-pack`](https://github.com/GoogleCloudPlatform/agent-starter-pack) ç‰ˆæœ¬ `0.29.3` ç”¢ç”Ÿ

## å°ˆæ¡ˆçµæ§‹

æ­¤å°ˆæ¡ˆçš„çµ„ç¹”çµæ§‹å¦‚ä¸‹ï¼š
```
â”œâ”€â”€ Dockerfile                  # ç”¨æ–¼å°‡æ‡‰ç”¨ç¨‹å¼å®¹å™¨åŒ–çš„è¨­å®šæª”
â”œâ”€â”€ GEMINI.md                   # ç‚º AI å·¥å…· (å¦‚ Gemini CLI) æä¾›å°ˆæ¡ˆä¸Šä¸‹æ–‡çš„æª”æ¡ˆ
â”œâ”€â”€ Makefile                    # å®šç¾©äº†å°ˆæ¡ˆçš„å¸¸ç”¨æŒ‡ä»¤ï¼Œå¦‚å®‰è£ã€æ¸¬è©¦å’Œéƒ¨ç½²
â”œâ”€â”€ README.md                   # å°ˆæ¡ˆçš„ä¸»è¦èªªæ˜æ–‡ä»¶ (æœ¬æª”æ¡ˆ)
â”œâ”€â”€ app                         # ä¸»è¦ä»£ç†ç¨‹å¼ root-agent æ‡‰ç”¨ç¨‹å¼æ ¸å¿ƒé‚è¼¯çš„ç›®éŒ„
â”‚   â”œâ”€â”€ __init__.py             # å°‡ `app` ç›®éŒ„æ¨™ç¤ºç‚º Python å¥—ä»¶
â”‚   â”œâ”€â”€ agent.py                # å®šç¾©ä»£ç†ç¨‹å¼æ ¸å¿ƒé‚è¼¯çš„åœ°æ–¹
â”‚   â”œâ”€â”€ app_utils               # åŒ…å«æ‡‰ç”¨ç¨‹å¼å…±ç”¨å·¥å…·çš„ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ telemetry.py        # è™•ç†é™æ¸¬å’Œç›£æ§çš„è¨­å®š
â”‚   â”‚   â””â”€â”€ typing.py           # å®šç¾©è‡ªè¨‚å‹åˆ¥æç¤º
â”‚   â”œâ”€â”€ fast_api_app.py         # è¨­å®š FastAPI ç¶²é ä¼ºæœå™¨å’Œç«¯é»
â”‚   â”œâ”€â”€ retrievers.py           # å¯¦ç¾è³‡æ–™æª¢ç´¢é‚è¼¯
â”‚   â””â”€â”€ templates.py            # åŒ…å« Jinja2 æ¨¡æ¿ï¼Œç”¨æ–¼å‰ç«¯ UI
â”œâ”€â”€ data_ingestion              # åŒ…å«è³‡æ–™æ“·å–ç®¡é“ç›¸é—œç¨‹å¼ç¢¼çš„ç›®éŒ„
â”‚   â”œâ”€â”€ README.md               # è³‡æ–™æ“·å–ç®¡é“çš„èªªæ˜æ–‡ä»¶
â”‚   â”œâ”€â”€ data_ingestion_pipeline # ç®¡é“çš„æ ¸å¿ƒé‚è¼¯
â”‚   â”‚   â”œâ”€â”€ components          # ç®¡é“çš„å„å€‹å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ingest_data.py  # è² è²¬å¾ä¾†æºæ“·å–è³‡æ–™çš„å…ƒä»¶
â”‚   â”‚   â”‚   â””â”€â”€ process_data.py # è² è²¬è™•ç†å’Œè½‰æ›è³‡æ–™çš„å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ pipeline.py         # å®šç¾© Vertex AI Pipeline çš„å·¥ä½œæµç¨‹
â”‚   â”‚   â””â”€â”€ submit_pipeline.py  # ç”¨æ–¼æäº¤å’ŒåŸ·è¡Œç®¡é“çš„è…³æœ¬
â”‚   â”œâ”€â”€ pyproject.toml          # è³‡æ–™æ“·å–ç®¡é“çš„ Python å°ˆæ¡ˆè¨­å®šæª”
â”‚   â””â”€â”€ uv.lock                 # é–å®šè³‡æ–™æ“·å–ç®¡é“çš„ Python ç›¸ä¾æ€§ç‰ˆæœ¬
â”œâ”€â”€ deployment                  # åŒ…å«åŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼ (IaC) è¨­å®šçš„ç›®éŒ„
â”‚   â”œâ”€â”€ ARCHI.md                # å°ˆæ¡ˆæ¶æ§‹åœ–å’Œèªªæ˜
â”‚   â”œâ”€â”€ README.md               # éƒ¨ç½²èªªæ˜çš„è©³ç´°æ–‡ä»¶
â”‚   â””â”€â”€ terraform               # Terraform è¨­å®šæª”ï¼Œç”¨æ–¼ç®¡ç†é›²ç«¯è³‡æº
â”‚       â”œâ”€â”€ apis.tf             # ç®¡ç†éœ€è¦å•Ÿç”¨çš„ Google Cloud API
â”‚       â”œâ”€â”€ dev                 # é–‹ç™¼ç’°å¢ƒå°ˆç”¨çš„ Terraform è¨­å®š
â”‚       â”‚   â”œâ”€â”€ apis.tf         # é–‹ç™¼ç’°å¢ƒçš„ API è¨­å®š
â”‚       â”‚   â”œâ”€â”€ iam.tf          # é–‹ç™¼ç’°å¢ƒçš„ IAM æ¬Šé™è¨­å®š
â”‚       â”‚   â”œâ”€â”€ providers.tf    # é–‹ç™¼ç’°å¢ƒçš„ Terraform æä¾›è€…è¨­å®š
â”‚       â”‚   â”œâ”€â”€ service.tf      # é–‹ç™¼ç’°å¢ƒçš„ Cloud Run æœå‹™è¨­å®š
â”‚       â”‚   â”œâ”€â”€ storage.tf      # é–‹ç™¼ç’°å¢ƒçš„å„²å­˜è³‡æº (å¦‚ GCS) è¨­å®š
â”‚       â”‚   â”œâ”€â”€ telemetry.tf    # é–‹ç™¼ç’°å¢ƒçš„é™æ¸¬å’Œç›£æ§è³‡æºè¨­å®š
â”‚       â”‚   â”œâ”€â”€ variables.tf    # é–‹ç™¼ç’°å¢ƒçš„ Terraform è®Šæ•¸å®šç¾©
â”‚       â”‚   â””â”€â”€ vars            # å­˜æ”¾é–‹ç™¼ç’°å¢ƒè®Šæ•¸å€¼çš„ç›®éŒ„
â”‚       â”‚       â””â”€â”€ env.tfvars  # é–‹ç™¼ç’°å¢ƒçš„è®Šæ•¸æª”æ¡ˆ
â”‚       â”œâ”€â”€ github.tf           # GitHub èˆ‡ GCP æ•´åˆçš„è¨­å®š (ä¾‹å¦‚ CI/CD)
â”‚       â”œâ”€â”€ iam.tf              # é€šç”¨çš„ IAM æ¬Šé™è¨­å®š
â”‚       â”œâ”€â”€ locals.tf           # å®šç¾©æœ¬åœ°è®Šæ•¸ä»¥ç°¡åŒ–è¨­å®š
â”‚       â”œâ”€â”€ providers.tf        # è¨­å®š Terraform æä¾›è€… (å¦‚ Google Cloud)
â”‚       â”œâ”€â”€ service.tf          # Cloud Run æœå‹™çš„é€šç”¨è¨­å®š
â”‚       â”œâ”€â”€ service_accounts.tf # è¨­å®šæœå‹™å¸³æˆ¶
â”‚       â”œâ”€â”€ sql                 # å­˜æ”¾ SQL æŸ¥è©¢çš„ç›®éŒ„
â”‚       â”‚   â””â”€â”€ completions.sql # ç”¨æ–¼ BigQuery çš„ç¯„ä¾‹ SQL æŸ¥è©¢
â”‚       â”œâ”€â”€ storage.tf          # å„²å­˜è³‡æº (å¦‚ GCS) çš„é€šç”¨è¨­å®š
â”‚       â”œâ”€â”€ telemetry.tf        # é™æ¸¬å’Œç›£æ§è³‡æº (å¦‚ Logging, Tracing) çš„é€šç”¨è¨­å®š
â”‚       â”œâ”€â”€ variables.tf        # é€šç”¨çš„ Terraform è®Šæ•¸å®šç¾©
â”‚       â”œâ”€â”€ vars                # å­˜æ”¾é€šç”¨è®Šæ•¸å€¼çš„ç›®éŒ„
â”‚       â”‚   â””â”€â”€ env.tfvars      # é€šç”¨çš„è®Šæ•¸æª”æ¡ˆ
â”‚       â””â”€â”€ wif.tf              # Workload Identity Federation çš„è¨­å®š
â”œâ”€â”€ notebooks                   # åŒ…å« Jupyter ç­†è¨˜æœ¬ï¼Œç”¨æ–¼åŸå‹è¨­è¨ˆå’Œæ¸¬è©¦
â”‚   â”œâ”€â”€ adk_app_testing.ipynb   # æ¸¬è©¦ ADK æ‡‰ç”¨ç¨‹å¼çš„ç­†è¨˜æœ¬
â”‚   â””â”€â”€ evaluating_adk_agent.ipynb # è©•ä¼° ADK ä»£ç†ç¨‹å¼æ•ˆèƒ½çš„ç­†è¨˜æœ¬
â”œâ”€â”€ pyproject.toml              # å°ˆæ¡ˆçš„ Python å°ˆæ¡ˆè¨­å®šæª” (PEP 621)
â”œâ”€â”€ tests                       # åŒ…å«æ‰€æœ‰æ¸¬è©¦ç¨‹å¼ç¢¼çš„ç›®éŒ„
â”‚   â”œâ”€â”€ integration             # æ•´åˆæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ test_agent.py       # æ¸¬è©¦ä»£ç†ç¨‹å¼èˆ‡å…¶ä»–å…ƒä»¶çš„æ•´åˆ
â”‚   â”‚   â””â”€â”€ test_server_e2e.py  # ç«¯å°ç«¯ä¼ºæœå™¨æ¸¬è©¦
â”‚   â”œâ”€â”€ load_test               # è² è¼‰æ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ README.md           # è² è¼‰æ¸¬è©¦èªªæ˜æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ load_test.py        # åŸ·è¡Œè² è¼‰æ¸¬è©¦çš„è…³æœ¬
â”‚   â””â”€â”€ unit                    # å–®å…ƒæ¸¬è©¦
â”‚       â””â”€â”€ test_dummy.py       # ç¯„ä¾‹å–®å…ƒæ¸¬è©¦æª”æ¡ˆ
â””â”€â”€ uv.lock                     # é–å®šå°ˆæ¡ˆçš„ Python ç›¸ä¾æ€§ç‰ˆæœ¬
```

> ğŸ’¡ **æç¤ºï¼š** ä½¿ç”¨ [Gemini CLI](https://github.com/google-gemini/gemini-cli) é€²è¡Œ AI è¼”åŠ©é–‹ç™¼ - å°ˆæ¡ˆä¸Šä¸‹æ–‡å·²åœ¨ `GEMINI.md` ä¸­é å…ˆè¨­å®šã€‚

## ç’°å¢ƒéœ€æ±‚

åœ¨é–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿æ‚¨å·²å…·å‚™ï¼š

- **uv**ï¼šPython å¥—ä»¶ç®¡ç†å™¨ (æ­¤å°ˆæ¡ˆä¸­æ‰€æœ‰ç›¸ä¾æ€§ç®¡ç†çš†ä½¿ç”¨æ­¤å·¥å…·) - [å®‰è£](https://docs.astral.sh/uv/getting-started/installation/) (ä½¿ç”¨ `uv add <package>` [æ–°å¢å¥—ä»¶](https://docs.astral.sh/uv/concepts/dependencies/))
- **Google Cloud SDK**ï¼šç”¨æ–¼ GCP æœå‹™ - [å®‰è£](https://cloud.google.com/sdk/docs/install)
- **Terraform**ï¼šç”¨æ–¼åŸºç¤è¨­æ–½éƒ¨ç½² - [å®‰è£](https://developer.hashicorp.com/terraform/downloads)
- **make**ï¼šå»ºç½®è‡ªå‹•åŒ–å·¥å…· - [å®‰è£](https://www.gnu.org/software/make/) (åœ¨å¤§å¤šæ•¸ Unix-based ç³»çµ±ä¸Šå·²é å…ˆå®‰è£)

## å¿«é€Ÿå…¥é–€ (æœ¬æ©Ÿæ¸¬è©¦)

å®‰è£æ‰€éœ€å¥—ä»¶ä¸¦å•Ÿå‹•æœ¬æ©Ÿé–‹ç™¼ç’°å¢ƒï¼š

```bash
make install && make playground
```

> **ğŸ“Š å¯è§€æ¸¬æ€§èªªæ˜ï¼š** ä»£ç†ç¨‹å¼é™æ¸¬ (Cloud Trace) å§‹çµ‚å•Ÿç”¨ã€‚æç¤º-å›æ‡‰è¨˜éŒ„ (GCSã€BigQueryã€Cloud Logging) åœ¨æœ¬æ©Ÿ**é è¨­åœç”¨**ï¼Œåœ¨å·²éƒ¨ç½²çš„ç’°å¢ƒä¸­**é è¨­å•Ÿç”¨** (åƒ…é™å…ƒè³‡æ–™ - ç„¡æç¤º/å›æ‡‰å…§å®¹)ã€‚è©³æƒ…è«‹åƒé–± [ç›£æ§èˆ‡å¯è§€æ¸¬æ€§](#ç›£æ§èˆ‡å¯è§€æ¸¬æ€§)ã€‚

## æŒ‡ä»¤

| æŒ‡ä»¤                  | èªªæ˜                                                                                               |
| --------------------- | -------------------------------------------------------------------------------------------------- |
| `make install`        | ä½¿ç”¨ uv å®‰è£æ‰€æœ‰å¿…è¦çš„ç›¸ä¾æ€§                                                                       |
| `make playground`     | å•Ÿå‹•åŒ…å«å¾Œç«¯å’Œå‰ç«¯çš„æœ¬æ©Ÿé–‹ç™¼ç’°å¢ƒ - åˆ©ç”¨ `adk web` æŒ‡ä»¤ã€‚                                           |
| `make deploy`         | å°‡ä»£ç†ç¨‹å¼éƒ¨ç½²åˆ° Cloud Run (ä½¿ç”¨ `IAP=true` å•Ÿç”¨ Identity-Aware Proxyï¼Œ`PORT=8080` æŒ‡å®šå®¹å™¨é€£æ¥åŸ ) |
| `make local-backend`  | å•Ÿå‹•å…·æœ‰ç†±é‡è¼‰åŠŸèƒ½çš„æœ¬æ©Ÿé–‹ç™¼ä¼ºæœå™¨                                                                 |
| `make test`           | åŸ·è¡Œå–®å…ƒå’Œæ•´åˆæ¸¬è©¦                                                                                 |
| `make lint`           | åŸ·è¡Œç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ (codespell, ruff, mypy)                                                         |
| `make setup-dev-env`  | ä½¿ç”¨ Terraform è¨­å®šé–‹ç™¼ç’°å¢ƒè³‡æº                                                                    |
| `make data-ingestion` | åœ¨é–‹ç™¼ç’°å¢ƒä¸­åŸ·è¡Œè³‡æ–™æ“·å–ç®¡é“                                                                       |

æœ‰é—œå®Œæ•´çš„æŒ‡ä»¤é¸é …å’Œç”¨æ³•ï¼Œè«‹åƒé–± [Makefile](Makefile)ã€‚

## ä½¿ç”¨æ–¹å¼

æ­¤ç¯„æœ¬éµå¾ªã€Œè‡ªå‚™ä»£ç†ç¨‹å¼ã€çš„æ–¹æ³• - æ‚¨å°ˆæ³¨æ–¼æ‚¨çš„æ¥­å‹™é‚è¼¯ï¼Œè€Œç¯„æœ¬è™•ç†å…¶ä»–æ‰€æœ‰äº‹æƒ… (UIã€åŸºç¤è¨­æ–½ã€éƒ¨ç½²ã€ç›£æ§)ã€‚

1. **åŸå‹è¨­è¨ˆï¼š** åƒè€ƒ `notebooks/` ä¸­çš„å…¥é–€ç­†è¨˜æœ¬ï¼Œå»ºæ§‹æ‚¨çš„ç”Ÿæˆå¼ AI ä»£ç†ç¨‹å¼ã€‚ä½¿ç”¨ Vertex AI Evaluation è©•ä¼°æ•ˆèƒ½ã€‚
2. **æ•´åˆï¼š** ç·¨è¼¯ `app/agent.py` å°‡æ‚¨çš„ä»£ç†ç¨‹å¼åŒ¯å…¥æ‡‰ç”¨ç¨‹å¼ä¸­ã€‚
3. **æ¸¬è©¦ï¼š** ä½¿ç”¨ `make playground` åœ¨æœ¬æ©ŸéŠæ¨‚å ´ä¸­æ¢ç´¢æ‚¨çš„ä»£ç†ç¨‹å¼åŠŸèƒ½ã€‚éŠæ¨‚å ´æœƒåœ¨ç¨‹å¼ç¢¼è®Šæ›´æ™‚è‡ªå‹•é‡æ–°è¼‰å…¥æ‚¨çš„ä»£ç†ç¨‹å¼ã€‚
4. **éƒ¨ç½²ï¼š** è¨­å®šä¸¦å•Ÿå‹• CI/CD ç®¡é“ï¼Œä¸¦æ ¹æ“šéœ€è¦è‡ªè¨‚æ¸¬è©¦ã€‚æœ‰é—œè©³ç´°èªªæ˜ï¼Œè«‹åƒé–± [éƒ¨ç½²éƒ¨åˆ†](#éƒ¨ç½²)ã€‚è‹¥è¦ç°¡åŒ–åŸºç¤è¨­æ–½éƒ¨ç½²ï¼Œåªéœ€åŸ·è¡Œ `uvx agent-starter-pack setup-cicd`ã€‚è«‹æŸ¥çœ‹ [`agent-starter-pack setup-cicd` CLI æŒ‡ä»¤](https://googlecloudplatform.github.io/agent-starter-pack/cli/setup_cicd.html)ã€‚ç›®å‰æ”¯æ´ GitHubï¼Œä¸¦å¯ä½¿ç”¨ Google Cloud Build å’Œ GitHub Actions ä½œç‚º CI/CD åŸ·è¡Œå™¨ã€‚
5. **ç›£æ§ï¼š** ä½¿ç”¨ BigQuery é™æ¸¬è³‡æ–™ã€Cloud Logging å’Œ Cloud Trace è¿½è¹¤æ•ˆèƒ½ä¸¦æ”¶é›†æ´è¦‹ï¼Œä»¥è¿­ä»£æ‚¨çš„æ‡‰ç”¨ç¨‹å¼ã€‚

å°ˆæ¡ˆä¸­åŒ…å«ä¸€å€‹ `GEMINI.md` æª”æ¡ˆï¼Œç•¶æ‚¨å°ç¯„æœ¬æå‡ºå•é¡Œæ™‚ï¼Œå®ƒæœƒç‚º Gemini CLI ç­‰ AI å·¥å…·æä¾›ä¸Šä¸‹æ–‡ã€‚

## éƒ¨ç½²

> **æ³¨æ„ï¼š** è‹¥è¦ä½¿ç”¨ Terraform é€éå–®ä¸€æŒ‡ä»¤ç°¡åŒ–æ•´å€‹ CI/CD ç®¡é“å’ŒåŸºç¤è¨­æ–½çš„éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [`agent-starter-pack setup-cicd` CLI æŒ‡ä»¤](https://googlecloudplatform.github.io/agent-starter-pack/cli/setup_cicd.html)ã€‚ç›®å‰æ”¯æ´ GitHubï¼Œä¸¦å¯ä½¿ç”¨ Google Cloud Build å’Œ GitHub Actions ä½œç‚º CI/CD åŸ·è¡Œå™¨ã€‚

### é–‹ç™¼ç’°å¢ƒ

æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¸¬è©¦å°é–‹ç™¼ç’°å¢ƒçš„éƒ¨ç½²ï¼š

```bash
gcloud config set project <your-dev-project-id>
make deploy
```

æ­¤å„²å­˜åº«åŒ…å«ç”¨æ–¼è¨­å®šé–‹ç™¼ Google Cloud å°ˆæ¡ˆçš„ Terraform è¨­å®šã€‚
è«‹åƒé–± [deployment/README.md](deployment/README.md) ä»¥å–å¾—èªªæ˜ã€‚

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

æ­¤å„²å­˜åº«åŒ…å«ç”¨æ–¼è¨­å®šç”Ÿç”¢ Google Cloud å°ˆæ¡ˆçš„ Terraform è¨­å®šã€‚æœ‰é—œå¦‚ä½•éƒ¨ç½²åŸºç¤è¨­æ–½å’Œæ‡‰ç”¨ç¨‹å¼çš„è©³ç´°èªªæ˜ï¼Œè«‹åƒé–± [deployment/README.md](deployment/README.md)ã€‚

## ç›£æ§èˆ‡å¯è§€æ¸¬æ€§

æ‡‰ç”¨ç¨‹å¼æä¾›å…©å€‹å±¤ç´šçš„å¯è§€æ¸¬æ€§ï¼š

**1. ä»£ç†ç¨‹å¼é™æ¸¬äº‹ä»¶ (å§‹çµ‚å•Ÿç”¨)**

- OpenTelemetry è¿½è¹¤å’Œè·¨åº¦åŒ¯å‡ºè‡³ **Cloud Trace**
- è¿½è¹¤ä»£ç†ç¨‹å¼åŸ·è¡Œã€å»¶é²å’Œç³»çµ±æŒ‡æ¨™

**2. æç¤º-å›æ‡‰è¨˜éŒ„ (å¯è¨­å®š)**

- GenAI æª¢æ¸¬å·¥å…·æœƒæ“·å– LLM äº’å‹• (æ¬Šæ–ã€æ¨¡å‹ã€æ™‚é–“)
- åŒ¯å‡ºè‡³ **Google Cloud Storage** (JSONL)ã€**BigQuery** (å¤–éƒ¨è³‡æ–™è¡¨) å’Œ **Cloud Logging** (å°ˆç”¨å„²å­˜æ¡¶)

| ç’°å¢ƒ                             | æç¤º-å›æ‡‰è¨˜éŒ„                                        |
| -------------------------------- | ---------------------------------------------------- |
| **æœ¬æ©Ÿé–‹ç™¼** (`make playground`) | âŒ é è¨­åœç”¨                                           |
| **å·²éƒ¨ç½²ç’°å¢ƒ** (é€é Terraform)  | âœ… **é è¨­å•Ÿç”¨** (ä¿è­·éš±ç§ï¼šåƒ…å…ƒè³‡æ–™ï¼Œç„¡æç¤º/å›æ‡‰å…§å®¹) |

**è‹¥è¦åœ¨æœ¬æ©Ÿå•Ÿç”¨ï¼š** è¨­å®š `LOGS_BUCKET_NAME` å’Œ `OTEL_INSTRUMENTATION_GENAI_CAPTURE_MESSAGE_CONTENT=NO_CONTENT`ã€‚

**è‹¥è¦åœ¨éƒ¨ç½²ä¸­åœç”¨ï¼š** ç·¨è¼¯ Terraform è¨­å®šï¼Œå°‡ `OTEL_INSTRUMENTATION_GENAI_CAPTURE_MESSAGE_CONTENT=false`ã€‚

æœ‰é—œè©³ç´°èªªæ˜ã€ç¯„ä¾‹æŸ¥è©¢å’Œè¦–è¦ºåŒ–é¸é …ï¼Œè«‹åƒé–±[å¯è§€æ¸¬æ€§æŒ‡å—](https://googlecloudplatform.github.io/agent-starter-pack/guide/observability.html)ã€‚

---

## å››é¢å‘æ•´åˆåˆ†æ

æœ¬å°ˆæ¡ˆæ•´åˆäº† RAG (æª¢ç´¢å¢å¼·ç”Ÿæˆ)ã€Agent é–‹ç™¼ã€å®‰å…¨èˆ‡é‹ç‡Ÿç­‰æ ¸å¿ƒèƒ½åŠ›ã€‚ä»¥ä¸‹å¾å››å€‹é—œéµé¢å‘å±•é–‹è©³ç´°åˆ†æï¼š

### 1ï¸âƒ£ Agent Operations (ä»£ç†é‹ç‡Ÿ)

**æ¦‚è¿°**
Agent Operations è² è²¬ä»£ç†ç¨‹å¼çš„ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ŒåŒ…æ‹¬éƒ¨ç½²ã€ç›£æ§ã€ç¶­é‹èˆ‡å¯è§€æ¸¬æ€§ã€‚

**æ ¸å¿ƒæ‡‰ç”¨æœå‹™**

| æœå‹™                           | åŠŸèƒ½                     | æ‡‰ç”¨å ´æ™¯                                       |
| ------------------------------ | ------------------------ | ---------------------------------------------- |
| **Cloud Run**                  | ç„¡ä¼ºæœå™¨å®¹å™¨é‹è¡Œç’°å¢ƒ     | éƒ¨ç½² FastAPI æ‡‰ç”¨ï¼Œè‡ªå‹•æ“´å±•ä»¥æ‡‰å°è®Šå‹•æµé‡      |
| **Cloud SQL (PostgreSQL)**     | å¯é çš„æœƒè©±èˆ‡ç‹€æ…‹å­˜å„²     | ç¶­æŒä»£ç†èˆ‡ä½¿ç”¨è€…çš„å°è©±ä¸Šä¸‹æ–‡ï¼Œæ”¯æ´éåŒæ­¥é€£æ¥   |
| **Cloud Logging & BigQuery**   | é›†ä¸­å¼æ—¥èªŒèˆ‡é™æ¸¬åˆ†æ     | æ”¶é›†åŸ·è¡Œæ—¥èªŒã€è¿½è¹¤æ•ˆèƒ½æŒ‡æ¨™ã€åˆ†æä½¿ç”¨è€…äº’å‹•æ¨¡å¼ |
| **Cloud Trace**                | OpenTelemetry åˆ†ä½ˆå¼è¿½è¹¤ | ç›£æ§ä»£ç†åŸ·è¡Œå»¶é²ã€è­˜åˆ¥æ€§èƒ½ç“¶é ¸                 |
| **Google Cloud Storage (GCS)** | ç”¢ç‰©èˆ‡æ—¥èªŒå„²å­˜           | å­˜å„²é™æ¸¬æ•¸æ“šã€æ¨¡å‹ç”¢ç‰©ã€åŸ·è¡Œæ—¥èªŒ (JSONL)       |
| **Secret Manager**             | æ•æ„Ÿä¿¡æ¯ç®¡ç†             | å®‰å…¨å­˜å„²è³‡æ–™åº«å¯†ç¢¼ã€API å¯†é‘°                   |

**éƒ¨ç½²æ¶æ§‹**
- é–‹ç™¼ç’°å¢ƒï¼šç°¡åŒ–æ¶æ§‹ï¼Œè³‡æ–™åº«å‚™ä»½é è¨­é—œé–‰ï¼Œå¿«é€Ÿè¿­ä»£æ¸¬è©¦
- ç”Ÿç”¢ç’°å¢ƒï¼šå®Œæ•´ç›£æ§ã€è‡ªå‹•å‚™ä»½ã€å¤šå±¤å®‰å…¨ã€é«˜å¯ç”¨è¨­ç½®
- CI/CD æ•´åˆï¼šGitHub Actions + Google Cloud Buildï¼Œè‡ªå‹•åŒ–æ¸¬è©¦èˆ‡éƒ¨ç½²

**ç›£æ§èˆ‡å¯è§€æ¸¬æ€§ç­–ç•¥**
```
ä»£ç†ç¨‹å¼åŸ·è¡Œ
    â†“
OpenTelemetry (è‡ªå‹•æª¢æ¸¬)
    â”œâ†’ Cloud Trace (åˆ†ä½ˆå¼è¿½è¹¤)
    â”œâ†’ GenAI æª¢æ¸¬ (LLM äº¤äº’è¨˜éŒ„)
    â””â†’ é™æ¸¬åŒ¯å‡º
         â”œâ†’ Cloud Logging (å¯¦æ™‚æ—¥èªŒ)
         â”œâ†’ GCS (JSONL æ ¼å¼)
         â””â†’ BigQuery (åˆ†æç”¨å¤–éƒ¨è¡¨)
```

**é—œéµæŒ‡ä»¤**
```bash
make setup-dev-env      # ä½¿ç”¨ Terraform éƒ¨ç½²é–‹ç™¼ç’°å¢ƒè³‡æº
make deploy             # éƒ¨ç½²åˆ° Cloud Run (æ”¯æ´ IAP èªè­‰)
make test               # åŸ·è¡Œæ•´åˆèˆ‡å–®å…ƒæ¸¬è©¦
```

---

### 2ï¸âƒ£ Agent Security (ä»£ç†å®‰å…¨)

**æ¦‚è¿°**
Agent Security æ¶µè“‹èº«ä»½é©—è­‰ã€æˆæ¬Šã€æ•¸æ“šéš±ç§èˆ‡åˆè¦æ€§ï¼Œç¢ºä¿ä»£ç†ç³»çµ±çš„å®‰å…¨æ€§ã€‚

**æ ¸å¿ƒæ‡‰ç”¨æœå‹™**

| æœå‹™                                   | åŠŸèƒ½             | æ‡‰ç”¨å ´æ™¯                                                        |
| -------------------------------------- | ---------------- | --------------------------------------------------------------- |
| **Workload Identity Federation (WIF)** | ç„¡å¯†é‘°èªè­‰       | GitHub Actions èˆ‡ GCP é–“çš„å®‰å…¨ä¿¡ä»»é—œä¿‚ï¼Œç„¡éœ€é•·æœŸå¯†é‘°            |
| **Identity-Aware Proxy (IAP)**         | API å±¤ç´šè¨ªå•æ§åˆ¶ | åœ¨ Cloud Run å‰è¨­ç½®èº«ä»½é©—è­‰ï¼Œç¢ºä¿åªæœ‰æˆæ¬Šç”¨æˆ¶å¯è¨ªå•             |
| **Cloud IAM (æœå‹™å¸³è™Ÿ)**               | æœ€å°æ¬Šé™åŸå‰‡     | ä»£ç†ç¨‹å¼åªç²å¾—åŸ·è¡Œå¿…éœ€çš„æœ€å°æ¬Šé™ (GCS è®€å¯«ã€SQL é€£æ¥ã€API èª¿ç”¨) |
| **Secret Manager**                     | æ•æ„Ÿä¿¡æ¯éš±è—     | ä¿è­·è³‡æ–™åº«å¯†ç¢¼ã€API é‡‘é‘°ï¼Œé‹è¡Œæ™‚å‹•æ…‹æ³¨å…¥ç’°å¢ƒè®Šæ•¸                |
| **VPC & Network**                      | ç¶²è·¯éš”é›¢         | å¯é¸ï¼šåœ¨å°ˆç”¨ç¶²è·¯ä¸­é‹è¡Œ Cloud Runï¼Œå¢å¼·ç¶²è·¯é‚Šç•Œå®‰å…¨              |
| **Vertex AI Search æ¬Šé™**              | æ•¸æ“šè¨ªå•æ§åˆ¶     | é™åˆ¶èª°å¯ä»¥è¨ªå•ç‰¹å®šçš„è³‡æ–™å­˜å„² (datastore)                        |

**æ•¸æ“šéš±ç§ä¿è­·**
```
æœ¬æ©Ÿé–‹ç™¼ç’°å¢ƒ
    â”œâ†’ æç¤º-å›æ‡‰è¨˜éŒ„ï¼šé è¨­åœç”¨ âŒ
    â””â†’ åƒ…é™æ¸¬ï¼šç„¡æ•æ„Ÿæ•¸æ“šä¸Šå‚³

å·²éƒ¨ç½²ç’°å¢ƒ
    â”œâ†’ æç¤º-å›æ‡‰è¨˜éŒ„ï¼šé è¨­å•Ÿç”¨ âœ…
    â”œâ†’ éš±ç§æ¨¡å¼ï¼šåƒ…è¨˜éŒ„å…ƒæ•¸æ“š (æ¬Šæ–æ•¸ã€æ¨¡å‹åã€è€—æ™‚)
    â””â†’ ç„¡æç¤º/å›æ‡‰å…§å®¹ï¼šæ•æ„Ÿä¿¡æ¯ä¸è¢«å­˜å„²
```

**èªè­‰æµç¨‹**
```
User Request
    â†“
IAP (èº«ä»½é©—è­‰å±¤)
    â†“
Cloud Run (WIF + IAM)
    â”œâ†’ é©—è­‰æœå‹™å¸³è™Ÿ
    â”œâ†’ æª¢æŸ¥ IAM æ¬Šé™
    â””â†’ é™„åŠ æ†‘è­‰å­˜å–ä¸‹æ¸¸æœå‹™
         â”œâ†’ Cloud SQL
         â”œâ†’ Vertex AI Search
         â””â†’ GCS
```

**å®‰å…¨æœ€ä½³å¯¦è¸**
- âœ… ä½¿ç”¨ Workload Identity Federationï¼Œé¿å…é•·æœŸå¯†é‘°ç®¡ç†
- âœ… å•Ÿç”¨ IAP æä¾›æ‡‰ç”¨ç¨‹å¼å±¤ç´šçš„èº«ä»½é©—è­‰
- âœ… éµå¾ªæœ€å°æ¬Šé™åŸå‰‡é…ç½® IAM è§’è‰²
- âœ… ä½¿ç”¨ Secret Manager è€Œéç’°å¢ƒè®Šæ•¸å­˜å„²å¯†é‘°
- âœ… å®šæœŸå¯©æŸ¥èˆ‡æ›´æ–°å®‰å…¨ç­–ç•¥

**ç›¸é—œè³‡æº**
åƒé–± [deployment/terraform/wif.tf](deployment/terraform/wif.tf) å’Œ [deployment/terraform/iam.tf](deployment/terraform/iam.tf) äº†è§£å…·é«”é…ç½®ã€‚

---

### 3ï¸âƒ£ Agent Development (ä»£ç†é–‹ç™¼)

**æ¦‚è¿°**
Agent Development æ¶µè“‹å¾åŸå‹è¨­è¨ˆåˆ°ç”Ÿç”¢ç´šä»£ç†çš„æ•´å€‹é–‹ç™¼ç”Ÿå‘½é€±æœŸï¼Œåˆ©ç”¨ ADK æ¡†æ¶èˆ‡ LangChain ç”Ÿæ…‹ã€‚

**æ ¸å¿ƒæ‡‰ç”¨æœå‹™èˆ‡å·¥å…·æ£§**

| å±¤ç´š           | æœå‹™/å·¥å…·             | åŠŸèƒ½               | ç”¨é€”                                 |
| -------------- | --------------------- | ------------------ | ------------------------------------ |
| **LLM æ ¸å¿ƒ**   | Gemini 3.0 Flash      | é«˜æ•ˆçš„å¤šæ¨¡æ…‹ LLM   | ä»£ç†æ¨ç†ã€æŒ‡ä»¤éµå¾ªã€å…§å®¹ç”Ÿæˆ         |
| **Agent æ¡†æ¶** | Google ADK (v0.29.3)  | ä»£ç†é–‹ç™¼å¥—ä»¶       | å®šç¾©ä»£ç†ã€ç·¨æ’å·¥ä½œæµç¨‹ã€äº‹ä»¶é©…å‹•åŸ·è¡Œ |
| **LLM é›†æˆ**   | LangChain + Vertex AI | æ¨¡å‹æŠ½è±¡å±¤         | æ”¯æŒå¤šæ¨¡å‹åˆ‡æ›ã€åµŒå…¥ã€æ–‡æœ¬åˆ†å‰²       |
| **Web æœå‹™**   | FastAPI + Uvicorn     | éåŒæ­¥ Web æ¡†æ¶    | REST APIã€WebSocket æ”¯æ´ã€ç†±é‡è¼‰é–‹ç™¼ |
| **ä¾è³´ç®¡ç†**   | UV                    | ç¾ä»£ Python åŒ…ç®¡ç† | å¿«é€Ÿè§£æã€é–å®šç‰ˆæœ¬ã€è™›æ“¬ç’°å¢ƒç®¡ç†     |
| **æ¸¬è©¦æ¡†æ¶**   | Pytest + æ•´åˆæ¸¬è©¦     | è‡ªå‹•åŒ–æ¸¬è©¦         | å–®å…ƒæ¸¬è©¦ã€ç«¯å°ç«¯æ¸¬è©¦ã€è² è¼‰æ¸¬è©¦       |
| **ä»£ç¢¼æª¢æŸ¥**   | Ruff, MyPy, Codespell | ä»£ç¢¼è³ªé‡           | å‹åˆ¥æª¢æŸ¥ã€é¢¨æ ¼æª¢æŸ¥ã€æ‹¼å¯«æª¢æŸ¥         |
| **é–‹ç™¼ç­†è¨˜æœ¬** | Jupyter               | äº’å‹•å¼é–‹ç™¼         | å¿«é€ŸåŸå‹ã€æ•¸æ“šæ¢ç´¢ã€ä»£ç†è©•ä¼°         |

**ä»£ç†æ¶æ§‹æ ¸å¿ƒçµ„ä»¶**

```
ç”¨æˆ¶è«‹æ±‚
    â†“
[FastAPI æ‡‰ç”¨å±¤] (app/fast_api_app.py)
    â”œâ†’ æœƒè©±ç®¡ç† (Cloud SQL + PostgreSQL)
    â”œâ†’ æ­·å²ä¸Šä¸‹æ–‡ç®¡ç†
    â””â†’ åé¥‹æ”¶é›†
    â†“
[ä»£ç†é‚è¼¯å±¤] (app/agent.py)
    â”œâ†’ Gemini 3.0 Flash LLM
    â”œâ†’ å·¥å…·é›†
    â”‚   â””â†’ retrieve_docs (æª¢ç´¢å·¥å…·)
    â””â†’ æç¤ºæŒ‡ä»¤ (System Prompt)
    â†“
[æª¢ç´¢å±¤] (app/retrievers.py)
    â”œâ†’ Vertex AI Search æª¢ç´¢å™¨
    â”‚   â”œâ†’ æŸ¥è©¢å‘é‡åŒ– (text-embedding-005)
    â”‚   â”œâ†’ èªç¾©æœç´¢
    â”‚   â””â†’ è‡ªè¨‚åµŒå…¥é›†æˆ
    â””â†’ Vertex AI Rank é‡æ’å™¨
        â””â†’ ç›¸é—œæ€§é‡æ–°æ’åº
    â†“
ç”Ÿæˆèˆ‡å›æ‡‰
```

**é–‹ç™¼å·¥ä½œæµç¨‹**

```
1ï¸âƒ£ åŸå‹è¨­è¨ˆ
   â”œâ†’ notebooks/adk_app_testing.ipynb
   â”œâ†’ notebooks/evaluating_adk_agent.ipynb
   â””â†’ ä½¿ç”¨ Vertex AI Evaluation è©•ä¼°æ•ˆèƒ½

2ï¸âƒ£ ä»£ç¢¼é›†æˆ
   â”œâ†’ ç·¨è¼¯ app/agent.py (ä»£ç†é‚è¼¯)
   â”œâ†’ å®šç¾©è‡ªè¨‚å·¥å…·å‡½æ•¸
   â””â†’ è¨­å®š LLM åƒæ•¸èˆ‡æŒ‡ä»¤

3ï¸âƒ£ æœ¬æ©Ÿæ¸¬è©¦
   â”œâ†’ make install (å®‰è£ä¾è³´)
   â”œâ†’ make playground (å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ï¼Œæ”¯æ´ç†±é‡è¼‰)
   â””â†’ make test (åŸ·è¡Œè‡ªå‹•åŒ–æ¸¬è©¦)

4ï¸âƒ£ è³ªé‡æª¢æŸ¥
   â”œâ†’ make lint (Ruff, MyPy, Codespell)
   â””â†’ make test (åŒ…æ‹¬æ•´åˆæ¸¬è©¦)

5ï¸âƒ£ éƒ¨ç½²
   â”œâ†’ make deploy (æœ¬åœ°éƒ¨ç½²æ¸¬è©¦)
   â””â†’ make setup-cicd (å®Œæ•´ CI/CD ç®¡é“)
```

**å·¥å…·å®šç¾©æœ€ä½³å¯¦è¸**

```python
# app/agent.py ä¸­çš„å·¥å…·ç¤ºä¾‹
def retrieve_docs(query: str, context: ToolContext) -> str:
    """æª¢ç´¢ç›¸é—œæ–‡æª”çš„ä»£ç†å·¥å…·"""
    # 1. æª¢ç´¢ (Retrieval)
    docs = retriever.invoke({"query": query})

    # 2. é‡æ’ (Re-ranking)
    compressed = compressor.compress_documents(docs)

    # 3. æ ¼å¼åŒ– (Formatting)
    return format_docs(compressed)
```

**ä¾è³´ç‰ˆæœ¬ç®¡ç†**
- Python: >= 3.10, < 3.14
- google-adk: >= 1.15.0, < 2.0.0
- langchain: ~0.3.24
- Vertex AI SDK: >= 1.118.0, < 2.0.0

**é—œéµæ–‡ä»¶**
- [GEMINI.md](GEMINI.md) - ADK é€ŸæŸ¥è¡¨èˆ‡æœ€ä½³å¯¦è¸
- [notebooks/](notebooks/) - äº’å‹•å¼é–‹ç™¼èˆ‡è©•ä¼°
- [tests/](tests/) - è‡ªå‹•åŒ–æ¸¬è©¦å¥—ä»¶

---

### 4ï¸âƒ£ Knowledge Management & RAG (çŸ¥è­˜ç®¡ç†èˆ‡ RAG)

**æ¦‚è¿°**
Knowledge Management èˆ‡ RAG æ˜¯æœ¬å°ˆæ¡ˆçš„æ ¸å¿ƒï¼Œé€šéçµæ§‹åŒ–çš„è³‡æ–™ç®¡é“èˆ‡æ™ºèƒ½æª¢ç´¢ï¼Œç‚ºä»£ç†æä¾›å‹•æ…‹çŸ¥è­˜åŸºç¤ã€‚

**æ ¸å¿ƒæ‡‰ç”¨æœå‹™èˆ‡å·¥ä½œæµç¨‹**

| æœå‹™                     | è§’è‰²     | é—œéµåŠŸèƒ½                                            |
| ------------------------ | -------- | --------------------------------------------------- |
| **Vertex AI Pipelines**  | ç®¡é“å”èª¿ | ç·¨æ’è³‡æ–™è™•ç†æµç¨‹ï¼Œç®¡ç†ä¾è³´é—œä¿‚èˆ‡é‡è©¦                |
| **BigQuery**             | è³‡æ–™ä¸­æ¨ | åŸå§‹è³‡æ–™ä¾†æº (å¦‚ StackOverflow)ã€å¢é‡æ•¸æ“šã€å»é‡å­˜å„² |
| **Vertex AI Embeddings** | å‘é‡åŒ–   | text-embedding-005 æ¨¡å‹ï¼Œå°‡æ–‡æœ¬è½‰æ›ç‚º 768 ç¶­å‘é‡    |
| **Google Cloud Storage** | ä¸­ç¹¼å­˜å„² | JSONL æ ¼å¼æ–‡ä»¶äº¤æ›é»ï¼Œé€£æ¥è³‡æ–™è™•ç†èˆ‡ç´¢å¼•            |
| **Vertex AI Search**     | æ™ºèƒ½ç´¢å¼• | æ§‹å»ºå¯æœç´¢çš„å‘é‡ç´¢å¼•ï¼Œæ”¯æŒèªç¾©æª¢ç´¢                  |
| **Vertex AI Rank**       | é‡æ–°æ’åº | æ ¹æ“šæŸ¥è©¢ç›¸é—œæ€§é‡æ–°æ’åˆ—æª¢ç´¢çµæœ                      |

**æ•¸æ“šç®¡é“æµç¨‹ (Data Ingestion Pipeline)**

```
bigquery.PublicDatasets (StackOverflow)
    â†“ [1. è³‡æ–™ç²å–]
BigQuery åŸå§‹è¡¨
    â†“ [2. é è™•ç†]
    â”œâ†’ HTML â†’ Markdown è½‰æ›
    â”œâ†’ æ–‡æœ¬åˆä½µ (æ¨™é¡Œ + å…§å®¹ + ç­”æ¡ˆ)
    â””â†’ æ•¸æ“šæ¸…ç†
    â†“ [3. æ–‡æœ¬åˆ†å¡Š]
    â””â†’ RecursiveCharacterTextSplitter
        â”œâ†’ chunk_size: 1500 å­—ç¬¦
        â””â†’ chunk_overlap: 20 å­—ç¬¦
    â†“ [4. å‘é‡åŒ–]
    â””â†’ text-embedding-005
        â””â†’ ç”Ÿæˆ 768 ç¶­åµŒå…¥å‘é‡
    â†“ [5. å»é‡ & å„²å­˜]
    â”œâ†’ incremental_questions_embeddings (å¢é‡)
    â””â†’ questions_embeddings (å»é‡)
    â†“ [6. å°å‡º]
    â””â†’ GCS (JSONL æ ¼å¼)
    â†“ [7. ç´¢å¼•æ§‹å»º]
    â””â†’ Vertex AI Search
        â”œâ†’ Schema æ›´æ–°
        â”œâ†’ æ–‡ä»¶åŒ¯å…¥
        â””â†’ ç´¢å¼•å»ºç«‹
```

**RAG æª¢ç´¢æµç¨‹ (Query Handling)**

```
ç”¨æˆ¶æŸ¥è©¢
    â†“
[æŸ¥è©¢å‘é‡åŒ–]
    â””â†’ text-embedding-005 (èˆ‡ç´¢å¼•æ§‹å»ºåŒä¸€æ¨¡å‹)
    â†“
[èªç¾©æœç´¢]
    â”œâ†’ Vertex AI Search Retriever
    â”‚   â”œâ†’ ç›¸ä¼¼åº¦åŒ¹é… (è‡ªè¨‚åµŒå…¥ + åŸç”Ÿæœç´¢æ··åˆ)
    â”‚   â”œâ†’ custom_embedding_ratio: 0.5 (å¯èª¿)
    â”‚   â””â†’ æª¢ç´¢ max_documents: 10
    â†“
[ç›¸é—œæ€§é‡æ’]
    â””â†’ Vertex AI Rank
        â”œâ†’ æŒ‰ç›¸é—œæ€§é‡æ–°è©•åˆ†
        â””â†’ ä¿ç•™ top_n: 5 çµæœ
    â†“
[ä¸Šä¸‹æ–‡æ ¼å¼åŒ–] (app/templates.py)
    â””â†’ Markdown æ ¼å¼åŒ–
    â†“
[ä»£ç†æ¨ç†]
    â”œâ†’ æ¥æ”¶çµæ§‹åŒ–ä¸Šä¸‹æ–‡
    â”œâ†’ Gemini LLM ç”Ÿæˆå›æ‡‰
    â””â†’ æ•´åˆæª¢ç´¢çµæœèˆ‡ LLM æ¨ç†
    â†“
æœ€çµ‚å›æ‡‰
```

**æ ¸å¿ƒåƒæ•¸é…ç½®**

| åƒæ•¸                     | é è¨­å€¼             | èªªæ˜               | èª¿æ•´å»ºè­°                           |
| ------------------------ | ------------------ | ------------------ | ---------------------------------- |
| `EMBEDDING_MODEL`        | text-embedding-005 | ç”¨æ–¼ç”Ÿæˆå‘é‡çš„æ¨¡å‹ | ç¢ºä¿èˆ‡ RAG æª¢ç´¢ä½¿ç”¨åŒä¸€æ¨¡å‹        |
| `chunk_size`             | 1500               | æ–‡æœ¬åˆ†å¡Šå¤§å°       | è¼ƒå¤§å€¼ = æ›´å¤šä¸Šä¸‹æ–‡ä½†è¨ˆç®—æˆæœ¬å¢åŠ   |
| `chunk_overlap`          | 20                 | åˆ†å¡Šé‡ç–Š           | ä¿ç•™ä¸Šä¸‹æ–‡é€£çºŒæ€§                   |
| `max_documents`          | 10                 | æª¢ç´¢æ–‡æª”æ•¸         | å¹³è¡¡ç›¸é—œæ€§èˆ‡æˆæœ¬                   |
| `top_n` (é‡æ’)           | 5                  | æœ€çµ‚å›å‚³æ–‡æª”æ•¸     | æ§åˆ¶ä¸Šä¸‹æ–‡çª—å£å¤§å°                 |
| `custom_embedding_ratio` | 0.5                | è‡ªè¨‚åµŒå…¥æ¬Šé‡       | 0.0 = ç´”åŸç”Ÿæœç´¢ï¼Œ1.0 = ç´”è‡ªè¨‚åµŒå…¥ |

**è³‡æ–™ç”Ÿå‘½é€±æœŸç®¡ç†**

```
åˆå§‹åŠ è¼‰ (Full Import)
    â†“ è¨­ç½®åŸºç¤ç´¢å¼•
å®šæœŸæ›´æ–° (Incremental)
    â”œâ†’ å·®é‡æª¢æ¸¬ (æŒ‰æ™‚é–“ç¯„åœ)
    â”œâ†’ å¢é‡è™•ç†
    â””â†’ å»é‡åˆä½µ
    â†“
å¯¦æ™‚æŸ¥è©¢æœå‹™
    â”œâ†’ å‘é‡åŒ–
    â”œâ†’ èªç¾©æœç´¢
    â””â†’ æ’åºèˆ‡é‡æ’
```

**çŸ¥è­˜ç®¡ç†æœ€ä½³å¯¦è¸**

- âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šä½¿ç”¨å»é‡è¡¨ (`questions_embeddings`) ç¶­æŒè³‡æ–™ä¸€è‡´æ€§
- âœ… **å¢é‡æ›´æ–°**ï¼šé…ç½® `look_back_days` é€²è¡Œå·®é‡è™•ç†ï¼Œå„ªåŒ–æˆæœ¬
- âœ… **åµŒå…¥æ¨¡å‹ä¸€è‡´æ€§**ï¼šç´¢å¼•èˆ‡æŸ¥è©¢ä½¿ç”¨åŒä¸€åµŒå…¥æ¨¡å‹ç¢ºä¿èªç¾©å°é½
- âœ… **åˆ†å¡Šç­–ç•¥**ï¼šæ ¹æ“šå…§å®¹é¡å‹èª¿æ•´ `chunk_size`ï¼Œå¹³è¡¡ä¸Šä¸‹æ–‡èˆ‡ç²¾åº¦
- âœ… **ç›£æ§ç´¢å¼•å¥åº·**ï¼šå®šæœŸæª¢æŸ¥ç´¢å¼•å®Œæ•´æ€§èˆ‡æœç´¢å»¶é²
- âœ… **éš±ç§ä¿è­·**ï¼šæ•æ„Ÿä¿¡æ¯é€²è¡Œæ©è”½æˆ–éæ¿¾å¾Œå†ç´¢å¼•

**ç®¡é“åŸ·è¡Œèˆ‡ç›£æ§**

```bash
# é‹è¡Œè³‡æ–™æ“·å–ç®¡é“
make data-ingestion

# åœ¨ Google Cloud Console ç›£æ§
# Vertex AI â†’ Pipelines â†’ [pipeline_name] â†’ æŸ¥çœ‹åŸ·è¡Œæ—¥èªŒèˆ‡æ™‚åºåœ–
```

**ç›¸é—œæ–‡ä»¶**
- [data_ingestion/README.md](data_ingestion/README.md) - å®Œæ•´ç®¡é“æ–‡æª”
- [data_ingestion/data_ingestion_pipeline/pipeline.py](data_ingestion/data_ingestion_pipeline/pipeline.py) - ç®¡é“å®šç¾©
- [data_ingestion/data_ingestion_pipeline/components/](data_ingestion/data_ingestion_pipeline/components/) - å„å…ƒä»¶å¯¦ç¾

---

## ç¶œåˆæ‡‰ç”¨å ´æ™¯ç¤ºä¾‹

### ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹

```
1. çŸ¥è­˜æº–å‚™ (Knowledge Management)
   â””â†’ è³‡æ–™æ“·å–ç®¡é“ â†’ BigQuery â†’ Vertex AI Search

2. ä»£ç†é–‹ç™¼ (Agent Development)
   â””â†’ å®šç¾©å·¥å…· & æŒ‡ä»¤ â†’ æœ¬æ©Ÿæ¸¬è©¦ â†’ è³ªé‡æª¢æŸ¥

3. ä»£ç†éƒ¨ç½² (Agent Operations)
   â””â†’ Terraform ä½ˆå»º â†’ Cloud Run éƒ¨ç½² â†’ å•Ÿç”¨ç›£æ§

4. å®‰å…¨åŠ å›º (Agent Security)
   â””â†’ é…ç½® IAP & WIF â†’ è¨­ç½® IAM æ¬Šé™ â†’ å•Ÿç”¨é™æ¸¬éš±ç§æ¨¡å¼

5. é‹è¡Œèˆ‡å„ªåŒ–
   â””â†’ ç›£æ§èˆ‡åˆ†æ â†’ è¿­ä»£æ”¹é€² â†’ å¯¦æ™‚æ›´æ–°çŸ¥è­˜åº«
```

---

### å…§å®¹å®Œæ•´èªªæ˜

é€™ä»½å°è®€å°‡å¹«åŠ©æ‚¨å¿«é€Ÿäº†è§£å°ˆæ¡ˆçš„å„å€‹é‡è¦éƒ¨åˆ†ï¼š

- **å°ˆæ¡ˆæ ¹ç›®éŒ„**ï¼šå¾[**å°ˆæ¡ˆä¸»èªªæ˜æ–‡ä»¶ (README.md)**](README.md)é–‹å§‹ï¼Œé€™è£¡æä¾›äº†å°ˆæ¡ˆçš„æ•´é«”çµæ§‹ã€å¿«é€Ÿå…¥é–€æŒ‡å—ä»¥åŠæ ¸å¿ƒæŒ‡ä»¤ã€‚
- **è³‡æ–™æ“·å–**ï¼šå¦‚æœæ‚¨æƒ³äº†è§£è³‡æ–™å¦‚ä½•è¢«è™•ç†ã€è½‰æ›ä¸¦è¼‰å…¥è‡³ Vertex AI Searchï¼Œè«‹åƒé–±**[**è³‡æ–™æ“·å–ç®¡é“èªªæ˜ (data_ingestion/README.md)**](data_ingestion/README.md)ã€‚å…¶ä¸­åŒ…å«äº†è©³ç´°çš„æµç¨‹åœ–èˆ‡å…ƒä»¶èªªæ˜ã€‚
- **éƒ¨ç½²èˆ‡æ¶æ§‹**ï¼šé—œæ–¼å°ˆæ¡ˆçš„é›²ç«¯åŸºç¤è¨­æ–½ã€é–‹ç™¼èˆ‡ç”Ÿç”¢ç’°å¢ƒçš„æ¶æ§‹åœ–ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Terraform é€²è¡Œéƒ¨ç½²çš„è³‡è¨Šï¼Œéƒ½å¯ä»¥åœ¨[**éƒ¨ç½²èªªæ˜æ–‡ä»¶ (deployment/README.md)**](deployment/README.md)ä¸­æ‰¾åˆ°ã€‚
- **è² è¼‰æ¸¬è©¦**ï¼šè‹¥æ‚¨éœ€è¦å°æ‡‰ç”¨ç¨‹å¼é€²è¡Œå£“åŠ›æ¸¬è©¦ï¼Œ[**è² è¼‰æ¸¬è©¦æŒ‡å— (tests/load_test/README.md)**](tests/load_test/README.md)æä¾›äº†ä½¿ç”¨ Locust é€²è¡Œæœ¬åœ°å’Œé ç«¯æ¸¬è©¦çš„è©³ç´°æ­¥é©Ÿã€‚
- **ç’°å¢ƒè®Šæ•¸**ï¼šæœ‰é—œå¯ç”¨ç’°å¢ƒè®Šæ•¸çš„å®Œæ•´åˆ—è¡¨åŠå…¶èªªæ˜ï¼Œè«‹åƒé–±[**ç’°å¢ƒè®Šæ•¸èªªæ˜æ–‡ä»¶ (VARS.md)**](VARS.md)ã€‚

---
### åƒè€ƒè³‡æº
- [Agent Starter Pack æ–‡ä»¶](https://googlecloudplatform.github.io/agent-starter-pack/)
- [ADK GitHub å„²å­˜åº«](https://github.com/GoogleCloudPlatform/agent-starter-pack)
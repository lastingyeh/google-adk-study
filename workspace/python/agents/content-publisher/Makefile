# æ•™å­¸ 06ï¼šå¤šä»£ç†ç³»çµ± - å…§å®¹ç™¼å¸ƒç³»çµ±
# ç”¨æ–¼é–‹ç™¼ã€æ¸¬è©¦å’Œéƒ¨ç½²çš„ Makefile

.PHONY: help setup dev test clean demo

# é è¨­ç›®æ¨™
help:
	@echo "æ•™å­¸ 06ï¼šå¤šä»£ç†ç³»çµ± - å…§å®¹ç™¼å¸ƒç³»çµ±"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤ï¼š"
	@echo "  setup    å®‰è£ä¾è³´é …ä¸¦è¨­ç½®é–‹ç™¼ç’°å¢ƒ"
	@echo "  dev      å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼ˆADK ç¶²é ä»‹é¢ï¼‰"
	@echo "  test     åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶"
	@echo "  demo     åŸ·è¡Œå…§å®¹ç™¼å¸ƒç³»çµ±çš„å¿«é€Ÿç¤ºç¯„"
	@echo "  clean    æ¸…ç†æš«å­˜æª”æ¡ˆå’Œå¿«å–"
	@echo "  help     é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯"

# è¨­ç½®é–‹ç™¼ç’°å¢ƒ
setup:
	@echo "æ­£åœ¨è¨­ç½®æ•™å­¸ 06 é–‹ç™¼ç’°å¢ƒ..."
	pip install -r requirements.txt
	pip install -e .
	@echo "è¨­ç½®å®Œæˆï¼è¤‡è£½ content_publisher/.env.example åˆ° content_publisher/.env ä¸¦æ·»åŠ æ‚¨çš„ API é‡‘é‘°ã€‚"

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
dev: check-env
	@echo "æ­£åœ¨å•Ÿå‹• ADK é–‹ç™¼ä¼ºæœå™¨..."
	@echo "åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ http://localhost:8000"
	@echo "å¾ä»£ç†åˆ—è¡¨ä¸­é¸æ“‡ 'content_publisher'"
	@echo ""
	@echo "å¯å˜—è©¦çš„ç¯„ä¾‹æç¤ºï¼š"
	@echo "  - 'æ’°å¯«ä¸€ç¯‡é—œæ–¼äººå·¥æ™ºæ…§åœ¨é†«ç™‚ä¿å¥ä¸­æ‡‰ç”¨çš„æ–‡ç« '"
	@echo "  - 'å‰µå»ºä¸€ç¯‡é—œæ–¼å†ç”Ÿèƒ½æºæ¡ç”¨çš„æ–‡ç« '"
	@echo "  - 'æ’°å¯«é—œæ–¼é ç¨‹å·¥ä½œæœªä¾†çš„æ–‡ç« '"
	@echo "  - 'å‰µå»ºä¸€ç¯‡è§£é‡‹é‡å­è¨ˆç®—çªç ´çš„æ–‡ç« '"
	@echo ""
	adk web

# åŸ·è¡Œæ¸¬è©¦
test:
	@echo "æ­£åœ¨åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶..."
	pytest tests/ -v --tb=short

# å¿«é€Ÿç¤ºç¯„
demo:
	@echo "æ­£åœ¨åŸ·è¡Œå…§å®¹ç™¼å¸ƒç³»çµ±ç¤ºç¯„..."
	@echo "é€™å°‡æ¸¬è©¦åŸºæœ¬åŠŸèƒ½"
	@python -c "from content_publisher.agent import root_agent; print('âœ… å…§å®¹ç™¼å¸ƒç³»çµ±è¼‰å…¥æˆåŠŸï¼'); print(f'ä»£ç†åç¨±ï¼š{root_agent.name}'); print(f'ç®¡é“éšæ®µæ•¸é‡ï¼š{len(root_agent.sub_agents)}'); print('éšæ®µ 1ï¼ˆä¸¦è¡Œç ”ç©¶ï¼‰æœ‰', len(root_agent.sub_agents[0].sub_agents), 'å€‹ä½µç™¼ç®¡é“'); print('âœ… ç¤ºç¯„å®Œæˆï¼')"

# æ¸…ç†
clean:
	@echo "æ­£åœ¨æ¸…ç†æš«å­˜æª”æ¡ˆ..."
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.pyo" -delete 2>/dev/null || true
	find . -type f -name ".coverage" -delete 2>/dev/null || true
	find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	@echo "æ¸…ç†å®Œæˆï¼"

# æª¢æŸ¥ç’°å¢ƒï¼ˆå…§éƒ¨ä½¿ç”¨ï¼‰
check-env:
	@if [ -z "$$GOOGLE_API_KEY" ] && [ -z "$$GOOGLE_APPLICATION_CREDENTIALS" ]; then \
		echo "âŒ éŒ¯èª¤ï¼šæœªé…ç½®èº«ä»½é©—è­‰"; \
		echo ""; \
		echo "è«‹é¸æ“‡ä»¥ä¸‹èº«ä»½é©—è­‰æ–¹æ³•ä¹‹ä¸€ï¼š"; \
		echo ""; \
		echo "ğŸ”‘ æ–¹æ³• 1 - API é‡‘é‘°ï¼ˆGemini APIï¼‰ï¼š"; \
		echo "   export GOOGLE_API_KEY=your_api_key_here"; \
		echo "   åœ¨æ­¤ç²å–å…è²»é‡‘é‘°ï¼šhttps://aistudio.google.com/app/apikey"; \
		echo ""; \
		echo "ğŸ” æ–¹æ³• 2 - æœå‹™å¸³æˆ¶ï¼ˆVertexAIï¼‰ï¼š"; \
		echo "   export GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json"; \
		echo "   export GOOGLE_CLOUD_PROJECT=your_project_id"; \
		echo "   åœ¨æ­¤å‰µå»ºæ†‘è­‰ï¼šhttps://console.cloud.google.com/iam-admin/serviceaccounts"; \
		echo ""; \
		exit 1; \
	fi
.PHONY: help setup clean test demo dev

# é¡¯ç¤ºèªªæ˜è¨Šæ¯
help:
	@echo "æš«åœ/æ¢å¾©èª¿ç”¨ (Pause/Resume Invocations) TIL - å¯ç”¨æŒ‡ä»¤"
	@echo "=================================================="
	@echo ""
	@echo "make setup       å®‰è£ä¾è³´ä¸¦æº–å‚™ç’°å¢ƒ"
	@echo "make test        åŸ·è¡Œå–®å…ƒæ¸¬è©¦ï¼ˆé©—è­‰è¨­å®šï¼‰"
	@echo "make dev         å•Ÿå‹• ADK ç¶²é ä»‹é¢ä»¥æ¸¬è©¦æš«åœ/æ¢å¾©åŠŸèƒ½"
	@echo "make demo        ä¸ä½¿ç”¨ç¶²é ä»‹é¢çš„å¿«é€Ÿé©—è­‰"
	@echo "make clean       ç§»é™¤å¿«å–æª”æ¡ˆèˆ‡ç”¢å‡ºç‰©"
	@echo ""

# ç’°å¢ƒè¨­å®š
setup:
	pip install -r requirements.txt
	pip install -e .
	cp pause_resume_agent/.env.example pause_resume_agent/.env
	@echo ""
	@echo "âœ… è¨­å®šå®Œæˆï¼"
	@echo ""
	@echo "å¾ŒçºŒæ­¥é©Ÿï¼š"
	@echo "1. å°‡æ‚¨çš„ GOOGLE_API_KEY æ–°å¢è‡³ pause_resume_agent/.env"
	@echo "2. åŸ·è¡Œ 'make test' ä»¥é©—è­‰å¯¦ä½œ"
	@echo "3. åŸ·è¡Œ 'make dev' å•Ÿå‹•ç¶²é ä»‹é¢ä¸¦æ¸¬è©¦æš«åœ/æ¢å¾©åŠŸèƒ½"
	@echo ""

# é–‹ç™¼æ¨¡å¼ï¼šå•Ÿå‹• ADK UI
dev:
	@echo ""
	@echo "ğŸš€ æ­£åœ¨å•Ÿå‹• ADK ç¶²é ä»‹é¢..."
	@echo ""
	@echo "ğŸ“ å¦‚ä½•æ¸¬è©¦æš«åœ/æ¢å¾©èª¿ç”¨ (Pause/Resume Invocations)ï¼š"
	@echo "   1. é–‹å•Ÿ http://localhost:8000"
	@echo "   2. é¸æ“‡ 'pause_resume_agent'"
	@echo "   3. é–‹å§‹é•·å°è©±æˆ–è³‡æ–™è™•ç†ä»»å‹™"
	@echo "   4. æŸ¥çœ‹ Events åˆ†é ä»¥è§€å¯Ÿæª¢æŸ¥é» (checkpoint) äº‹ä»¶"
	@echo ""
	@echo "ğŸ’¡ è§€å¯Ÿé‡é»ï¼š"
	@echo "   â€¢ 'end_of_agent' äº‹ä»¶æ¨™è¨˜æª¢æŸ¥é»"
	@echo "   â€¢ æª¢æŸ¥é»äº‹ä»¶ä¸­çš„ 'agent_state' æ¬„ä½"
	@echo "   â€¢ è·¨èª¿ç”¨å¾Œçš„ç‹€æ…‹ä¿ç•™æƒ…å½¢"
	@echo "   â€¢ ä½¿ç”¨æª¢æŸ¥é»è³‡æ–™åŸ·è¡Œçš„å·¥å…· (Tool)"
	@echo ""
	@echo "ğŸ¯ å˜—è©¦é€™äº›æ¸¬è©¦æ¨¡å¼ï¼š"
	@echo "   1. è™•ç†è³‡æ–™ï¼š'Please process this data: <text>'"
	@echo "   2. è©¢å•æç¤ºï¼š'What checkpoint should I use?'"
	@echo "   3. é©—è­‰ï¼š'Can you validate this checkpoint?'"
	@echo ""
	@echo "â¸ï¸  æ¸¬è©¦æš«åœèˆ‡æ¢å¾©æµç¨‹ï¼š"
	@echo "   æ­¥é©Ÿ 1: ç™¼é€åˆå§‹è¨Šæ¯"
	@echo "     â†’ Agent è™•ç†ä¸¦å»ºç«‹æª¢æŸ¥é»"
	@echo "     â†’ å¾ Events åˆ†é è¤‡è£½ invocation_id"
	@echo ""
	@echo "   æ­¥é©Ÿ 2: [æš«åœ] è¨˜éŒ„ invocation_id èˆ‡ agent_state"
	@echo "     â†’ æª¢æŸ¥ Events åˆ†é ä¸­çš„ 'end_of_agent: true'"
	@echo "     â†’ è§€å¯Ÿåºåˆ—åŒ–å¾Œçš„ agent_state æ¬„ä½"
	@echo ""
	@echo "   æ­¥é©Ÿ 3: [ç¨å¾Œ] ä½¿ç”¨ç›¸åŒçš„ invocation_id æ¢å¾©"
	@echo "     â†’ ç™¼é€æ–°è¨Šæ¯æˆ–ä½¿ç”¨è©² Session"
	@echo "     â†’ ç‹€æ…‹å°‡è‡ªå‹•æ¢å¾©"
	@echo ""
	@echo "   æ­¥é©Ÿ 4: é©—è­‰ç‹€æ…‹æ¢å¾©"
	@echo "     â†’ Agent å¾æœ€å¾Œä¸€å€‹æª¢æŸ¥é»ç¹¼çºŒåŸ·è¡Œ"
	@echo "     â†’ æ¯”è¼ƒæ–°äº‹ä»¶èˆ‡å…ˆå‰ç‹€æ…‹"
	@echo ""
	@echo "ğŸ“Š éœ€æª¢æŸ¥çš„äº‹ä»¶ï¼š"
	@echo "   â€¢ å°‹æ‰¾ 'end_of_agent' = true çš„äº‹ä»¶"
	@echo "   â€¢ æª¢æŸ¥ 'agent_state' æ˜¯å¦åŒ…å«æ‚¨çš„æª¢æŸ¥é»è³‡æ–™"
	@echo "   â€¢ é©—è­‰ 'actions' æ¬„ä½åŒ…å«ç‹€æ…‹è³‡è¨Š"
	@echo "   â€¢ è¿½è¹¤ç”¨æ–¼æ¢å¾©çš„ 'invocation_id'"
	@echo ""
	adk web

# åŸ·è¡Œæ¸¬è©¦
test:
	@echo ""
	@echo "ğŸ§ª æ­£åœ¨åŸ·è¡Œæš«åœ/æ¢å¾©èª¿ç”¨æ¸¬è©¦..."
	@echo ""
	@pytest tests/ -v --tb=short
	@echo ""
	@echo "âœ… æ¸¬è©¦é©—è­‰é …ç›®ï¼š"
	@echo "   â€¢ Agent è¨­å®š (6 å€‹æ¸¬è©¦)"
	@echo "   â€¢ å·¥å…·åŠŸèƒ½ (8 å€‹æ¸¬è©¦)"
	@echo "   â€¢ åŒ¯å…¥è·¯å¾‘ (3 å€‹æ¸¬è©¦)"
	@echo "   â€¢ App èˆ‡å¯æ¢å¾©æ€§è¨­å®š (2 å€‹æ¸¬è©¦)"
	@echo ""
	@echo "ğŸ“‹ æ¸¬è©¦æ¶µè“‹ç¯„åœï¼š"
	@echo "   âœ“ Agent åç¨±ã€æ¨¡å‹ã€æè¿°ã€æŒ‡ä»¤"
	@echo "   âœ“ Agent å·²è¨­å®šå·¥å…· (3 å€‹å·¥å…·)"
	@echo "   âœ“ process_data_chunk() è™•ç†æœ‰æ•ˆ/ç©ºè³‡æ–™"
	@echo "   âœ“ validate_checkpoint() è™•ç†æœ‰æ•ˆ/ç©ºè³‡æ–™"
	@echo "   âœ“ get_resumption_hint() è™•ç†ä¸åŒä¸Šä¸‹æ–‡"
	@echo "   âœ“ Agent æ­£ç¢ºå°å‡ºä»¥ä¾›æ¢ç´¢"
	@echo "   âœ“ App åç¨±èˆ‡ root_agent æ­£ç¢º"
	@echo "   âœ“ å¯æ¢å¾©æ€§é…ç½®å·²å•Ÿç”¨ (is_resumable: true)"
	@echo ""
	@echo "ğŸ” æ¯å€‹æ¸¬è©¦é©—è­‰çš„å…§å®¹ï¼š"
	@echo "   Agent è¨­å®šæ¸¬è©¦ï¼š"
	@echo "     - Agent è¼‰å…¥æ­£ç¢ºåç¨±ï¼špause_resume_agent"
	@echo "     - æ¨¡å‹è¨­å®šç‚ºï¼šgemini-2.0-flash"
	@echo "     - æè¿°èˆ‡æŒ‡ä»¤å­˜åœ¨"
	@echo "     - 3 å€‹å·¥å…·çš†å¯ç”¨"
	@echo ""
	@echo "   å·¥å…·åŠŸèƒ½æ¸¬è©¦ï¼š"
	@echo "     - process_data_chunk è™•ç†æˆåŠŸ/éŒ¯èª¤æ¡ˆä¾‹"
	@echo "     - validate_checkpoint é©—è­‰ç‹€æ…‹å®Œæ•´æ€§"
	@echo "     - get_resumption_hint æä¾›ä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤º"
	@echo ""
	@echo "   åŒ¯å…¥èˆ‡é…ç½®æ¸¬è©¦ï¼š"
	@echo "     - å¯å¾å¥—ä»¶åŒ¯å…¥ Agent"
	@echo "     - App é…ç½®æ­£ç¢º"
	@echo "     - ResumabilityConfig å·²æ­£ç¢ºå•Ÿç”¨"
	@echo ""
	@echo "ğŸ’¡ åŸ·è¡Œç‰¹å®šæ¸¬è©¦ï¼š"
	@echo "   pytest tests/test_agent.py::TestAgentConfiguration -v"
	@echo "   pytest tests/test_agent.py::TestAgentTools -v"
	@echo ""
	@echo "ğŸ“Š æŸ¥çœ‹æ¸¬è©¦æ¶µè“‹ç‡ï¼š"
	@echo "   pytest tests/ --cov=pause_resume_agent --cov-report=html"
	@echo ""

# å¿«é€Ÿç¤ºç¯„
demo:
	@echo ""
	@echo "ğŸ” å¿«é€Ÿé©—è­‰..."
	python -c "from pause_resume_agent import root_agent; from app import app; print('âœ… Agent è¼‰å…¥:', root_agent.name); print('âœ… App é…ç½®:', app.name); print('âœ… å¯æ¢å¾©æ€§å·²å•Ÿç”¨:', app.resumability_config.is_resumable if app.resumability_config else False)"
	@echo ""
	@echo "ğŸ¯ å¯¦ä½œå·²å°±ç·’ï¼"
	@echo ""

# æ¸…ç†ç’°å¢ƒ
clean:
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	rm -rf .coverage htmlcov build dist *.egg-info
	@echo "âœ… å·²æ¸…ç†å¿«å–æª”æ¡ˆ"

### é‡é»æ‘˜è¦
- **æ ¸å¿ƒæ¦‚å¿µ**ï¼šæä¾›è‡ªå‹•åŒ–é–‹ç™¼èˆ‡æ¸¬è©¦æµç¨‹çš„æŒ‡ä»¤é›†ã€‚
- **é—œéµæŠ€è¡“**ï¼šä½¿ç”¨ `make` ç®¡ç†ç’°å¢ƒè¨­å®š (`setup`)ã€æ¸¬è©¦ (`test`)ã€é–‹ç™¼ä¼ºæœå™¨ (`dev`) åŠæ¸…ç† (`clean`)ã€‚
- **é‡è¦çµè«–**ï¼šé–‹ç™¼è€…æ‡‰å„ªå…ˆåŸ·è¡Œ `make setup` åˆå§‹åŒ–ï¼Œä¸¦é€é `make dev` åœ¨ ADK UI ä¸­è§€å¯Ÿæª¢æŸ¥é»è¡Œç‚ºã€‚
- **è¡Œå‹•é …ç›®**ï¼š
  1. åŸ·è¡Œ `make setup`ã€‚
  2. æ–¼ `.env` è¨­å®š API é‡‘é‘°ã€‚
  3. åŸ·è¡Œ `make test` ç¢ºä¿ä¸€åˆ‡æ­£å¸¸ã€‚

# =============================================================================
# Conversation Agent é–‹ç™¼ç’°å¢ƒè¨­å®š
# =============================================================================

.PHONY: help install dev debug test clean

# é è¨­ç›®æ¨™
.DEFAULT_GOAL := help

# å”åŠ©è³‡è¨Š
help:
	@echo "==============================================================================="
	@echo "| Conversation Agent é–‹ç™¼æŒ‡ä»¤                                                |"
	@echo "==============================================================================="
	@echo "| make install    - å®‰è£å°ˆæ¡ˆä¾è³´                                            |"
	@echo "| make dev        - å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨                                          |"
	@echo "| make debug      - å•Ÿå‹•åµéŒ¯æ¨¡å¼ï¼ˆæ”¯æ´ VS Code é™„åŠ åµéŒ¯ï¼‰                   |"
	@echo "| make test       - åŸ·è¡Œæ¸¬è©¦                                                |"
	@echo "| make clean      - æ¸…ç†æš«å­˜æª”æ¡ˆ                                            |"
	@echo "==============================================================================="

# å®‰è£ä¾è³´
install:
	@echo "ğŸ“¦ å®‰è£å°ˆæ¡ˆä¾è³´..."
	pip install google-adk
	@echo "âœ… ä¾è³´å®‰è£å®Œæˆ"

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
dev:
	@echo "ğŸš€ å•Ÿå‹• ADK é–‹ç™¼ä¼ºæœå™¨..."
	@echo "ğŸ“± é–‹å•Ÿ http://localhost:8000 ä¸¦é¸æ“‡ 'ConversationAgent'"
	@echo "æŒ‰ä¸‹ Ctrl+C åœæ­¢ä¼ºæœå™¨"
	@echo ""
	adk web backend

# å•Ÿå‹•åµéŒ¯æ¨¡å¼
debug:
	@echo "==============================================================================="
	@echo "| ğŸ› å•Ÿå‹•åµéŒ¯æ¨¡å¼                                                          |"
	@echo "==============================================================================="
	@echo "| ğŸ“ ä¼ºæœå™¨ä½å€ï¼šhttp://localhost:8000                                      |"
	@echo "| ğŸ” Debugger ç›£è½ï¼š5678                                                   |"
	@echo "| ğŸ”— VS Code é€£æ¥ï¼šæŒ‰ F5 é¸æ“‡ 'Debug ADK Web'                            |"
	@echo "| ğŸ”„ ç†±é‡è¼‰ï¼šå•Ÿç”¨                                                          |"
	@echo "| ğŸ’¡ æç¤ºï¼šåœ¨ VS Code ä¸­è¨­å®šä¸­æ–·é»å¾Œé–‹å§‹åµéŒ¯                              |"
	@echo "==============================================================================="
	python -m debugpy --listen 5678 --wait-for-client -m google.adk.cli web backend --port 8000

# åŸ·è¡Œæ¸¬è©¦
test:
	@echo "ğŸ§ª åŸ·è¡Œæ¸¬è©¦..."
	@echo "âš ï¸  æ³¨æ„ï¼šè«‹å…ˆå»ºç«‹æ¸¬è©¦æª”æ¡ˆ"
	# pytest tests/ -v --tb=short

# æ¸…ç†æš«å­˜æª”æ¡ˆ
clean:
	@echo "ğŸ§¹ æ¸…ç†æš«å­˜æª”æ¡ˆ..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	@echo "âœ… æ¸…ç†å®Œæˆ"

# é–‹ç™¼æ¨¡å¼çš„åˆ¥å
run: dev
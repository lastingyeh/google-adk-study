# -*- coding: utf-8 -*-
"""
ä¸¦è¡ŒåŸ·è¡Œç¤ºç¯„ä»£ç† - æ•™å­¸ 02ï¼šå‡½å¼å·¥å…·

é€™å€‹ä»£ç†å±•ç¤ºäº† ADK çš„è‡ªå‹•ä¸¦è¡Œå·¥å…·åŸ·è¡Œèƒ½åŠ›ã€‚
å®ƒä½¿ç”¨ç›¸åŒçš„è²¡å‹™è¨ˆç®—å·¥å…·ï¼Œä½†ç¶“éé…ç½®ä»¥å±•ç¤º
Gemini å¦‚ä½•åŒæ™‚åŸ·è¡Œå¤šå€‹å·¥å…·ä»¥ç²å¾—æ›´å¥½çš„æ•ˆèƒ½ã€‚

èˆ‡ä¸»ä»£ç†çš„ä¸»è¦å€åˆ¥ï¼š
- é‡å°ä¸¦è¡ŒåŸ·è¡Œæƒ…å¢ƒé€²è¡Œäº†æœ€ä½³åŒ–
- ä½¿ç”¨ Gemini 2.0-flash æ¨¡å‹ä»¥ç²å¾—æœ€ä½³ä¸¦è¡Œæ•ˆèƒ½
- åŒ…å«å¤šå·¥å…·æŸ¥è©¢çš„ç¯„ä¾‹
"""

# å¾ google.adk.agents åŒ¯å…¥ Agent é¡åˆ¥
from google.adk.agents import Agent

# å¾ä¸»ä»£ç†åŒ¯å…¥ç›¸åŒçš„å·¥å…·
from finance_assistant.agent import (
    calculate_compound_interest,  # è¨ˆç®—è¤‡åˆ©
    calculate_loan_payment,  # è¨ˆç®—è²¸æ¬¾æ”¯ä»˜é‡‘é¡
    calculate_monthly_savings,  # è¨ˆç®—æ¯æœˆå„²è“„é‡‘é¡
)


# å»ºç«‹ä¸¦è¡ŒåŸ·è¡Œç¤ºç¯„ä»£ç†
root_agent = Agent(
    name="parallel_finance_assistant",  # ä»£ç†åç¨±
    model="gemini-2.0-flash",  # æœ€é©åˆä¸¦è¡ŒåŸ·è¡Œçš„æ¨¡å‹
    description="""
    ä¸€å€‹é‡å°ä¸¦è¡ŒåŸ·è¡Œé€²è¡Œäº†æœ€ä½³åŒ–çš„é«˜æ•ˆèƒ½è²¡å‹™è¨ˆç®—åŠ©ç†ã€‚

    é€™å€‹ä»£ç†å¯ä»¥åŒæ™‚åŸ·è¡Œå¤šå€‹è²¡å‹™è¨ˆç®—ï¼Œä½¿å…¶éå¸¸é©åˆ
    æ¯”è¼ƒæŠ•è³‡é¸é …ã€åˆ†æå¤šå€‹è²¸æ¬¾æƒ…å¢ƒï¼Œ
    æˆ–è¨ˆç®—ä¸åŒæ™‚é–“ç¯„åœçš„å„²è“„ç›®æ¨™ã€‚

    ä¸»è¦åŠŸèƒ½ï¼š
    - ç”¨æ–¼æŠ•è³‡æ¯”è¼ƒçš„ä¸¦è¡Œè¤‡åˆ©è¨ˆç®—
    - é‡å°ä¸åŒæƒ…å¢ƒçš„åŒæ­¥è²¸æ¬¾æ”¯ä»˜åˆ†æ
    - é€éä¸¦è¡Œè¨ˆç®—é€²è¡Œå¤šç›®æ¨™å„²è“„è¦åŠƒ

    æ•ˆèƒ½ï¼šå°æ–¼å¤šå€‹ç¨ç«‹è¨ˆç®—ï¼Œé€Ÿåº¦æœ€é«˜å¯æå‡ 3 å€ï¼

    è§¸ç™¼ä¸¦è¡ŒåŸ·è¡Œçš„ç¯„ä¾‹æŸ¥è©¢ï¼š
    - "æ¯”è¼ƒé€™äº›æŠ•è³‡ï¼š$10k åˆ©ç‡ 5% å­˜ 10 å¹´ã€$15k åˆ©ç‡ 4% å­˜ 10 å¹´ã€$12k åˆ©ç‡ 6% å­˜ 10 å¹´"
    - "è¨ˆç®—ä»¥ä¸‹è²¸æ¬¾çš„é‚„æ¬¾é‡‘é¡ï¼š30 å¹´æœŸæŠµæŠ¼è²¸æ¬¾åˆ©ç‡ 4.5%ã€20 å¹´æœŸæŠµæŠ¼è²¸æ¬¾åˆ©ç‡ 4.0%ã€15 å¹´æœŸæŠµæŠ¼è²¸æ¬¾åˆ©ç‡ 3.5%"
    - "ç‚ºäº†åœ¨ 3 å¹´å…§å­˜åˆ° $50kã€5 å¹´å…§å­˜åˆ° $100kã€10 å¹´å…§å­˜åˆ° $200kï¼Œæˆ‘æ¯æœˆéœ€è¦å­˜å¤šå°‘éŒ¢ï¼Ÿ"
    """,
    tools=[
        calculate_compound_interest,
        calculate_loan_payment,
        calculate_monthly_savings,
    ],
)


def demo_parallel_execution():
    """
    é€éåŒæ™‚åŸ·è¡Œå¤šå€‹è¨ˆç®—ä¾†ç¤ºç¯„ä¸¦è¡ŒåŸ·è¡Œã€‚

    æ­¤å‡½å¼å±•ç¤ºäº†å¦‚ä½•ä¸¦è¡Œåœ°å¤šæ¬¡å‘¼å«ç›¸åŒçš„å·¥å…·ï¼Œ
    é€™æ­£æ˜¯ ADK åœ¨ Gemini è¦æ±‚å¤šå€‹å·¥å…·æ™‚è‡ªå‹•åŸ·è¡Œçš„æ“ä½œã€‚
    """
    import asyncio
    import time

    async def run_parallel_calculations():
        """ä»¥ä¸¦è¡Œæ–¹å¼åŸ·è¡Œå¤šå€‹è²¡å‹™è¨ˆç®—ã€‚"""
        print("ğŸš€ ä¸¦è¡ŒåŸ·è¡Œç¤ºç¯„")
        print("=" * 50)

        # é–‹å§‹è¨ˆæ™‚
        start_time = time.time()

        # ä¸¦è¡ŒåŸ·è¡Œä¸‰å€‹è¤‡åˆ©è¨ˆç®—
        tasks = [
            asyncio.to_thread(
                calculate_compound_interest, 10000, 0.05, 10
            ),  # $10k åˆ©ç‡ 5% å­˜ 10 å¹´
            asyncio.to_thread(
                calculate_compound_interest, 15000, 0.04, 10
            ),  # $15k åˆ©ç‡ 4% å­˜ 10 å¹´
            asyncio.to_thread(
                calculate_compound_interest, 12000, 0.06, 10
            ),  # $12k åˆ©ç‡ 6% å­˜ 10 å¹´
        ]

        # ç­‰å¾…æ‰€æœ‰è¨ˆç®—å®Œæˆ
        results = await asyncio.gather(*tasks)

        # è¨ˆç®—ç¶“éæ™‚é–“
        elapsed = time.time() - start_time

        print(f"âš¡ æ‰€æœ‰è¨ˆç®—åœ¨ {elapsed:.2f} ç§’å…§å®Œæˆï¼")
        print()

        # é¡¯ç¤ºçµæœ
        scenarios = [
            "$10,000 åˆ©ç‡ 5% å­˜ 10 å¹´",
            "$15,000 åˆ©ç‡ 4% å­˜ 10 å¹´",
            "$12,000 åˆ©ç‡ 6% å­˜ 10 å¹´",
        ]

        for i, (scenario, result) in enumerate(zip(scenarios, results), 1):
            print(f"é¸é … {i}: {scenario}")
            if result["status"] == "success":
                print(f"  æœ€çµ‚é‡‘é¡: ${result['final_amount']:,.0f}")
                print(f"  è³ºå–åˆ©æ¯: ${result['interest_earned']:,.0f}")
            else:
                print(f"éŒ¯èª¤: {result.get('error', 'æœªçŸ¥éŒ¯èª¤')}")
            print()

        print("ğŸ’¡ ä¸»è¦è§€å¯Ÿï¼š")
        print("- æ‰€æœ‰è¨ˆç®—åŒæ™‚å®Œæˆ")
        print("- çµæœä»¥ä¸¦è¡Œæ–¹å¼å›å‚³ï¼ˆéå¾ªåºï¼‰")
        print("- æ•ˆèƒ½éš¨è‘—ç¨ç«‹è¨ˆç®—çš„æ•¸é‡è€Œæ“´å±•")
        print("- ADK è‡ªå‹•è™•ç†äº†è¤‡é›œæ€§ï¼")

    # åŸ·è¡ŒéåŒæ­¥ç¤ºç¯„
    asyncio.run(run_parallel_calculations())


if __name__ == "__main__":
    print("ä¸¦è¡Œè²¡å‹™åŠ©ç†ç¤ºç¯„")
    print("=" * 50)
    print()
    print("æ­¤ä»£ç†å·²é‡å°ä¸¦è¡Œå·¥å…·åŸ·è¡Œé€²è¡Œäº†æœ€ä½³åŒ–ã€‚")
    print("å®ƒå¯ä»¥åŒæ™‚åŸ·è¡Œå¤šå€‹è²¡å‹™è¨ˆç®—ã€‚")
    print()
    print("è©¦è©¦é€™äº›ç¯„ä¾‹æŸ¥è©¢ï¼š")
    print()
    print("1. æŠ•è³‡æ¯”è¼ƒï¼š")
    print(
        '"æ¯”è¼ƒé€™ä¸‰å€‹æŠ•è³‡é¸é …ï¼š$10k åˆ©ç‡ 5% å­˜ 10 å¹´ã€$15k åˆ©ç‡ 4% å­˜ 10 å¹´ã€$12k åˆ©ç‡ 6% å­˜ 10 å¹´"'
    )
    print()
    print("2. è²¸æ¬¾åˆ†æï¼š")
    print(
        '"è¨ˆç®—æ¯æœˆé‚„æ¬¾é‡‘é¡ï¼š$300k åˆ©ç‡ 4.5% å­˜ 30 å¹´ã€$300k åˆ©ç‡ 4.0% å­˜ 20 å¹´ã€$300k åˆ©ç‡ 3.5% å­˜ 15 å¹´"'
    )
    print()
    print("3. å„²è“„ç›®æ¨™ï¼š")
    print(
        '"ç‚ºäº†åœ¨ 3 å¹´å…§é”åˆ° $50kã€5 å¹´å…§é”åˆ° $100kã€10 å¹´å…§é”åˆ° $200kï¼Œæˆ‘éœ€è¦æ¯æœˆå­˜å¤šå°‘éŒ¢ï¼Ÿ"'
    )
    print()
    print("é–‹å§‹ä¸¦è¡ŒåŸ·è¡Œç¤ºç¯„...")
    print()

    # åŸ·è¡Œä¸¦è¡Œç¤ºç¯„
    demo_parallel_execution()

    print()
    print("ç¤ºç¯„å®Œæˆï¼ ğŸ‰")
    print()
    print("è‹¥è¦ä½¿ç”¨æ­¤ä¸¦è¡Œä»£ç†å•Ÿå‹• ADK ä¼ºæœå™¨ï¼š")
    print("  make parallel-demo")
    print()
    print("è‹¥è¦å•Ÿå‹•ä¸€èˆ¬ä»£ç†ï¼š")
    print("  make dev")

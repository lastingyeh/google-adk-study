# æ•™å­¸ 27ï¼šç¬¬ä¸‰æ–¹å·¥å…·æ•´åˆ
# ç¤ºç¯„ LangChain å’Œ CrewAI å·¥å…·èˆ‡ ADK çš„æ•´åˆ

.PHONY: help setup dev test clean demo

# é è¨­ç›®æ¨™ - é¡¯ç¤ºèªªæ˜
help:
	@echo "ğŸš€ æ•™å­¸ 27ï¼šç¬¬ä¸‰æ–¹å·¥å…·æ•´åˆ"
	@echo ""
	@echo "å¿«é€Ÿé–‹å§‹æŒ‡ä»¤ï¼š"
	@echo "  make setup     - å®‰è£ç›¸ä¾å¥—ä»¶"
	@echo "  make dev       - å•Ÿå‹•ä»£ç†ç¨‹å¼"
	@echo "  make demo      - é¡¯ç¤ºç¯„ä¾‹æç¤ºå’Œç”¨æ³•"
	@echo ""
	@echo "é€²éšæŒ‡ä»¤ï¼š"
	@echo "  make test      - åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦"
	@echo "  make clean     - æ¸…ç†ç”¢ç”Ÿçš„æª”æ¡ˆ"
	@echo ""
	@echo "ğŸ’¡ ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ŸåŸ·è¡Œï¼šmake setup && make dev"

# è¨­å®šç’°å¢ƒ
setup:
	@echo "ğŸ“¦ æ­£åœ¨å®‰è£ç›¸ä¾å¥—ä»¶..."
	pip install -r requirements.txt
	pip install -e .
	@echo "âœ… è¨­å®šå®Œæˆï¼åŸ·è¡Œ 'make dev' å•Ÿå‹•ä»£ç†ç¨‹å¼ã€‚"

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
dev: check-env
	@echo "ğŸ¤– æ­£åœ¨å•Ÿå‹•ç¬¬ä¸‰æ–¹å·¥å…·ä»£ç†ç¨‹å¼..."
	@echo "ğŸ“± åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿ http://localhost:8000"
	@echo "ğŸ¯ å¾ä¸‹æ‹‰é¸å–®ä¸­é¸æ“‡ 'third_party_agent'"
	@echo ""
	@echo "ğŸ’¡ è©¦è©¦é€™äº›ç ”ç©¶æŸ¥è©¢ï¼š"
	@echo "   â€¢ 'What is quantum computing?' (Wikipedia)"
	@echo "   â€¢ 'Latest AI developments this year' (Web search)"
	@echo "   â€¢ 'Tell me about Ada Lovelace' (Wikipedia)"
	@echo "   â€¢ 'Current news about space exploration' (Web search)"
	@echo "   â€¢ 'Show me the project structure' (Directory read)"
	@echo "   â€¢ 'Read the README file' (File read)"
	@echo ""
	adk web

# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
test: check-env
	@echo "ğŸ§ª æ­£åœ¨åŸ·è¡Œæ¸¬è©¦..."
	pytest tests/ -v --tb=short

# é¡¯ç¤ºç¯„ä¾‹æç¤º
demo:
	@echo "ğŸ¯ ç¬¬ä¸‰æ–¹å·¥å…·æ•´åˆç¯„ä¾‹"
	@echo ""
	@echo "æœ¬æ•™å­¸ç¤ºç¯„ï¼š"
	@echo "  âœ… LangChain Wikipedia å·¥å…·æ•´åˆ"
	@echo "  âœ… LangChain DuckDuckGo ç¶²é æœå°‹å·¥å…·"
	@echo "  âœ… CrewAI DirectoryReadTool æ•´åˆ"
	@echo "  âœ… CrewAI FileReadTool æ•´åˆ"
	@echo "  âœ… æ­£ç¢ºçš„åŒ¯å…¥è·¯å¾‘ (google.adk.tools.langchain_tool)"
	@echo "  âœ… ä½¿ç”¨ LangchainTool å’Œè‡ªè¨‚å‡½å¼é€²è¡Œå·¥å…·åŒ…è£"
	@echo "  âœ… ä»»ä½•å·¥å…·éƒ½ä¸éœ€è¦ API é‡‘é‘°"
	@echo ""
	@echo "è©¦è©¦é€™äº›ç ”ç©¶æŸ¥è©¢ï¼š"
	@echo "1. 'What is quantum computing?' (Wikipedia)"
	@echo "2. 'Latest AI developments this year' (Web search)"
	@echo "3. 'Tell me about Ada Lovelace' (Wikipedia)"
	@echo "4. 'Current news about space exploration' (Web search)"
	@echo "5. 'Show me the project structure' (Directory read)"
	@echo "6. 'Read the README file' (File read)"
	@echo ""
	@echo "ğŸ’¡ åŸ·è¡Œï¼šmake dev"
	@echo "ğŸ”¬ åŸ·è¡Œï¼šmake test"

# æ¸…ç†å¿«å–æª”æ¡ˆ
clean:
	@echo "ğŸ§¹ æ­£åœ¨æ¸…ç†..."
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.pyo" -delete 2>/dev/null || true
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .pytest_cache -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name .coverage -exec rm -rf {} + 2>/dev/null || true
	@echo "âœ… æ¸…ç†å®Œæˆï¼"

# æª¢æŸ¥ç’°å¢ƒ (å…§éƒ¨ä½¿ç”¨)
check-env:
	@if [ -z "$$GOOGLE_API_KEY" ] && [ -z "$$GOOGLE_APPLICATION_CREDENTIALS" ]; then \
		echo "âŒ éŒ¯èª¤ï¼šæœªè¨­å®šé©—è­‰"; \
		echo ""; \
		echo "é¸æ“‡ä»¥ä¸‹å…¶ä¸­ä¸€ç¨®é©—è­‰æ–¹å¼ï¼š"; \
		echo ""; \
		echo "ğŸ”‘ æ–¹æ³• 1 - API é‡‘é‘° (Gemini API)ï¼š"; \
		echo "   export GOOGLE_API_KEY=your_api_key_here"; \
		echo "   å–å¾—å…è²»é‡‘é‘°ï¼šhttps://aistudio.google.com/app/apikey"; \
		echo ""; \
		echo "ğŸ” æ–¹æ³• 2 - æœå‹™å¸³æˆ¶ (VertexAI)ï¼š"; \
		echo "   export GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json"; \
		echo "   export GOOGLE_CLOUD_PROJECT=your_project_id"; \
		echo "   å»ºç«‹æ†‘è­‰ï¼šhttps://console.cloud.google.com/iam-admin/serviceaccounts"; \
		echo ""; \
		exit 1; \
	fi

# é‡é»æ‘˜è¦ (ç¨‹å¼ç¢¼é™¤å¤–)
# - **æ ¸å¿ƒæ¦‚å¿µ**ï¼šè‡ªå‹•åŒ–å°ˆæ¡ˆç®¡ç†å·¥å…·ï¼Œç°¡åŒ–é–‹ç™¼æµç¨‹ã€‚
# - **é—œéµæŠ€è¡“**ï¼šMake, Shell Scripting, pip, adk CLI, pytestã€‚
# - **é‡è¦çµè«–**ï¼šæä¾›æ¨™æº–åŒ–çš„æŒ‡ä»¤ä»‹é¢ (`make setup`, `make dev`, `make test`)ï¼Œé™ä½é–‹ç™¼é–€æª»ä¸¦ç¢ºä¿ç’°å¢ƒä¸€è‡´æ€§ã€‚
# - **è¡Œå‹•é …ç›®**ï¼šåŸ·è¡Œ `make setup` åˆå§‹åŒ–å°ˆæ¡ˆï¼Œä½¿ç”¨ `make dev` å•Ÿå‹•ä»£ç†ç¨‹å¼ã€‚

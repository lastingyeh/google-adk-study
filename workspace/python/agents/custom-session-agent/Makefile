.PHONY: setup clean test dev help docker-up docker-down

help:
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  è‡ªå®šç¾©æœƒè©±æœå‹™ (Custom Session Services) - Redis å­˜å„²æ¼”ç¤º    â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ğŸ¯ å¿«é€Ÿé–‹å§‹ (QUICK START):"
	@echo "   make setup          å®‰è£ä¾è³´ (Install dependencies)"
	@echo "   make dev            å•Ÿå‹•å¸¶æœ‰ Redis æœƒè©±çš„ ADK ç¶²é ä»‹é¢"
	@echo "   make test           åŸ·è¡Œå–®å…ƒæ¸¬è©¦ (Run unit tests)"
	@echo ""
	@echo "ğŸ³ DOCKER:"
	@echo "   make docker-up      å•Ÿå‹• Redis å®¹å™¨ (é€£æ¥åŸ  6379)"
	@echo "   make docker-down    åœæ­¢å®¹å™¨ (Stop containers)"
	@echo ""
	@echo "ğŸ§¹ æ¸…ç† (CLEANUP):"
	@echo "   make clean          ç§»é™¤å¿«å–æª”æ¡ˆ (Remove cache files)"
	@echo ""
	@echo "ğŸ“– å®Œæ•´æŒ‡å— (FULL GUIDE):"
	@echo "   1. make setup"
	@echo "   2. make docker-up"
	@echo "   3. make dev"
	@echo "   4. é–‹å•Ÿ http://127.0.0.1:8000"
	@echo "   5. é¸æ“‡: custom_session_agent"
	@echo ""
	@echo "âœ¨ è©¦è‘—ç™¼é€: 'Write me a poem'"
	@echo "   ç„¶å¾Œé‡æ–°æ•´ç†ç€è¦½å™¨ä¾†æ¸¬è©¦æŒä¹…åŒ–æ€§ (Persistence)ï¼"
	@echo ""

setup:
	@echo "ğŸ“¦ æ­£åœ¨å®‰è£ä¾è³´..."
	pip install -r requirements.txt
	pip install -e .
	@echo "âœ… å®Œæˆï¼"

docker-up:
	@echo "ğŸ³ æ­£åœ¨å•Ÿå‹• Redis..."
	docker-compose up -d redis
	@echo "â³ ç­‰å¾… Redis å°±ç·’..."
	sleep 2
	redis-cli ping 2>/dev/null || sleep 2
	@echo "âœ… Redis å·²å°±ç·’ï¼Œç¶²å€ï¼šredis://localhost:6379"

docker-down:
	@echo "ğŸ›‘ æ­£åœ¨åœæ­¢ Redis..."
	docker-compose down
	@echo "âœ… å·²åœæ­¢"

dev: docker-up
	@echo ""
	@echo "ğŸš€ æ­£åœ¨å•Ÿå‹• ADK ç¶²é ä»‹é¢..."
	@echo "   Agent: custom_session_agent"
	@echo "   å¾Œç«¯ (Backend): Redis (redis://localhost:6379)"
	@echo "   URL: http://127.0.0.1:8000"
	@echo ""
	python -m custom_session_agent web --session_service_uri=redis://localhost:6379

test:
	@echo "ğŸ§ª æ­£åœ¨åŸ·è¡Œæ¸¬è©¦..."
	pytest tests/ -v --tb=short
	@echo "âœ… æ¸¬è©¦å®Œæˆï¼"

clean:
	@echo "ğŸ§¹ æ­£åœ¨æ¸…ç†..."
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	find . -type d -name ".pytest_cache" -delete
	find . -type d -name "*.egg-info" -delete
	@echo "âœ… æ¸…ç†å®Œç•¢ï¼"

### é‡é»æ‘˜è¦
- **æ ¸å¿ƒæ¦‚å¿µ**ï¼šè‡ªå‹•åŒ–å·¥ä½œæµæŒ‡ä»¤ã€‚
- **é—œéµæŠ€è¡“**ï¼šGNU Make, Docker Compose, Python pip, Redisã€‚
- **é‡è¦çµè«–**ï¼šMakefile ç°¡åŒ–äº†é–‹ç™¼ç’°å¢ƒçš„å»ºç½®ã€æœå‹™å•Ÿå‹•èˆ‡æ¸…ç†æµç¨‹ã€‚
- **è¡Œå‹•é …ç›®**ï¼šé–‹ç™¼è€…æ‡‰ä½¿ç”¨ `make help` æª¢è¦–æ‰€æœ‰å¯ç”¨æŒ‡ä»¤ï¼Œä¸¦æŒ‰æŒ‡å—é †åºæ“ä½œã€‚

<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google ADK 代理市集</title>
    <!-- 引入 Tailwind CSS -->
    <link href="../tailwind.v2.2.19.min.css" rel="stylesheet" />
    <!-- 引入 Inter 字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Google ADK Tech Theme Variables */
      :root {
        --bg-primary: #0b0f19;
        --bg-secondary: #131620;
        --bg-card: rgba(22, 27, 34, 0.7);
        --bg-card-hover: rgba(30, 36, 46, 0.8);
        --text-primary: #e8eaed;
        --text-secondary: #9aa0a6;
        --accent-blue: #4285f4;
        --accent-purple: #a142f4;
        --google-red: #ea4335;
        --google-yellow: #fbbc04;
        --google-green: #34a853;
        --google-blue: #4285f4;
        --border-color: rgba(255, 255, 255, 0.1);
        --glass-border: 1px solid rgba(255, 255, 255, 0.08);
      }

      /* Base Styles */
      body {
        font-family: 'Inter', 'Noto Sans TC', sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        background-image: radial-gradient(
            circle at 15% 50%,
            rgba(66, 133, 244, 0.08) 0%,
            transparent 25%
          ),
          radial-gradient(
            circle at 85% 30%,
            rgba(161, 66, 244, 0.08) 0%,
            transparent 25%
          );
        min-height: 100vh;
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      ::-webkit-scrollbar-track {
        background: var(--bg-primary);
      }
      ::-webkit-scrollbar-thumb {
        background: #3c4043;
        border-radius: 5px;
        border: 2px solid var(--bg-primary);
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #5f6368;
      }

      /* Modal */
      .modal {
        display: none;
        transition: opacity 0.2s ease-in-out;
        backdrop-filter: blur(8px);
      }
      .modal.flex {
        display: flex;
        animation: fadeIn 0.2s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Enhanced Card Styling */
      .agent-card {
        background: var(--bg-card) !important;
        border: var(--glass-border);
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 24px -1px rgba(0, 0, 0, 0.2);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      /* Top gradient line for cards */
      .agent-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(
          90deg,
          var(--google-blue),
          var(--accent-purple)
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .agent-card:hover {
        transform: translateY(-4px);
        background: var(--bg-card-hover) !important;
        box-shadow: 0 12px 32px -4px rgba(0, 0, 0, 0.3);
        border-color: rgba(66, 133, 244, 0.3);
      }

      .agent-card:hover::before {
        opacity: 1;
      }

      /* Tags */
      .tag {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-weight: 500;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .tag-type {
        background-color: rgba(66, 133, 244, 0.1);
        color: #8ab4f8;
        border-color: rgba(66, 133, 244, 0.2);
      }

      .tag-model {
        background-color: rgba(161, 66, 244, 0.1);
        color: #d7aefb;
        border-color: rgba(161, 66, 244, 0.2);
      }

      /* 卡片視圖數字圖示 */
      .card-view-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(66, 133, 244, 0.15) 0%,
          rgba(161, 66, 244, 0.15) 100%
        );
        border: 1px solid rgba(66, 133, 244, 0.3);
        color: #8ab4f8;
        font-size: 0.75rem;
        font-weight: 600;
        flex-shrink: 0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .agent-card:hover .card-view-number {
        background: linear-gradient(
          135deg,
          rgba(66, 133, 244, 0.25) 0%,
          rgba(161, 66, 244, 0.25) 100%
        );
        border-color: rgba(66, 133, 244, 0.5);
        transform: scale(1.1);
      }

      /* List View Override */
      .dashboard-grid.list-view {
        grid-template-columns: 1fr !important;
        gap: 0.5rem;
      }

      /* 在卡片視圖中隱藏列表元素 */
      .dashboard-grid:not(.list-view) .list-view-number,
      .dashboard-grid:not(.list-view) .list-view-arrow {
        display: none;
      }

      /* 在列表視圖中隱藏卡片元素 */
      .dashboard-grid.list-view .card-view-number {
        display: none;
      }

      .dashboard-grid.list-view .agent-card {
        flex-direction: row;
        align-items: center;
        padding: 0.75rem 1.5rem;
        background: rgba(19, 22, 32, 0.8) !important;
        min-height: auto;
      }

      .dashboard-grid.list-view .agent-card:hover {
        transform: translateX(4px);
      }

      .dashboard-grid.list-view .agent-content {
        display: flex;
        flex-direction: row;
        align-items: center;
        flex: 1;
        width: 100%;
        padding: 0;
      }

      /* 列表視圖左側數字圖示 */
      .dashboard-grid.list-view .list-view-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(66, 133, 244, 0.15) 0%,
          rgba(161, 66, 244, 0.15) 100%
        );
        border: 1px solid rgba(66, 133, 244, 0.3);
        color: #8ab4f8;
        font-size: 0.875rem;
        font-weight: 600;
        flex-shrink: 0;
        margin-right: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .dashboard-grid.list-view .agent-card:hover .list-view-number {
        background: linear-gradient(
          135deg,
          rgba(66, 133, 244, 0.25) 0%,
          rgba(161, 66, 244, 0.25) 100%
        );
        border-color: rgba(66, 133, 244, 0.5);
        transform: scale(1.05);
      }

      .dashboard-grid.list-view .agent-header {
        margin-bottom: 0 !important;
        margin-right: 1.5rem;
        min-width: 180px;
        flex-shrink: 0;
      }

      .dashboard-grid.list-view .agent-title {
        font-size: 0.95rem;
        margin-bottom: 0;
      }

      .dashboard-grid.list-view .agent-description {
        display: block;
        flex: 1;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 0.875rem;
      }

      .dashboard-grid.list-view .agent-meta {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-shrink: 0;
        margin-left: auto;
        margin-right: 1rem;
        order: 2;
      }

      .dashboard-grid.list-view .agent-labels {
        display: flex;
        flex-direction: row;
        gap: 0.5rem;
        margin: 0;
        margin-right: 1rem;
        flex-shrink: 0;
        order: 1;
      }

      /* 在列表模式下隱藏 type 標籤和 labels 區的 model 標籤 */
      .dashboard-grid.list-view .agent-labels .tag-type,
      .dashboard-grid.list-view .agent-labels .tag-model {
        display: none;
      }

      /* 列表視圖右側箭頭圖示 */
      .dashboard-grid.list-view .list-view-arrow {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(66, 133, 244, 0.1);
        color: #8ab4f8;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        flex-shrink: 0;
        order: 3;
        margin-left: 1rem;
      }

      .dashboard-grid.list-view .agent-card:hover .list-view-arrow {
        background: rgba(66, 133, 244, 0.2);
        transform: translateX(4px);
      }

      .dashboard-grid.list-view .agent-footer {
        display: none;
      }

      /* Utilities */
      .text-gradient-gemini {
        background: linear-gradient(to right, #4285f4, #9b72cb, #d96570);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Fix Search Input Visibility */
      #search-input {
        color: #ffffff !important;
        background-color: #131620 !important;
      }
      #search-input::placeholder {
        color: #9ca3af !important; /* gray-400 */
      }

      /* Collapse Component Styles */
      .collapse-header {
        cursor: pointer;
        user-select: none;
        transition: all 0.2s ease;
      }

      .collapse-header:hover {
        opacity: 0.8;
      }

      .collapse-icon {
        transition: transform 0.3s ease;
        display: inline-block;
      }

      .collapse-header.collapsed .collapse-icon {
        transform: rotate(-90deg);
      }

      .collapse-content {
        max-height: 40vh;
        overflow-y: auto;
        transition: max-height 0.3s ease, opacity 0.3s ease,
          margin-top 0.3s ease;
        opacity: 1;
        margin-top: 0.5rem;
      }

      .collapse-content.collapsed {
        max-height: 0;
        opacity: 0;
        margin-top: 0;
        overflow: hidden;
      }

      /* Mobile Responsive Adjustments */
      @media (max-width: 768px) {
        /* Container Padding */
        .container {
          padding-left: 1rem;
          padding-right: 1rem;
        }

        /* Header Adjustments */
        h1.text-4xl {
          font-size: 2rem;
        }

        /* List View Mobile Layout */
        .dashboard-grid.list-view .agent-card {
          flex-direction: column !important;
          align-items: flex-start !important;
          padding: 1rem !important;
          gap: 0.75rem;
        }

        .dashboard-grid.list-view .agent-content {
          flex-direction: column !important;
          align-items: flex-start !important;
          gap: 0.5rem;
          padding: 0 !important; /* Reset padding override from list view */
        }

        /* Hide number in mobile list view to save space */
        .dashboard-grid.list-view .list-view-number {
          display: none !important;
        }

        .dashboard-grid.list-view .agent-header {
          margin-right: 0 !important;
          margin-bottom: 0 !important;
          width: 100%;
        }

        .dashboard-grid.list-view .agent-labels {
          margin-right: 0 !important;
          order: 2;
          width: 100%;
          display: flex;
          flex-wrap: wrap;
          gap: 0.5rem;
        }

        /* Show type/model tags in list view on mobile since we have space in column layout */
        .dashboard-grid.list-view .agent-labels .tag-type,
        .dashboard-grid.list-view .agent-labels .tag-model {
          display: inline-block !important;
        }

        .dashboard-grid.list-view .agent-description {
          white-space: normal !important;
          display: -webkit-box;
          -webkit-line-clamp: 3;
          line-clamp: 3;
          -webkit-box-orient: vertical;
          margin: 0 !important;
          order: 3;
          width: 100%;
        }

        .dashboard-grid.list-view .agent-meta {
          margin-left: 0 !important;
          margin-right: 0 !important;
          width: 100%;
          order: 4;
          justify-content: flex-start;
          border-top: 1px solid rgba(255, 255, 255, 0.05);
          padding-top: 0.75rem;
          margin-top: 0.25rem;
        }

        .dashboard-grid.list-view .list-view-arrow {
          display: none !important;
        }

        /* Modal Adjustments */
        #detail-modal .p-6 {
          padding: 1.25rem !important;
        }

        #modal-title {
          font-size: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- 主容器 -->
    <div class="container mx-auto p-4 md:p-8">
      <!-- 標題 -->
      <header class="text-center mb-10 md:mb-16 relative">
        <!-- Glow Effect -->
        <div
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl pointer-events-none"
        ></div>

        <div
          class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-500/10 border border-purple-500/20 text-purple-400 text-xs font-medium mb-4"
        >
          <span class="relative flex h-2 w-2">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-purple-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-2 w-2 bg-purple-500"
            ></span>
          </span>
          Agents Marketplace
        </div>

        <h1
          class="text-4xl md:text-6xl font-bold text-white mb-4 tracking-tight"
        >
          <span class="text-gradient-gemini">Google ADK</span>
          <br class="md:hidden" />
          <span class="text-gray-100">Agent Marketplace</span>
        </h1>
        <p class="text-lg text-gray-400 mt-4 max-w-2xl mx-auto leading-relaxed">
          探索專案實現與整合社群打造的 Google ADK 代理市集<br />
          <span class="text-sm text-gray-500"
            >一站式管理、部署與整合您的 AI 助手</span
          >
        </p>

        <div class="mt-8 flex justify-center gap-4">
          <a
            href="../index.html"
            class="px-5 py-2 rounded-full border border-gray-600 bg-gray-800/70 text-sm font-medium text-gray-300 hover:text-white hover:border-blue-500 transition-all"
          >
            ← 返回學習儀表板
          </a>
        </div>
      </header>

      <!-- 搜尋與控制項 -->
      <div class="mb-8 flex flex-col sm:flex-row items-center gap-4">
        <!-- Google 風格搜尋框 -->
        <div class="relative w-full sm:flex-grow">
          <div
            class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none"
          >
            <svg
              class="w-4 h-4 text-gray-400"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 20 20"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
              />
            </svg>
          </div>
          <input
            type="text"
            id="search-input"
            placeholder="搜尋代理名稱、功能或工具..."
            class="block w-full p-3 pl-12 text-sm text-white border border-gray-700 rounded-lg bg-[#131620] focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500 placeholder-gray-500 transition-all shadow-lg"
          />
          <button
            id="reset-button"
            class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-white"
          >
            <svg
              class="w-4 h-4"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
            <span class="sr-only">清除搜尋</span>
          </button>
        </div>

        <!-- 視圖切換按鈕 -->
        <div
          class="flex items-center gap-1 bg-[#131620] rounded-lg p-1 border border-gray-700/50"
        >
          <button
            id="card-view-btn"
            class="p-2 rounded-md text-purple-400 bg-purple-500/10 hover:bg-purple-500/20 transition-all duration-200"
            aria-label="卡片模式"
            title="卡片模式"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
              ></path>
            </svg>
          </button>
          <button
            id="list-view-btn"
            class="p-2 rounded-md text-gray-500 hover:text-gray-300 hover:bg-gray-800/50 transition-all duration-200"
            aria-label="列表模式"
            title="列表模式"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- 統計資訊 -->
      <div class="mb-6 flex gap-4 text-sm text-gray-400 px-2">
        <span
          >總計：<strong id="total-count" class="text-white">0</strong>
          個代理</span
        >
      </div>

      <!-- 代理卡片容器 -->
      <div
        id="agents-grid"
        class="dashboard-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
      >
        <!-- JavaScript 將在此處動態插入卡片 -->
      </div>
    </div>

    <!-- 彈出式 Modal (預設隱藏) -->
    <div
      id="detail-modal"
      class="modal fixed inset-0 z-50 items-center justify-center overflow-hidden bg-black/80 p-4 backdrop-blur-sm"
    >
      <div
        class="relative w-full max-w-3xl mx-auto bg-[#131620] rounded-2xl shadow-2xl border border-gray-700/50 transform transition-all flex flex-col max-h-[90vh]"
      >
        <!-- Modal 頂部 -->
        <div
          class="flex items-center justify-between p-6 border-b border-gray-800/50 bg-[#1a1f2e] flex-shrink-0"
        >
          <div class="flex flex-col">
            <h2
              id="modal-title"
              class="text-2xl font-bold text-white tracking-tight"
            >
              <!-- Modal 標題將動態填入 -->
            </h2>
            <span
              id="modal-path"
              class="text-xs text-gray-500 font-mono mt-1 break-all"
            ></span>
          </div>

          <!-- 關閉按鈕 -->
          <button
            onclick="closeModal()"
            class="text-gray-400 bg-transparent hover:bg-gray-700 hover:text-white rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center ml-4 flex-shrink-0"
          >
            <svg
              class="w-3 h-3"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 14"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
              />
            </svg>
            <span class="sr-only">關閉視窗</span>
          </button>
        </div>

        <!-- Modal 內容 (可滾動) -->
        <div id="modal-body" class="p-6 overflow-y-auto flex-1">
          <div class="space-y-8">
            <!-- 標籤區 -->
            <div class="flex flex-wrap gap-2" id="modal-tags">
              <!-- 動態標籤 -->
            </div>

            <!-- 詳細說明 -->
            <div>
              <h3
                class="text-lg font-semibold text-blue-400 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                功能描述
              </h3>
              <p
                id="modal-description"
                class="text-base leading-relaxed text-gray-300 bg-gray-800/30 p-4 rounded-lg border border-gray-700/30"
              >
                <!-- Modal 詳細說明將動態填入 -->
              </p>
            </div>

            <!-- 工具列表 -->
            <div id="modal-tools-container" style="display: none">
              <h3
                class="collapse-header collapsed text-lg font-semibold text-green-400 mb-2 flex items-center gap-2 justify-between"
                onclick="toggleCollapse('tools')"
              >
                <div class="flex items-center gap-2">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    ></path>
                  </svg>
                  可用工具 (Tools)
                </div>
                <svg
                  class="collapse-icon w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  ></path>
                </svg>
              </h3>
              <div
                class="collapse-content collapsed grid grid-cols-1 sm:grid-cols-2 gap-3"
                id="modal-tools-list"
              >
                <!-- 工具將動態填入 -->
              </div>
            </div>

            <!-- 子代理列表 -->
            <div id="modal-subagents-container" style="display: none">
              <h3
                class="collapse-header collapsed text-lg font-semibold text-purple-400 mb-2 flex items-center gap-2 justify-between"
                onclick="toggleCollapse('subagents')"
              >
                <div class="flex items-center gap-2">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                    ></path>
                  </svg>
                  子代理 (Sub-agents)
                </div>
                <svg
                  class="collapse-icon w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  ></path>
                </svg>
              </h3>
              <div
                class="collapse-content collapsed space-y-2"
                id="modal-subagents-list"
              >
                <!-- 子代理將動態填入 -->
              </div>
            </div>

            <!-- 其他資訊 (Plugins, Capabilities) -->
            <div id="modal-extras-container" style="display: none">
              <h3
                class="text-lg font-semibold text-yellow-400 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 10V3L4 14h7v7l9-11h-7z"
                  ></path>
                </svg>
                其他功能
              </h3>
              <ul
                id="modal-extras-list"
                class="list-disc list-inside space-y-1 text-gray-300"
              ></ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript 邏輯 -->
    <script>
      // 代理資料
      const agentsData = [
        {
          name: 'hello_assistant',
          path: 'workspace/python/agents/hello-agent',
          type: 'Agent',
          description: '一個用於一般對話的友善 AI 助理',
          model: 'gemini-2.0-flash',
          tools: [],
        },
        {
          name: 'finance_assistant',
          path: 'workspace/python/agents/finance-assistant',
          type: 'Agent',
          description: '一個財務計算助理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'calculate_compound_interest',
              description: '計算儲蓄或投資的複利',
            },
            {
              name: 'calculate_loan_payment',
              description: '計算每月貸款還款金額',
            },
            {
              name: 'calculate_monthly_savings',
              description: '計算為達成目標所需的每月儲蓄金額',
            },
          ],
        },
        {
          name: 'BlogCreationPipeline',
          path: 'workspace/python/agents/blog-pipeline',
          type: 'SequentialAgent',
          description: '從研究到發布的完整部落格文章創建流程',
          sub_agents: [
            {
              name: 'researcher',
              description: '研究主題並收集關鍵事實',
            },
            {
              name: 'writer',
              description: '根據研究撰寫部落格文章草稿',
            },
            {
              name: 'editor',
              description: '審查部落格文章草稿並提供回饋',
            },
            {
              name: 'formatter',
              description: '應用編輯回饋並格式化最終文章',
            },
          ],
        },
        {
          name: 'chuck_norris_agent',
          path: 'workspace/python/agents/chuck-norris-agent',
          type: 'Agent',
          description: '使用 OpenAPI 工具的 Chuck Norris 笑話助理',
          model: 'gemini-2.0-flash',
          toolsets: [
            {
              name: 'chuck_norris_toolset',
              type: 'OpenAPIToolset',
            },
          ],
        },
        {
          name: 'FinancialCalculator',
          path: 'workspace/python/agents/code-calculator',
          type: 'Agent',
          description: '具備 Python 程式碼執行能力的專業財務計算機',
          model: 'gemini-2.0-flash',
          capabilities: ['BuiltInCodeExecutor'],
        },
        {
          name: 'content_moderator',
          path: 'workspace/python/agents/content-moderator',
          type: 'Agent',
          description: '具備安全護欄的內容審核助理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'generate_text',
              description: '根據主題和字數生成文本',
            },
            {
              name: 'check_grammar',
              description: '檢查所提供文本的語法',
            },
            {
              name: 'get_usage_stats',
              description: '返回工具上下文的使用統計數據',
            },
          ],
          callbacks: [
            'before_agent_callback',
            'after_agent_callback',
            'before_model_callback',
            'after_model_callback',
            'before_tool_callback',
            'after_tool_callback',
          ],
        },
        {
          name: 'ContentPublishingSystem',
          path: 'workspace/python/agents/content-publisher',
          type: 'SequentialAgent',
          description: '具有平行研究和順序創建功能的完整內容發布系統',
          sub_agents: [
            {
              name: 'ParallelResearch',
              type: 'ParallelAgent',
              sub_agents: [
                {
                  name: 'NewsPipeline',
                  type: 'SequentialAgent',
                  sub_agents: ['news_fetcher', 'news_summarizer'],
                },
                {
                  name: 'SocialPipeline',
                  type: 'SequentialAgent',
                  sub_agents: ['social_monitor', 'sentiment_analyzer'],
                },
                {
                  name: 'ExpertPipeline',
                  type: 'SequentialAgent',
                  sub_agents: ['expert_finder', 'quote_extractor'],
                },
              ],
            },
            {
              name: 'article_writer',
            },
            {
              name: 'article_editor',
            },
            {
              name: 'article_formatter',
            },
          ],
        },
        {
          name: 'customer_support',
          path: 'workspace/python/agents/customer-support',
          type: 'Agent',
          description: '具備多種工具的客戶支援代理 (從 YAML 載入)',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'check_customer_status',
              description: '檢查客戶的當前狀態',
            },
            {
              name: 'log_interaction',
              description: '記錄與客戶的新互動',
            },
            {
              name: 'get_order_status',
              description: '檢索特定訂單的狀態',
            },
            {
              name: 'track_shipment',
              description: '追蹤訂單的貨運狀態',
            },
            {
              name: 'cancel_order',
              description: '取消現有訂單',
            },
            {
              name: 'search_knowledge_base',
              description: '在知識庫中搜尋答案',
            },
            {
              name: 'run_diagnostic',
              description: '運行診斷測試以進行故障排除',
            },
            {
              name: 'create_ticket',
              description: '創建新的支援工單',
            },
            {
              name: 'get_billing_history',
              description: '檢索客戶的帳單歷史記錄',
            },
            {
              name: 'process_refund',
              description: '處理訂單的退款',
            },
            {
              name: 'update_payment_method',
              description: '更新客戶的付款方式',
            },
          ],
        },
        {
          name: 'customer_support_agent',
          path: 'workspace/python/agents/customer-support-agent',
          type: 'Agent',
          description:
            '整合 AG-UI 的客戶支援 ADK 代理人，提供客戶支援功能，具備知識庫搜尋、訂單狀態查詢和支援工單建立的工具。',
          model: 'gemini-2.0-flash-exp',
          tools: [
            {
              name: 'search_knowledge_base',
              description: '搜尋知識庫以尋找相關資訊',
            },
            {
              name: 'lookup_order_status',
              description: '查詢客戶訂單的狀態',
            },
            {
              name: 'create_support_ticket',
              description: '為複雜問題建立支援工單',
            },
            {
              name: 'get_product_details',
              description: '從資料庫獲取產品詳情',
            },
          ],
        },
        {
          name: 'lead_qualifier',
          path: 'workspace/python/agents/enterprise-agent',
          type: 'Agent',
          description: '企業銷售潛在客戶資格鑑定代理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'check_company_size',
              description: '檢查公司規模',
            },
            {
              name: 'score_lead',
              description: '根據標準對銷售潛在客戶進行評分',
            },
            {
              name: 'get_competitive_intel',
              description: '收集競爭情報',
            },
          ],
        },
        {
          name: 'EssayRefinementSystem',
          path: 'workspace/python/agents/essay-refiner',
          type: 'SequentialAgent',
          description: '完整的論文寫作與精煉系統',
          sub_agents: [
            {
              name: 'InitialWriter',
            },
            {
              name: 'RefinementLoop',
              type: 'LoopAgent',
              sub_agents: [
                {
                  name: 'Critic',
                },
                {
                  name: 'Refiner',
                  tools: ['exit_loop'],
                },
              ],
            },
          ],
        },
        {
          name: 'advanced_grounding_agent',
          path: 'workspace/python/agents/grounding-agent',
          type: 'Agent',
          description: '具有搜尋、分析和條件地圖工具的高級 grounding 代理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'google_search',
              description: '執行 Google 搜尋',
            },
            {
              name: 'google_maps_grounding (Conditional)',
              description: '使用 Google 地圖數據提供 grounding',
            },
            {
              name: 'analyze_search_results',
              description: '分析搜尋結果',
            },
            {
              name: 'save_research_findings',
              description: '保存研究發現',
            },
          ],
        },
        {
          name: 'mcp_file_assistant',
          path: 'workspace/python/agents/mcp-agent',
          type: 'Agent',
          description: '透過 MCP 存取檔案系統的 AI 助理',
          model: 'gemini-2.0-flash-exp',
          tools: [
            {
              name: 'McpToolset (filesystem)',
              description: '透過 MCP 提供對檔案系統操作的存取',
            },
          ],
        },
        {
          name: 'model_selector_agent',
          path: 'workspace/python/agents/model-selector',
          type: 'Agent',
          description: '用於選擇和比較 AI 模型的專家代理',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: 'recommend_model_for_use_case',
              description: '為特定使用案例推薦 AI 模型',
            },
            {
              name: 'get_model_info',
              description: '檢索特定 AI 模型的資訊',
            },
          ],
        },
        {
          name: 'multi_llm_agent',
          path: 'workspace/python/agents/multi-llm-agent',
          type: 'Agent',
          description: '透過 LiteLLM 支援 OpenAI、Claude 等的多 LLM 代理',
          model: 'openai/gpt-4o-mini',
          tools: [
            {
              name: 'calculate_square',
              description: '計算一個數字的平方',
            },
            {
              name: 'get_weather',
              description: '獲取特定城市的天氣',
            },
            {
              name: 'analyze_sentiment',
              description: '分析文本的情感',
            },
          ],
        },
        {
          name: 'customer_service',
          path: 'workspace/python/agents/observability-agent',
          type: 'Agent',
          description: '具有事件追蹤功能的客戶服務代理',
          model: 'gemini-2.0-flash-exp',
          tools: [
            {
              name: 'check_order_status',
              description: '檢查特定訂單的狀態',
            },
            {
              name: 'process_refund',
              description: '處理訂單的退款',
            },
            {
              name: 'check_inventory',
              description: '檢查產品的庫存可用性',
            },
          ],
        },
        {
          name: 'observability_plugins_agent',
          path: 'workspace/python/agents/observability-plugins-agent',
          type: 'Agent',
          description: '具有全面可觀測性外掛的生產助理',
          model: 'gemini-2.5-flash',
          plugins: [
            'MetricsCollectorPlugin',
            'AlertingPlugin',
            'PerformanceProfilerPlugin',
          ],
        },
        {
          name: 'personal_tutor',
          path: 'workspace/python/agents/personal-tutor',
          type: 'Agent',
          description: '追蹤用戶進度和偏好的個人家教',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'set_user_preferences',
              description: '設定用戶的學習偏好',
            },
            {
              name: 'record_topic_completion',
              description: '記錄學習主題的完成情況',
            },
            {
              name: 'get_user_progress',
              description: '檢索用戶的當前進度',
            },
            {
              name: 'start_learning_session',
              description: '開始新的學習會話',
            },
            {
              name: 'calculate_quiz_grade',
              description: '計算測驗的成績',
            },
            {
              name: 'search_past_lessons',
              description: '搜尋過去的課程',
            },
          ],
        },
        {
          name: 'production_deployment_agent',
          path: 'workspace/python/agents/production-agent',
          type: 'Agent',
          description: '關於生產部署策略的專家',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'check_deployment_status',
              description: '檢查部署狀態',
            },
            {
              name: 'get_deployment_options',
              description: '獲取可用的部署選項',
            },
            {
              name: 'get_best_practices',
              description: '檢索部署最佳實踐',
            },
          ],
        },
        {
          name: 'software_bug_assistant',
          path: 'workspace/python/agents/software-bug-assistant',
          type: 'Agent',
          description: '軟體錯誤助理',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: 'get_current_date',
              description: '獲取當前日期',
            },
            {
              name: 'search_tool (AgentTool)',
              description: '代理的搜尋工具包裝器',
            },
            {
              name: 'langchain_tool (StackExchange)',
              description: '透過 LangChain 的 StackExchange 搜尋工具',
            },
            {
              name: 'toolbox_tools (Google Cloud Toolbox)',
              description: 'Google Cloud Toolbox 工具集',
            },
            {
              name: 'mcp_tools (GitHub MCP)',
              description: '用於程式碼互動的 GitHub MCP 工具',
            },
          ],
        },
        {
          name: 'plan_react_strategic_solver',
          path: 'workspace/python/agents/strategic-solver',
          type: 'Agent',
          description: '使用 PlanReActPlanner 的策略性業務顧問',
          model: 'gemini-2.0-flash',
          planner: 'PlanReActPlanner',
          tools: [
            {
              name: 'analyze_market',
              description: '分析市場趨勢和數據',
            },
            {
              name: 'calculate_roi',
              description: '計算投資回報率 (ROI)',
            },
            {
              name: 'assess_risk',
              description: '評估潛在的業務風險',
            },
            {
              name: 'save_strategy_report',
              description: '保存生成的策略報告',
            },
          ],
        },
        {
          name: 'streaming_assistant',
          path: 'workspace/python/agents/streaming-agent',
          type: 'Agent',
          description: '提供即時串流回應的樂於助人的助理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'format_streaming_info',
              description: '格式化用於串流回應的資訊',
            },
            {
              name: 'analyze_streaming_performance',
              description: '分析串流性能指標',
            },
          ],
        },
        {
          name: 'support_agent',
          path: 'workspace/python/agents/support-agent',
          type: 'Agent',
          description: '具有知識庫搜尋和工單創建功能的客戶支援代理',
          model: 'gemini-2.0-flash-exp',
          tools: [
            {
              name: 'search_knowledge_base',
              description: '在知識庫中搜尋解決方案',
            },
            {
              name: 'create_ticket',
              description: '創建新的支援工單',
            },
            {
              name: 'check_ticket_status',
              description: '檢查現有工單的狀態',
            },
          ],
        },
        {
          name: 'third_party_agent',
          path: 'workspace/python/agents/third-party-agent',
          type: 'Agent',
          description: '整合第三方工具 (LangChain, CrewAI) 的代理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'create_wikipedia_tool',
              description: '創建一個用於 Wikipedia 搜尋的工具',
            },
            {
              name: 'create_web_search_tool',
              description: '創建一個用於一般網路搜尋的工具',
            },
            {
              name: 'create_directory_read_tool',
              description: '創建一個用於讀取目錄內容的工具',
            },
            {
              name: 'create_file_read_tool',
              description: '創建一個用於讀取檔案內容的工具',
            },
          ],
        },
        {
          name: 'a2a_orchestrator',
          path: 'workspace/python/agents/a2a-orchestrator',
          type: 'Agent',
          description: '使用 ADK A2A 協調遠端代理的協調器代理',
          model: 'gemini-2.0-flash',
          sub_agents: [
            {
              name: 'research_specialist',
              type: 'RemoteA2aAgent',
            },
            {
              name: 'data_analyst',
              type: 'RemoteA2aAgent',
            },
            {
              name: 'content_writer',
              type: 'RemoteA2aAgent',
            },
          ],
          tools: [
            {
              name: 'check_agent_availability',
              description: '檢查特定代理是否可用',
            },
            {
              name: 'log_coordination_step',
              description: '記錄協調過程中的一個步驟',
            },
          ],
        },
        {
          name: 'artifact_agent',
          path: 'workspace/python/agents/artifact-agent',
          type: 'Agent',
          description: '具有 artifact 儲存和版本控制功能的文件處理代理',
          model: 'gemini-1.5-flash',
          tools: [
            {
              name: 'extract_text_tool',
              description: '從文件中提取文本',
            },
            {
              name: 'summarize_document_tool',
              description: '總結文件的內容',
            },
            {
              name: 'translate_document_tool',
              description: '將文件翻譯成另一種語言',
            },
            {
              name: 'create_final_report_tool',
              description: '從處理過的數據創建最終報告',
            },
            {
              name: 'list_artifacts_tool',
              description: '列出所有可用的 artifact',
            },
            {
              name: 'load_artifact_tool',
              description: '載入特定的 artifact',
            },
            {
              name: 'load_artifacts_tool',
              description: '載入多個 artifact',
            },
          ],
        },
        {
          name: 'best_practices_agent',
          path: 'workspace/python/agents/best-practices-agent',
          type: 'Agent',
          description: '展示最佳實踐的生產就緒代理',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: 'validate_input_tool',
              description: '根據 schema 驗證輸入數據',
            },
            {
              name: 'retry_with_backoff_tool',
              description: '使用指數退避重試操作',
            },
            {
              name: 'circuit_breaker_call_tool',
              description: '執行包裝在斷路器中的呼叫',
            },
            {
              name: 'cache_operation_tool',
              description: '執行快取操作',
            },
            {
              name: 'batch_process_tool',
              description: '批次處理項目',
            },
            {
              name: 'health_check_tool',
              description: '檢查系統的健康狀況',
            },
            {
              name: 'get_metrics_tool',
              description: '檢索系統指標',
            },
          ],
        },
        {
          name: 'TravelPlanningSystem',
          path: 'workspace/python/agents/travel-planner',
          type: 'SequentialAgent',
          description: '具有平行搜尋功能的完整旅行規劃系統',
          sub_agents: [
            {
              name: 'ParallelSearch',
              type: 'ParallelAgent',
              sub_agents: [
                {
                  name: 'flight_finder',
                },
                {
                  name: 'hotel_finder',
                },
                {
                  name: 'activity_finder',
                },
              ],
            },
            {
              name: 'itinerary_builder',
            },
          ],
        },
        {
          name: 'vision_catalog_coordinator',
          path: 'workspace/python/agents/vision-catalog-agent',
          type: 'Agent',
          description: '多模態視覺產品目錄協調器',
          model: 'gemini-2.0-flash-exp',
          tools: [
            {
              name: 'list_sample_images',
              description: '列出可供處理的範例圖片',
            },
            {
              name: 'generate_product_mockup',
              description: '生成產品的視覺模型',
            },
            {
              name: 'analyze_uploaded_image',
              description: '分析用戶上傳的圖片',
            },
            {
              name: 'analyze_product_image',
              description: '分析產品圖片以獲取詳細資訊',
            },
            {
              name: 'compare_product_images',
              description: '比較兩張產品圖片',
            },
          ],
        },
        {
          name: 'voice_assistant',
          path: 'workspace/python/agents/voice-assistant',
          type: 'Agent',
          description: '支援 Live API 的即時語音助理',
          model: 'gemini-2.0-flash-live-001',
          capabilities: ['音訊錄製/播放', 'Live API 串流'],
        },
        {
          name: 'youtube_shorts_agent',
          path: 'workspace/python/agents/youtube-shorts-assistant',
          type: 'LlmAgent',
          description: '用於創建 YouTube Short 影片的代理',
          model: 'gemini-2.0-flash-001',
          tools: [
            {
              name: 'scriptwriter_agent (AgentTool)',
              description: '負責撰寫影片腳本的代理',
            },
            {
              name: 'visualizer_agent (AgentTool)',
              description: '負責創建視覺概念的代理',
            },
            {
              name: 'formatter_agent (AgentTool)',
              description: '負責格式化最終內容的代理',
            },
          ],
        },
        {
          name: 'gepa_optimization_agent',
          path: 'workspace/python/agents/gepa-optimization-agent',
          type: 'Agent',
          description:
            '一個客服代理，展示了如何使用 GEPA（遺rac遺傳演算法-帕雷托提示最佳化）來自動優化 LLM 代理的提示詞。',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'verify_customer_identity',
              description: '檢查訂單 ID + 電子郵件',
            },
            {
              name: 'check_return_policy',
              description: '驗證 30 天退貨期限',
            },
            {
              name: 'process_refund',
              description: '驗證後執行退款',
            },
          ],
        },
        {
          name: 'ui_integration_agent',
          path: 'workspace/python/agents/ui-integration',
          type: 'Agent',
          description:
            '一個最小化的實作，示範如何使用 AG-UI 協定 (AG-UI Protocol) 將 ADK 代理與 React UI 整合。',
          model: 'gemini-2.0-flash-exp',
          tools: [],
        },
        {
          name: 'data_analyst',
          path: 'workspace/python/agents/data-analysis-dashboard/agent',
          type: 'Agent',
          description:
            '結合 pandas 與 Chart.js 視覺化的 CSV 數據分析 ADK agent',
          model: 'gemini-2.0-flash-exp',
          tools: [
            {
              name: 'load_csv_data',
              description: '將 CSV 數據載入記憶體以進行分析',
            },
            {
              name: 'analyze_data',
              description: '對載入的數據集執行統計分析',
            },
            {
              name: 'create_chart',
              description: '生成視覺化圖表數據',
            },
          ],
        },
        {
          name: 'data_analysis_agent',
          path: 'workspace/python/agents/data-analysis-agent',
          type: 'Agent',
          description: '整合 Streamlit 與 ADK 的資料分析助理',
          model: 'gemini-2.0-flash',
          tools: [
            {
              name: 'analyze_column',
              description: '統計分析',
            },
            {
              name: 'calculate_correlation',
              description: '尋找關聯性',
            },
            {
              name: 'filter_data',
              description: '子集探索',
            },
            {
              name: 'get_dataset_summary',
              description: '概覽資訊',
            },
          ],
        },
        {
          name: 'support_bot',
          path: 'workspace/python/agents/support-bot',
          type: 'Agent',
          description: '協助處理公司政策與問題的團隊支援助理',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: 'search_knowledge_base',
              description: '搜尋公司知識庫以獲取資訊',
            },
            {
              name: 'create_support_ticket',
              description: '為複雜問題建立支援工單',
            },
          ],
        },
        {
          name: 'pubsub_processor',
          path: 'workspace/python/agents/pubsub-agent',
          type: 'Agent',
          description:
            '整合 Pub/Sub 與 ADK 建構的事件驅動文件處理協調者，負責將文件路由到專門的分析器。',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: 'financial_analyzer',
              description: '分析財務報告、收益、預算',
            },
            {
              name: 'technical_analyzer',
              description: '分析技術文件、架構、規格書',
            },
            {
              name: 'sales_analyzer',
              description: '分析銷售管道、交易、預測',
            },
            {
              name: 'marketing_analyzer',
              description: '分析行銷活動、參與度指標',
            },
          ],
        },
        {
          name: 'commerce_agent_e2e',
          path: 'workspace/python/agents/commerce-agent-e2e',
          type: 'Agent',
          description:
            '一位個人運動購物禮賓，使用 Google Search 接地與儲存的使用者偏好來提供專家級產品推薦。',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: 'search_products',
              description: '包裝 Google Search 的 AgentTool',
            },
            {
              name: 'save_preferences',
              description: '儲存使用者偏好',
            },
            {
              name: 'get_preferences',
              description: '取得使用者偏好',
            },
          ],
        },
        {
          name: 'policy_navigator',
          path: 'workspace/python/agents/policy-navigator',
          type: 'Agent',
          description:
            '企業合規與政策導航器，利用 File Search 構建 RAG，實作文件管理、搜尋專家、合規顧問與報告產生器等多代理人協作。',
          model: 'gemini-2.0-flash',
          sub_agents: [
            {
              name: 'document_manager',
              description: '管理政策文件上傳、組織與 metadata 設定',
            },
            {
              name: 'search_specialist',
              description: '搜尋公司政策並檢索相關資訊',
            },
            {
              name: 'compliance_advisor',
              description: '評估合規風險並提供政策指導',
            },
            {
              name: 'report_generator',
              description: '產生政策摘要、報告與稽核追蹤',
            },
          ],
          tools: [
            {
              name: 'upload_policy_documents',
              description: '將政策文件上傳到 File Search stores',
            },
            {
              name: 'search_policies',
              description: '對政策文件執行語意搜尋',
            },
            {
              name: 'filter_policies_by_metadata',
              description: '依部門、類型與日期過濾政策',
            },
            {
              name: 'compare_policies',
              description: '跨部門比較政策',
            },
            {
              name: 'check_compliance_risk',
              description: '評估與政策相關的合規風險',
            },
            {
              name: 'extract_policy_requirements',
              description: '從政策中擷取特定需求',
            },
            {
              name: 'generate_policy_summary',
              description: '建立簡潔的政策摘要',
            },
            {
              name: 'create_audit_trail',
              description: '建立稽核追蹤項目',
            },
          ],
        },
        {
          name: 'mcp_a2a_master_agent',
          path: 'workspace/python/agents/mcp-a2a-master/',
          type: 'Agent',
          description:
            '整合 cmd 與 MCP 的 A2A 主協調者代理，展示跨代理通訊與協作。',
          model: 'gemini-2.5-flash',
          tools: [
            {
              name: '_list_agents',
              description:
                'A2A 工具：回傳已註冊的 A2A 子代理的代理卡片物件字典列表。',
            },
            {
              name: '_delgate_task',
              description: '將任務委派給指定的代理。',
            },
            {
              name: 'add_numbers',
              description: '將兩個數字相加並回傳結果。',
            },
            {
              name: 'terminal_server',
              description: '在終端機中執行指令並回傳輸出。',
            },
          ],
        },
      ];

      // DOM 元素
      const grid = document.getElementById('agents-grid');
      const searchInput = document.getElementById('search-input');
      const resetButton = document.getElementById('reset-button');
      const totalCountEl = document.getElementById('total-count');
      const modal = document.getElementById('detail-modal');

      // 更新總數
      totalCountEl.textContent = agentsData.length;

      // 建立卡片
      function createCard(agent, index) {
        const card = document.createElement('div');
        card.className =
          'agent-card bg-gray-800 rounded-lg cursor-pointer flex flex-col justify-between';
        card.onclick = () => openModal(index);

        // 內容區塊
        const content = document.createElement('div');
        content.className = 'agent-content p-5 flex flex-col h-full';

        // 列表視圖數字圖示
        const numberBadge = document.createElement('div');
        numberBadge.className = 'list-view-number';
        numberBadge.textContent = index + 1;

        // 標頭
        const header = document.createElement('div');
        header.className = 'agent-header flex justify-between items-start mb-3';

        const title = document.createElement('h3');
        title.className =
          'agent-title text-lg font-bold text-white tracking-tight group-hover:text-purple-300 transition-colors';
        title.textContent = agent.name;

        // 卡片視圖數字圖示
        const cardNumberBadge = document.createElement('div');
        cardNumberBadge.className = 'card-view-number';
        cardNumberBadge.textContent = index + 1;

        header.appendChild(title);
        header.appendChild(cardNumberBadge);

        // 標籤區塊（用於卡片視圖）
        const labelBlock = document.createElement('div');
        labelBlock.className = 'agent-labels flex flex-wrap gap-2 mb-3';

        // 如果類型不是 "Agent"，則添加類型標籤
        if (agent.type && agent.type !== 'Agent') {
          const typeTag = document.createElement('span');
          typeTag.className = 'tag tag-type text-xs';
          typeTag.textContent = agent.type;
          labelBlock.appendChild(typeTag);
        }

        // 描述
        const desc = document.createElement('p');
        desc.className =
          'agent-description text-sm text-gray-400 mb-4 line-clamp-2 flex-grow';
        desc.textContent = agent.description;

        // 如果有模型，則添加模型標籤
        if (agent.model) {
          const modelTag = document.createElement('span');
          modelTag.className = 'tag tag-model flex items-center gap-1';
          modelTag.innerHTML = `
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path></svg>
            ${agent.model.split('/')[1] || agent.model}
          `;
          labelBlock.appendChild(modelTag);
        }

        // 元資訊 (模型 & 工具數量)
        const meta = document.createElement('div');
        meta.className = 'agent-meta flex items-center gap-3 mt-auto';

        const toolCount =
          (agent.tools ? agent.tools.length : 0) +
          (agent.sub_agents ? agent.sub_agents.length : 0);

        // 始終顯示工具數量，即使為 0
        const toolsTag = document.createElement('span');
        toolsTag.className =
          'text-xs text-gray-500 font-medium flex items-center gap-1';
        toolsTag.innerHTML = `
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
              ${toolCount} 個工具/代理
           `;
        meta.appendChild(toolsTag);

        // 列表視圖右側箭頭圖示
        const arrow = document.createElement('div');
        arrow.className = 'list-view-arrow';
        arrow.innerHTML = `
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        `;

        content.appendChild(numberBadge);
        content.appendChild(header);
        content.appendChild(labelBlock); // 插入標籤區塊
        content.appendChild(desc);
        content.appendChild(meta);
        content.appendChild(arrow);

        // 頁腳 (僅卡片視圖)
        const footer = document.createElement('div');
        footer.className =
          'agent-footer px-5 py-3 border-t border-gray-700/50 flex justify-between items-center bg-gray-800/50';
        footer.innerHTML = `
            <span class="text-xs text-gray-500 font-mono truncate max-w-[180px]" title="${
              agent.path
            }">${agent.path.split('/').pop()}</span>
            <span class="text-purple-400 text-xs font-semibold">詳情</span>
        `;

        card.appendChild(content);
        card.appendChild(footer);

        return card;
      }

      // 渲染所有卡片
      function renderCards(agents) {
        grid.innerHTML = '';
        agents.forEach((agent, index) => {
          // 因為篩選後 index 會變，所以這裡我們傳遞原始資料的 index
          const originalIndex = agentsData.indexOf(agent);
          grid.appendChild(createCard(agent, originalIndex));
        });
      }

      // 初始渲染
      renderCards(agentsData);

      // Toggle collapse function for modal sections
      function toggleCollapse(section) {
        const header = event.currentTarget;
        const content = header.nextElementSibling;

        header.classList.toggle('collapsed');
        content.classList.toggle('collapsed');
      }

      // 搜尋功能
      searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = agentsData.filter(
          (agent) =>
            agent.name.toLowerCase().includes(term) ||
            agent.description.toLowerCase().includes(term) ||
            (agent.tools &&
              agent.tools.some((t) => t.name.toLowerCase().includes(term)))
        );
        renderCards(filtered);
      });

      resetButton.addEventListener('click', () => {
        searchInput.value = '';
        renderCards(agentsData);
      });

      // Modal 功能
      function openModal(index) {
        const agent = agentsData[index];
        document.getElementById('modal-title').textContent = agent.name;
        document.getElementById('modal-path').innerHTML = `
          <a href="https://github.com/lastingyeh/google-adk-study/tree/master/${agent.path}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 text-purple-400 hover:text-purple-300 hover:underline transition-colors duration-200">
            <span>${agent.path}</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
              <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" />
              <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" />
            </svg>
          </a>
        `;
        document.getElementById('modal-description').textContent =
          agent.description;

        // 標籤
        const tagsContainer = document.getElementById('modal-tags');
        tagsContainer.innerHTML = '';

        // 類型標籤
        const typeSpan = document.createElement('span');
        typeSpan.className = 'tag tag-type';
        typeSpan.textContent = agent.type;
        tagsContainer.appendChild(typeSpan);

        // 模型標籤
        if (agent.model) {
          const modelSpan = document.createElement('span');
          modelSpan.className = 'tag tag-model';
          modelSpan.textContent = agent.model;
          tagsContainer.appendChild(modelSpan);
        }

        // 工具
        const toolsContainer = document.getElementById('modal-tools-container');
        const toolsList = document.getElementById('modal-tools-list');
        toolsList.innerHTML = '';

        if (agent.tools && agent.tools.length > 0) {
          toolsContainer.style.display = 'block';
          agent.tools.forEach((tool) => {
            const div = document.createElement('div');
            div.className =
              'bg-gray-800/50 p-3 rounded border border-gray-700/50 hover:border-gray-600 transition-colors';

            let paramsHtml = '';
            if (tool.parameters && tool.parameters.length > 0) {
              paramsHtml =
                '<div class="mt-2 pt-2 border-t border-gray-700/30 space-y-1">';
              tool.parameters.forEach((param) => {
                paramsHtml += `
                            <div class="flex items-baseline text-xs">
                                <span class="text-blue-300 font-mono mr-2">${param.name}</span>
                                <span class="text-gray-500 mr-2">(${param.type})</span>
                                <span class="text-gray-400">${param.description}</span>
                            </div>
                        `;
              });
              paramsHtml += '</div>';
            }

            div.innerHTML = `
                    <div class="font-mono text-sm text-green-300 font-semibold mb-1">${
                      tool.name
                    }</div>
                    ${
                      tool.description
                        ? `<div class="text-xs text-gray-400 mb-1">${tool.description}</div>`
                        : ''
                    }
                    ${paramsHtml}
                `;
            toolsList.appendChild(div);
          });
        } else if (agent.toolsets && agent.toolsets.length > 0) {
          toolsContainer.style.display = 'block';
          agent.toolsets.forEach((ts) => {
            const div = document.createElement('div');
            div.className =
              'bg-gray-800/50 p-3 rounded border border-gray-700/50';
            div.innerHTML = `
                    <div class="font-mono text-sm text-green-300 font-semibold mb-1">${ts.name}</div>
                    <div class="text-xs text-gray-400">Type: ${ts.type}</div>
                `;
            toolsList.appendChild(div);
          });
        } else {
          toolsContainer.style.display = 'none';
        }

        // 子代理
        const subAgentsContainer = document.getElementById(
          'modal-subagents-container'
        );
        const subAgentsList = document.getElementById('modal-subagents-list');
        subAgentsList.innerHTML = '';

        if (agent.sub_agents && agent.sub_agents.length > 0) {
          subAgentsContainer.style.display = 'block';

          // 遞迴渲染子代理的輔助函式 (為 UI 簡化)
          function renderSubAgent(sub, depth = 0) {
            const div = document.createElement('div');
            div.className = `p-2 rounded bg-gray-800/30 border border-gray-700/30 ${
              depth > 0 ? 'ml-4' : ''
            }`;

            let content = `<div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                    <span class="font-semibold text-gray-200">${
                      typeof sub === 'string' ? sub : sub.name
                    }</span>
                    ${
                      sub.type
                        ? `<span class="text-xs px-2 py-0.5 rounded bg-purple-900/30 text-purple-300 border border-purple-500/20">${sub.type}</span>`
                        : ''
                    }
                </div>`;

            if (sub.description) {
              content += `<div class="text-sm text-gray-400 mt-1 ml-4">${sub.description}</div>`;
            }

            div.innerHTML = content;
            subAgentsList.appendChild(div);

            if (sub.sub_agents && Array.isArray(sub.sub_agents)) {
              sub.sub_agents.forEach((child) =>
                renderSubAgent(child, depth + 1)
              );
            }
          }

          agent.sub_agents.forEach((sub) => renderSubAgent(sub));
        } else {
          subAgentsContainer.style.display = 'none';
        }

        // 額外資訊 (外掛、能力、規劃器)
        const extrasContainer = document.getElementById(
          'modal-extras-container'
        );
        const extrasList = document.getElementById('modal-extras-list');
        extrasList.innerHTML = '';
        let hasExtras = false;

        if (agent.plugins) {
          hasExtras = true;
          agent.plugins.forEach((p) => {
            extrasList.innerHTML += `<li>外掛程式: <span class="text-yellow-200">${p}</span></li>`;
          });
        }
        if (agent.capabilities) {
          hasExtras = true;
          agent.capabilities.forEach((c) => {
            extrasList.innerHTML += `<li>能力: <span class="text-yellow-200">${c}</span></li>`;
          });
        }
        if (agent.planner) {
          hasExtras = true;
          extrasList.innerHTML += `<li>規劃器: <span class="text-yellow-200">${agent.planner}</span></li>`;
        }

        extrasContainer.style.display = hasExtras ? 'block' : 'none';

        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
      }

      function closeModal() {
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
      }

      // 在 Modal 外部點擊時關閉
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      // 按下 Escape 鍵時關閉
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });

      // 視圖切換
      const cardViewBtn = document.getElementById('card-view-btn');
      const listViewBtn = document.getElementById('list-view-btn');

      function setView(mode) {
        if (mode === 'list') {
          grid.classList.add('list-view');
          listViewBtn.classList.add('text-purple-400', 'bg-purple-500/10');
          listViewBtn.classList.remove('text-gray-500');
          cardViewBtn.classList.remove('text-purple-400', 'bg-purple-500/10');
          cardViewBtn.classList.add('text-gray-500');
          localStorage.setItem('adkAgentsViewMode', 'list');
        } else {
          grid.classList.remove('list-view');
          cardViewBtn.classList.add('text-purple-400', 'bg-purple-500/10');
          cardViewBtn.classList.remove('text-gray-500');
          listViewBtn.classList.remove('text-purple-400', 'bg-purple-500/10');
          listViewBtn.classList.add('text-gray-500');
          localStorage.setItem('adkAgentsViewMode', 'card');
        }
      }

      cardViewBtn.addEventListener('click', () => setView('card'));
      listViewBtn.addEventListener('click', () => setView('list'));

      // 恢復視圖偏好設定
      if (localStorage.getItem('adkAgentsViewMode') === 'list') {
        setView('list');
      }
    </script>
  </body>
</html>
